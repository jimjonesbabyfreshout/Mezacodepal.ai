(()=>{var t={1031:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.Engagement=void 0;var s=e(7113);i.Engagement=s.default},7113:function(t,i,e){"use strict";var s=this&&this.__spreadArrays||function(){for(var t=0,i=0,e=arguments.length;i<e;i++)t+=arguments[i].length;var s=Array(t),n=0;for(i=0;i<e;i++)for(var r=arguments[i],o=0,h=r.length;o<h;o++,n++)s[n]=r[o];return s};Object.defineProperty(i,"__esModule",{value:!0});var n=e(1680),r=function(){function t(t){this._velocities=[],this._listeners=[],this._isSubscribed=!1,this._timeoffset=t||Date.now(),this._outOfFocusTime=0,this._hiddenTime=0,this._pageHeight=this.getPageHeight(),this._windowHeight=this.getWindowHeight(),this._lastScrollingDistance=this.getScrollingDistance(),this._maxScrollDepthPercentage=this.getMaxScrollDepth(),this._lastVelocityReportTime=Date.now()}return t.prototype.subscribe=function(){this._isSubscribed||(this._isSubscribed=!0,this.initScrollListener(),this.initVisibilityChangeListener(),this.initVelocityListener(),this.initResizeListener())},t.prototype.unsubscribe=function(){this._isSubscribed&&(this._listeners.forEach((function(t){window.removeEventListener(t.eventName,t.eventHandler)})),clearInterval(this._velocityInterval),this._listeners=[],this._isSubscribed=!1)},t.get=function(i){return t._instance||(t._instance=new t(i)),t._instance},t.prototype.getData=function(){return{max_depth_percentage:this._maxScrollDepthPercentage,screen_length:this.getScreenLength(),time_on_page:this.getTimeOnPage(),velocity_excluding_static_time:this.getAverageVelocity(n.VelocityType.EXCLUDE_STATIC_USER),velocity_including_static_time:this.getAverageVelocity(n.VelocityType.INCLUDE_STATIC_USER),page_load_time:this.getPageLoadTime()}},t.prototype.getPageLoadTime=function(){try{var t=window.performance.getEntriesByType("navigation")[0];if("complete"===document.readyState&&t&&t.loadEventEnd>0&&t.domContentLoadedEventStart>0)return Math.floor(Math.abs(t.loadEventEnd-t.domContentLoadedEventStart))}catch(t){}return-1},t.prototype.getScreenLength=function(){return window.screen.availHeight||window.screen.height},t.prototype.initResizeListener=function(){var t=this,i=function(){t._pageHeight=t.getPageHeight(),t._windowHeight=t.getWindowHeight()};this._listeners.push({eventName:"resize",eventHandler:i}),window.addEventListener("resize",i)},t.prototype.initScrollListener=function(){var t=this,i=this.throttle((function(){t._maxScrollDepthPercentage=t.getMaxScrollDepth()}),1e3);this._listeners.push({eventName:"scroll",eventHandler:i}),window.addEventListener("scroll",i)},t.prototype.initVisibilityChangeListener=function(){var t=this,i=function(){"hidden"===window.document.visibilityState?t._hiddenTime=Date.now():t._hiddenTime>0&&(t._outOfFocusTime=t._outOfFocusTime+(Date.now()-t._hiddenTime))};this._listeners.push({eventName:"visibilitychange",eventHandler:i}),window.addEventListener("visibilitychange",i)},t.prototype.initVelocityListener=function(){var t=this;this._velocityInterval||(this._velocityInterval=setInterval((function(){t._velocities.push(t.getMomentVelocity())}),1e3))},t.prototype.getMaxScrollDepth=function(){this._pageHeight=this.getPageHeight(),this._windowHeight=this.getWindowHeight();var t=this.getScrollDepthPercentages(),i=this._maxScrollDepthPercentage||0;return Math.max(i,t)},t.prototype.getScrollDepthPercentages=function(){var t=this.getScrollingDistance(),i=this._pageHeight;return Math.round(t/i*100)},t.prototype.getScrollingDistance=function(){return this.getPageYOffset()+this._windowHeight},t.prototype.getPageYOffset=function(){return window.pageYOffset||window.scrollY},t.prototype.getWindowHeight=function(){return window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},t.prototype.getPageHeight=function(){var t,i;return Math.floor(Math.max(null===(t=window.document.body)||void 0===t?void 0:t.scrollHeight,null===(i=window.document.body)||void 0===i?void 0:i.offsetHeight,window.document.documentElement.clientHeight,window.document.documentElement.scrollHeight,window.document.documentElement.offsetHeight))},t.prototype.getTimeOnPage=function(){var t=(Date.now()-this._timeoffset)/1e3,i=this._outOfFocusTime/1e3;return Number((t-i).toFixed(2))},t.prototype.getAverageVelocity=function(t){var i=s(this._velocities);t===n.VelocityType.EXCLUDE_STATIC_USER&&(i=i.filter(Number));var e=i.reduce((function(t,i){return t+i}),0);return i.length>0?e/i.length:-1},t.prototype.getMomentVelocity=function(){var t=Date.now(),i=this.getScrollingDistance()-this._lastScrollingDistance,e=(t-this._lastVelocityReportTime)/1e3;return this._lastVelocityReportTime=t,this._lastScrollingDistance=this.getScrollingDistance(),!i?0:Math.round(Math.abs(i/e))},t.prototype.getTitlesText=function(){var t=[];return document.querySelectorAll("h1").forEach((function(i){t.push(i.innerText.trim().replace(/_/g,"-"))})),t.length?t.join("_"):void 0},t.prototype.getDescriptionText=function(){var t=[];return document.querySelectorAll("meta[name='description'],meta[property='og:description']").forEach((function(i){t.push(i.content.trim().replace(/_/g,"-"))})),t.length?t.join("_"):void 0},t.prototype.throttle=function(t,i){var e=Date.now();return function(){e+i-Date.now()<0&&(t(),e=Date.now())}},t}();i.default=r},1680:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.VelocityType=void 0,function(t){t.EXCLUDE_STATIC_USER="exclude_static_user",t.INCLUDE_STATIC_USER="include_static_user"}(i.VelocityType||(i.VelocityType={}))},7590:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e(7971);i.Moat=s.default},7971:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=function(){function t(t){this.config=t,this.client={moatClientLevel1:t.layout_id,moatClientLevel2:t.site_key,moatClientLevel3:t.devicePlatform,moatClientLevel4:t.publisher_key}}return t.prototype.getURL=function(){return t.SCRIPT_SRC+"#"+this.toUrlParams(this.client)},t.prototype.toUrlParams=function(t){return Object.keys(t).map((function(i){return i+"="+("object"==typeof t[i]?encodeURIComponent(JSON.stringify(t[i])):encodeURIComponent(t[i]))})).join("&")},t.SCRIPT_SRC="//z.moatads.com/browsidisplay14489870757/moatad.js",t}();i.default=e},5218:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var s=e(4070);i.WebVitals=s.WebVitals},4070:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});var e=function(){function t(t,i){this.webVitalsData={pv:t,url:i}}return t.prototype.getData=function(){return this.webVitalsData},t.prototype.measure=function(){var t=this;this.getInstance().then((function(i){i.getFID(t.collectWebVitals.bind(t)),i.getLCP(t.collectWebVitals.bind(t)),i.getCLS(t.collectWebVitals.bind(t))}))},t.prototype.collectWebVitals=function(t){var i=this.prepareDataFields(t),e=i.name.toLowerCase();this.webVitalsData[e]=i.value},t.prototype.getInstance=function(){return new Promise((function(t){if(window.top.webVitals)t(window.top.webVitals);else{var i=document.createElement("script");i.src="//cdn.browsiprod.com/web-vitals/web-vitals.iife.3.1.0.js",i.onload=function(){t(window.top.webVitals)},document.head.appendChild(i)}}))},t.prototype.prepareDataFields=function(t){var i=t.name,e=t.value;return{name:i,value:e="number"==typeof e?+e.toFixed(3):e}},t}();i.WebVitals=e},8598:(t,i,e)=>{"use strict";const s=e(5780),n=e(7920),r=e(2478),o=e(4436),h=e(5540),a=e(5662),l=e(5684),c=e(2661),d=e(8867),u=e(9008);e(495);const f=e(5865),v=e(6389),p=e(2643),m=e(7966),g=e(4524),b=e(1675),w=e(8515),_=e(5218),y=e(4222),S=e(1031),O=e(8562),A=e(2873);class j{constructor(){this.profile=v.Profiler.get(),this.logger=new c.default("App.ts")}o(){if(h.default._()>0||b.default.isSlidesTriggered())o.default.get().sendUserEngagedEvent(),d.default.get().startMeasurements();else{const t=()=>{this.logger.info("detected engagementScroll, send event"),h.default.S().removeEventListener("scroll",t),o.default.get().sendUserEngagedEvent(),d.default.get().startMeasurements()};a.default.get().listen("scroll",h.default.S(),t)}}O(){window._middyo.state===f.MiddyState.LOADED&&(window._middyo.state=f.MiddyState.STARTED,this.profile.runMode===w.RunMode.BLOCKLIST?this.A():this.I())}A(){this.logger.style("%cBlocklisted mode","font-size:48px; color:red; background:black;"),this.o(),r.default.sendPageViewReport([],this.profile,!1,!1)}I(){var t;this.P();const i=new A.default((null===(t=this.profile.prebidData)||void 0===t?void 0:t.globalInstanceName)||"pbjs",window);if(a.default.get().addExternalListenerRemoveFunction(i.removeListeners.bind(i)),i.initListeners(),s.default.instance.init(this.profile.debug,this.profile.draw,this.profile.maxAdDensity||0),this.logger.info("%Profile: ","font-size:18px; font-weight:bold;",this.profile),this.profile.analysisMode||(m.DemandTool.get(),this.profile.fixedSpotsFirst&&u.default.get().scanFixedSpotsFirst()),this.o(),d.default.get().sendAnalyticsEvent(),this.profile.useWebVitals){const t=new _.WebVitals(v.Profiler.get().pageViewID,encodeURIComponent(h.default.M()));t.measure(),O.default.instance.subscribe((i=>{if(i){const i=t.getData(),{fid:e,lcp:s,cls:n}=i;[e,s,n].some((t=>"number"==typeof t))&&(this.logger.verbose("Sending web vital data ",i),o.default.get().sendWebVitalsEvent(i))}}))}this.profile.analysisMode&&this.logger.style("%cAnalysis mode","font-size:48px; color:white; background:red;"),this.T()}P(){S.Engagement.get(this.profile.timeOffset).subscribe(),O.default.instance.subscribe((t=>{t&&o.default.get().sendSummaryEvent()}))}R(){this.runTriggersHook(),this.C()}D(){return new Promise((t=>{const i=g.default.getExternalFlowHandler("middyInitialator");i?i(this.profile,t):t()}))}T(){this.D().then((()=>this.R()))}runTriggersHook(){const t=g.default.getExternalFlowHandler("triggers");t&&t({pv:t=>{o.default.get().sendPageviewEvent(0,0,!0,t)},gd:(t,i)=>{o.default.get().sendGeneralDataEvent(t,i)}})}C(){b.default.isManualDcs()?(window[b.default.windowVarName]=window[b.default.windowVarName]||{},new p.default("manual",!0)):b.default.shouldRetrieveDcs()?(window[b.default.windowVarName]=window[b.default.windowVarName]||{},b.default.retrieveMutationElementIfExists(this.profile.dcs.mutationXpaths,this.logger).then(this.$.bind(this)).catch((t=>{this.dcsFailedCallback(t)}))):this.runSpotEngine()}$(t){const i=n.default.createDCS(this.profile.dcs.type,t);null!==i&&i.createObserver()}dcsFailedCallback(t){t.message===b.default.dcsFailureMessage?(this.logger.style("%cCould not find mutationElement on the page, not running DCS","font-size:16px;"),this.runSpotEngine()):setTimeout((()=>{throw t}))}runSpotEngine(){m.DemandTool.get().holdEngineForRelocation().then((()=>{let t,i=u.default.get();this.profile.dcsState&&(t={isDcs:!0}),r.default.run(i,this.profile,!0,!0,t)}))}}function E(){if(("interactive"===document.readyState||"complete"===document.readyState)&&!window._middyo.state){window._middyo.state=f.MiddyState.LOADED;(new j).O()}}!function(){!function(){var t,i;const e=window._middyo,s=null===(i=null===(t=null==e?void 0:e.sec)||void 0===t?void 0:t.dcs)||void 0===i?void 0:i.su;s&&new y.DcsApi(e,s)}();const t=v.Profiler.get();o.default.get().sendEngineLoadedEvent(),v.Profiler.setLoadTime(),t.debug&&l.Output.setBrowsiOutput("engine_loaded"),window.document.addEventListener("readystatechange",(()=>E())),E()}()},8454:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6389);class n{static getNow(){return Date.now()}static isCacheTimeValid(t,i){return Date.now()-i<t}static isGlobalCacheActive(){return s.Profiler.get().cacheUtilsFunctions}static getCachedResult(t,i,e){if(!this.isGlobalCacheActive())return{valid:!1,result:null,reason:"cache is not active for this site"};const s=t,n=e?Object.assign(this.defConfigs,e):this.defConfigs;if(!n.active)return{valid:!1,result:null,reason:"function not active"};const r=s.browsiCache&&s.browsiCache[i];return r&&this.isCacheTimeValid(n.time,r.cacheTime)?{valid:!0,result:r.result}:{valid:!1,result:null,reason:"cache not found"}}static storeCache(t,i,e,s){const n=s?Object.assign(this.defConfigs,s):this.defConfigs;if(!this.isGlobalCacheActive()||!n.active)return;const r=t,o=r.browsiCache&&r.browsiCache[i];o&&o.result&&this.isCacheTimeValid(n.time,o.cacheTime)||(r.browsiCache=r.browsiCache||{},r.browsiCache[i]={result:e,cacheTime:this.getNow()})}}i.default=n,n.defConfigs={active:!0,time:100}},6875:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});i.default=class{constructor(t,i){this.child=t,this.parent=i||void 0}}},2661:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2797);i.default=class{constructor(t){if(this.loggerFallback=!1,this.name=t,this.active=window._middyo&&window._middyo.debug,this.logsToHide=window._middyo&&window._middyo.hideLogs||[],this.logsWhiteList=window._middyo&&window._middyo.logsWhiteList||[],this.active){let t=window.console;if(!t.hasOwnProperty("debug")||!t.hasOwnProperty("info")||!t.hasOwnProperty("log")){let t=document.createElement("iframe");t.width="0",t.height="0",t.frameBorder="0",document.body.appendChild(t);let i=t.contentWindow;["debug","info","log"].forEach((t=>window.console[t]=i&&i.console[t]))}}}hideLog(){return(this.logsToHide.indexOf(this.name)>-1||this.logsToHide.indexOf("*")>-1)&&-1==this.logsWhiteList.indexOf(this.name)}print(t,i){if(!this.active)return;if(this.hideLog())return;const e=window.console,s=[],n=t=>{let n=s.concat(i);if(this.loggerFallback)return this.loggerWithArguments(t,n);try{e[t].apply(e,n)}catch(i){return this.loggerFallback=!0,this.loggerWithArguments(t,n)}};switch(t){case 0:s.push(`%c[${this.name}]`,"color: gray;"),n("debug");break;case 1:s.push(`%c[${this.name}]`,"color: gray;"),n("info");break;case 2:s.push(`%c[!] [${this.name}]`,"color: red;"),n("error");break;case 3:n("table");break;case 4:n("log")}}loggerWithArguments(t,i){let e=`console.${t}(args)`,s=i.map(((t,i)=>`args[${i}]`));new Function("args",e.replace(/args/,s.join(",")))(i)}verbose(...t){this.print(0,Array.prototype.slice.call(arguments))}v(...t){this.verbose.apply(this,arguments)}info(...t){this.print(1,Array.prototype.slice.call(arguments))}error(...t){this.print(2,Array.prototype.slice.call(arguments))}i(...t){this.info.apply(this,arguments)}table(...t){this.print(3,Array.prototype.slice.call(arguments))}style(...t){this.print(4,Array.prototype.slice.call(arguments))}logWaterfallDetails(t,i,e){t.waterfall=t.waterfall||[],t.waterfall.push({provider:t.genericParams.displayName||t.providerName||s.ProviderType.HEADER_BIDDING,adIndex:t.spotIndex,adUnit:i.c.au||"-",size:JSON.stringify(t.implementedSize),position:t.positionType,isLazy:t.isLazyLoading,status:e}),this.info("Waterfall Table:"),this.table(t.waterfall)}hbLog(t,i,e,s){if(this.active){console.group(`auction result ${i}, winner: %c[${s&&s.bidder||"None"}]`,"color:green;font-size:20px");const n=t.map((t=>({bidder:t.bidder,cpm:t.cpm,size:`${t.width}x${t.height}`,currency:t.currency}))),r=e.map((t=>({bidder:t.bidder,cpm:-1,size:"NA",currency:"NA"})));this.table(n.concat(r)),console.groupEnd()}}apsLog(t){this.active&&t&&(console.group(`${t.slotID} result %c[aps]`,"color:green;font-size:20px"),this.table([t]),console.groupEnd())}}},5684:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4436),n=e(5594),r=e(6448),o=e(83),h=e(470),a=e(5540),l=e(9008),c=e(6389),d=e(3486);i.Output={setBrowsiOutput:function(t){function i(){return o.default.getSpots().slice()}const e=i(),u={getFiredEvents:s.default.getFiredEvents,spots:e,getSpots:i,serializedSpots:e.map((t=>o.default.serialize(t))),publisherAds:n.default.get().foundAds,browsiEmbeddedPlacementsIds:a.default.F(),mainContent:{start:r.default.instance.start,end:r.default.instance.end,startBorder:r.default.instance.startingBorder,endBorder:r.default.instance.endingBorder},getEmbeddedSpots:o.default.getEmbeddedSerializedSpots,getStayAwayElements:h.default.get().getStayAwayElements.bind(h.default.get()),f:a.default,skippedElements:d.default.getSkippedElementsContainers(),invalidInspectives:l.default.get().getInvalidInspectives()},f=c.Profiler.get().pageViewID;window.browsiOutput=window.browsiOutput?window.browsiOutput:{},window.browsiOutput[f]=window.browsiOutput[f]?Object.assign(window.browsiOutput[f],u):u,window.browsiOutput.state=t},getBrowsiOutput:t=>t?window.browsiOutput[t]:window.browsiOutput[c.Profiler.get().pageViewID]}},4524:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6389),n=e(5540),r=e(83),o=e(9504),h=e(4436),a=e(7016),l=e(2661),c=e(9813),d=e(4469);class u{static get profile(){return this._profile||(this._profile=s.Profiler.get()),this._profile}static isEmbeddedByBrowsi(t,i){let e=this.profile.externalFlowHandler&&this.profile.externalFlowHandler.currentAds?this.profile.externalFlowHandler.currentAds:[];if(n.default.N(e,t))return!0;if(!i&&r.default.getSpots().length>0){let i=r.default.getSpots().filter((t=>t.browsiAd&&n.default.B(t.browsiAd))).map((t=>t.browsiAd));const e=t.id,s=t.id&&-1!==n.default.F().indexOf(e)||n.default.N(i,t);if(s)return s}return!1}static isLazySpotsEnabled(){return!!this.profile.spotsSupplyParams.lazySpots}static getLazySpotsInstance(){var t;return!!(null===(t=this.profile.spotsSupplyParams.lazySpots)||void 0===t?void 0:t.bucketsConfigured)?c.default.get():d.default.get()}static getTimeOffset(){return Date.now()-this.profile.timeOffset}static isCustomRefreshConfigured(){return!!this.profile.customRefresh}static getExternalFlowHandler(t){var i;if(this.profile.externalFlowHandler&&(null===(i=this.profile)||void 0===i?void 0:i.externalFlowHandler[t])){return(...i)=>{try{return this.logger.verbose(`Invoking ${t}`),this.profile.externalFlowHandler[t](...i)}catch(i){h.default.get().sendErrorEvent(a.EventType.CRASH,"ExternalFlowHandler: "+t,i.message)}}}}static getDcsType(){return this.profile.dcsState?"script":this.profile.dcs.type}static getUserID(){return o.default.hasUserConsent?this.profile.userID:"anonymous"}}i.default=u,u.logger=new l.default("Profile Utils")},5540:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6875),n=e(7016),r=e(6797),o=e(4236),h=e(4524),a=e(6389),l=e(1675),c=e(5353),d=e(549),u=e(7899),f=e(7590),v=e(4436),p=e(2797),m=e(8454);class g{static L(){return this.viewport||(this.viewport=g.U()),this.viewport}static H(t){return null==t}static W(){const t={};return t.width=window.screen.availWidth||window.screen.width,t.height=window.screen.availHeight||window.screen.height,t}static q(){const t=h.default.getExternalFlowHandler("getPageHeight");let i;return i=t?t():this.G(),l.default.hasDcsMc()?i-g.J(l.default.getCurrentDcsElement(),!0).y:i}static X(){const t=h.default.getExternalFlowHandler("getPageWidth");if(t)return t();const i=window.document.documentElement;return Math.floor(Math.max(i.clientWidth,i.scrollWidth,i.offsetWidth))}static K(t){let i=t.offsetTop,e=t.offsetLeft,s=t.offsetParent;const n=t.offsetWidth,r=t.offsetHeight;for(;s;)i+=s.offsetTop,e+=s.offsetLeft,s=s.offsetParent;const o=window.document.body,h=o.offsetTop,a=o.offsetLeft,l=o.offsetWidth;return i>=h&&e>=a&&n<=l&&r>0}static Y(){return Math.floor(Math.abs(window.performance.timing.loadEventEnd-window.performance.timing.domContentLoadedEventStart))}static Z(t,i){var e;let s={y:-1,x:-1};if(!t||!this.B(t))return s;s=this.J(t);const n=null===(e=a.Profiler.get().dcsState)||void 0===e?void 0:e.mainContentElement;if(l.default.isEndless()){const t=l.default.getEndlessElementByPvId(i||a.Profiler.get().pageViewID);s.y-=this.J(t).y}else n&&(s.y-=this.J(n).y);return s}static tt(t){let i=this.J(t.element).y;return t.referer instanceof HTMLIFrameElement&&(i+=this.J(t.referer).y),l.default.hasDcsMc()&&(i-=this.J(l.default.getCurrentDcsElement()).y),i}static it(t){return this.L().height*t}static nt(t){return g.ht()+g._()-g.Z(t).y}static ct(t){const i=g.Z(t).y,e=i+g.ut(t).h,s=g._(),n=s+g.ht();return e<s||i>n?0:e<=n&&i>=s?e-i:e>n?n-i:e-s}static gt(t,i){return this.nt(t)>=this.it(i)}static wt(t,i){return this.ct(t)>=this.it(i)}static J(t,i=!1){let e=t.getBoundingClientRect(),s=this._t(),n=document.documentElement,r=i?window.pageYOffset||n.scrollTop||s.scrollTop:this._(),o=window.pageXOffset||n.scrollLeft||s.scrollLeft,h=n.clientTop||s.clientTop||0,a=n.clientLeft||s.clientLeft||0,l=e.top+r-h,c=e.left+o-a;return{y:Math.round(l),x:Math.round(c)}}static getSAPositionFromTop(t){return g.Z(t).y}static yt(t){if(!t)return 0;const i=g.Z(t).y;if("none"!==t.style.display&&i>0)return i;let e,s,n=t.previousElementSibling;for(;n;){if(e=g.Z(n).y,"none"!==n.style.display&&e>0)return s=n.getBoundingClientRect().height,s+e;n=n.previousElementSibling}return this.yt(t.parentElement)}static St(t){return Math.floor(this.Z(t).y/this.L().height)+1}static Ot(t){return Math.floor(this.At(t))+1}static At(t){return t.adDistanceFromTop/this.L().height}static jt(t){const i=l.default.isEndless()?a.Profiler.get().pageViewID:void 0;return Math.floor(g.Z(t,i).y/this.L().height)+1}static Et(){const t=l.default.hasDcsMc()?this._()-g.J(l.default.getCurrentDcsElement()).y:this._();return{top:t,bottom:t+Number(this.L().height),left:window.pageXOffset}}static calculateDistanceBetweenTwoElements(t,i){let e=0,s=this.Z(t),n=this.Z(i);return s&&n&&(s.y>n.y?e=s.y-n.y-this.ut(i).h:s.y<n.y&&(e=n.y-s.y-this.ut(t).h)),e}static It(){let t={width:0,height:0},i=window.screen;return t.width=i.availWidth,t.height=i.availHeight,t}static Pt(){return Math.max(Math.floor(this.Mt()),1)}static Tt(t){return Number(g.Mt().toFixed(t))}static Mt(){let t=this.It();return this.Et().top/t.height+1}static B(t){return t instanceof Element}static ut(t){let i=t.getBoundingClientRect();return{w:i.width,h:i.height}}static kt(t){let i=t.getElementsByTagName("iframe")[0];if(i)try{return{size:{w:+i.width,h:+i.height},element:i}}catch(t){}return{size:this.ut(t),element:t}}static Rt(t){return t.dataset._getElementSize=t.dataset._getElementSize||JSON.stringify(this.ut(t)),JSON.parse(t.dataset._getElementSize)}static xt(t){let i=t.getBoundingClientRect();return{w:i.width,h:i.height}}static Ct(t){if(t&&"function"==typeof t.getAttribute&&t.getAttribute("id"))return"//*[@id='"+t.getAttribute("id")+"']";if(t===document.body)return"/";if(t){let i=0,e=t.parentNode?t.parentNode.childNodes:[];for(let s=0;s<e.length;s++){let n=e[s];if(n===t)return this.Ct(t.parentNode)+"/"+t.tagName.toLowerCase()+"["+(i+1)+"]";1===n.nodeType&&n.tagName===t.tagName&&i++}}return""}static Dt(t){return t.size?{w:t.size[0],h:t.size[1]}:{w:-1,h:-1}}static $t(t,i){let e=window.getComputedStyle(t),s=!i||this.Ft(t);return!!e&&(s&&"visible"===e.getPropertyValue("visibility")&&"none"!==e.getPropertyValue("display")&&"0"!==e.getPropertyValue("opacity"))}static Ft(t){let i=t.getBoundingClientRect();return i.top>=0&&i.right<=window.innerWidth&&i.bottom<=this.q()&&i.left>=0&&i.height>0||this.K(t)}static Nt(t,i){let e=Array();return("IFRAME"===t.nodeName?this.Vt(t):Array.from(t.querySelectorAll("*"))).forEach((n=>{if("IFRAME"===n.nodeName)try{const t=this.Bt(n);if(t){let s=t.document;if(s){let t=this.Nt(s.body,i||n);e=e.concat(t)}}}catch(n){}else e.push(new s.default(n,i||t))})),e}static Bt(t){let i;try{i=t.contentWindow&&t.contentWindow.document?t.contentWindow:void 0}catch(t){}return i}static Vt(t){if("IFRAME"===t.nodeName){let i=this.Bt(t);if(i)return Array.from(i.document.querySelectorAll("*"))}return[]}static zt(t){if(!t)return"";let i="";switch(t.nodeName.toLowerCase()){case"embed":case"iframe":case"source":case"track":case"video":i=t.getAttribute("src")||"";break;case"a":case"area":case"link":i=t.getAttribute("href")||"";break;case"object":i=t.getAttribute("data")||""}if(!i){let e=Array.from(t.attributes).filter((t=>!(!t.name||-1===t.name.indexOf("url"))));i=e[0]&&e[0].value||""}return i.replace(/\/?$/,"")}static N(t,i){for(let e of t)if(e.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY)return!0;return!1}static Lt(t,i){let e=t.parentNode;for(;null!==e;){if(e===i)return!0;e=e.parentNode}return!1}static Ut(t,i,e){return new Promise(((s,n)=>{const r=document.createElement("script");if(r.async=!0,r.setAttribute("src",t),r.addEventListener("load",(()=>{s(o.Status.SUCCESS)})),r.addEventListener("error",(()=>{n(o.Status.ERROR)})),e){const t=this.Bt(i);t?t.document.body.appendChild(r):n(o.Status.ERROR)}else i.appendChild(r)}))}static Ht(t){const i=document.querySelector("#browsi-tag"),e=document.createElement("script");return i?(Array.from(i.attributes).forEach((t=>{t.nodeName&&t.nodeValue&&e.setAttribute(t.nodeName,t.nodeValue)})),e.setAttribute("async",""),t&&(e.setAttribute("sitekey",t),e.dataset.sitekey=t),document.head.appendChild(e),i):null}static Wt(t,i){return i<=0?0:Number((t/i).toFixed(2))}static qt(t,i){t=t.replace(/\/?$/,"");for(let e of Array.from(i.querySelectorAll("a")))if(-1!==this.zt(e).indexOf(t))return!0;return!1}static Gt(t){return!!t.textContent&&t.textContent.length>0}static isFixed(t){const i={active:!0,time:1500};if(t){const e=m.default.getCachedResult(t,"isFixed",i);if(e.valid)return e.result}let e=h.default.getExternalFlowHandler("isFixed");if(e)return e.call(this,t);if(t&&t!==document.body){if("fixed"===window.getComputedStyle(t).position)return m.default.storeCache(t,"isFixed",{status:!0,element:t},i),{status:!0,element:t};{const e=t.parentElement?this.isFixed(t.parentElement):{status:!1};return m.default.storeCache(t,"isFixed",e,i),e}}return{status:!1}}static Jt(t){const i={active:!0,time:1500};if(t&&t!==document.body){const e=m.default.getCachedResult(t,"isStickyElement",i);if(e.valid)return e.result;if("sticky"===window.getComputedStyle(t).position)return m.default.storeCache(t,"isStickyElement",!0,i),!0;{const e=!!t.parentElement&&this.Jt(t.parentElement);return m.default.storeCache(t,"isStickyElement",e,i),e}}return!1}static Xt(t,i){return!!i&&!!(t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_DISCONNECTED)}static isPositionedBefore(t,i){return!!i&&!!(t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_FOLLOWING)}static isPositionedAfter(t,i){return!!i&&!!(t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_PRECEDING)}static isPositionContained(t,i){return!!(t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINED_BY)}static Kt(t,i,e){return Math.abs(t-i)<=(e||0)}static Yt(t){return t==r.AdPositionType.STICKY_BOTTOM||t==r.AdPositionType.STICKY_TOP}static Qt(t){let i=encodeURIComponent(t).replace(/[\-\.\+\*]/g,"\\$&"),e=new RegExp("(?:(?:^|.*;)\\s*"+i+"\\s*\\=\\s*([^;]*).*$)|^.*$"),s=document.cookie.replace(e,"$1");return decodeURIComponent(s)||""}static ht(){const t=h.default.getExternalFlowHandler("getWindowHeight");return t?t():window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight}static _(){const t=h.default.getExternalFlowHandler("getPageYOffset");let i=t?t():window.pageYOffset||("CSS1Compat"===document.compatMode?document.documentElement.scrollTop:document.body.scrollTop);return l.default.hasDcsMc()&&(i-=this.J(l.default.getCurrentDcsElement(),!0).y),i}static Zt(){return this._()+this.ht()}static ti(t){const i=this.q()||1;return t=t||0,Math.round(t/i*100)}static ii(t){return!this.ei(t)||this._()>0||this.userEngaged}static ei(t){var i;return!!(null===(i=d.SpotsUtils.getConf(t.tags))||void 0===i?void 0:i.engagedUsers)&&t.optimizeViewability}static ni(t){return Object.keys(t).map((i=>i+"="+("object"==typeof t[i]?encodeURIComponent(JSON.stringify(t[i])):encodeURIComponent(t[i])))).join("&")}static hi(t,i){let e=document.createElement("style");e.type="text/css",document.getElementsByTagName("head")[0].appendChild(e),(e.sheet||{}).insertRule?e.sheet.insertRule(t+"{"+i+"}",0):(e.styleSheet||e.sheet).addRule(t,i)}static ci(t){return!(!t||!t.parentElement)&&(t.parentElement.removeChild(t),!0)}static ui(t){this.browsiEmbeddedPlacementsIds.push(t)}static F(){return this.browsiEmbeddedPlacementsIds}static vi(){return Math.floor(Date.now()/1e3)}static gi(){return Math.floor(Date.now())}static wi(t){return Array.from(t.querySelectorAll("SCRIPT"))}static _i(t){return 0===t.w&&0===t.h}static yi(t){return-1===t.w&&-1===t.h}static Si(t){return`${t[0]}x${t[1]}`}static Oi(t=""){const i=/^(\d+)x(\d+)$/.exec(t);return i&&3===i.length?{w:Number(i[1]),h:Number(i[2])}:{w:-1,h:-1}}static Ai(t){const i=t.getBoundingClientRect(),e=i.width*i.height,s=g.ji(i);return e>0&&s/e>=.15}static ji(t){const i=this.Ei(),e=this.G(),s=t.left+window.scrollX,n=t.right+window.scrollX,r=t.bottom+window.scrollY,o=t.top+window.scrollY;if(s>window.innerWidth||n<0||r<0||o>e)return 0;let h=t.width;s<0&&(h-=Math.abs(s)),n>i&&(h-=n-i);let a=t.height;return o<0&&(a-=Math.abs(o)),r>e&&(a-=r),h*a}static Ei(){return Math.max(window.document.body.scrollWidth,window.document.body.offsetWidth,window.document.documentElement.scrollWidth,window.document.documentElement.offsetWidth,window.document.documentElement.clientWidth)}static G(){var t,i;let e=h.default.getExternalFlowHandler("getPageHeight");return e?e():Math.floor(Math.max(null===(t=window.document.body)||void 0===t?void 0:t.scrollHeight,null===(i=window.document.body)||void 0===i?void 0:i.offsetHeight,window.document.documentElement.clientHeight,window.document.documentElement.scrollHeight,window.document.documentElement.offsetHeight))}static Ii(t){let i=window.getComputedStyle(t);return!!i&&("visible"===i.getPropertyValue("visibility")&&"none"!==i.getPropertyValue("display")&&"0"!==i.getPropertyValue("opacity"))}static Pi(t){return this.Ii(t)&&this.Ai(t)}static Mi(t){return t.head||t.getElementsByTagName("head")[0]}static M(){return`${window.document.location.protocol}//${window.document.location.host}${window.document.location.pathname}`}static Ti(){let t=window.document.location.search.substring(1).split("&");return 0===t.length?"":(t.length>10&&(t.length=10),t.join("&"))}static ki(t=document){const i=t.createElement("script");return i.async=!0,i.setAttribute("crossorigin","anonymous"),i}static Ri(t,i){try{localStorage.setItem(t,i)}catch(t){}}static xi(t){try{localStorage.removeItem(t)}catch(t){}}static Ci(t){try{return localStorage.getItem(t)||""}catch(t){}return""}static S(){let t=h.default.getExternalFlowHandler("getScrollListenElement");return t?t():window}static _t(){let t=h.default.getExternalFlowHandler("getBodyElementForScroll");return t?t():document.body}static Di(t){return t>=.85*this.L().height}static U(){let t=h.default.getExternalFlowHandler("viewportDetection");if(t){const i=t();if(i&&i.width&&i.height)return i}let i={width:0,height:0};return void 0!==window.innerWidth?(i.width=window.innerWidth,i.height=window.innerHeight):void 0!==document.documentElement&&void 0!==document.documentElement.clientWidth&&0!==document.documentElement.clientWidth&&(i.width=document.documentElement.clientWidth,i.height=document.documentElement.clientHeight),i.area=i.height&&i.width?i.height*i.width:0,i}static $i(){let t=this.q(),i=this.L().height;return{docHeight:t,viewPortHeight:i,numberOfFolds:t/i}}static Fi(t,i){const e=i&&i!=document.body?i:document;return document.evaluate(t,e,null,0,null)}static Ni(t,i,e){let s=[];if(t)for(let n=0;n<t.length;n++){let r=null;try{r=this.Fi(e?this.Vi(t[n]):t[n],i)}catch(t){return[]}if(r){let t=r.iterateNext();for(;t;)s.push(t),t=r.iterateNext()}}return s}static Vi(t){return this.startsWith("(",t)?t.replace("(","(."):"."+t}static Bi(t){let i=+new Date+""+Math.random();try{let e=t.contentWindow;return!!e&&(e[i]="asd","asd"===e[i])}catch(t){return!1}}static zi(t,i){for(let e=0;e<t.length;e++)if(t[e].indexOf(i)>-1)return!0;return!1}static Li(t){return t.filter((t=>t&&!t.isLazyLoading&&t.type!==c.SpotType.STICKY&&t.type!==c.SpotType.API))}static Ui(t,i,e=!0){let s=!1;return n=>{s||(e&&t(n),s=!0,setTimeout((()=>{s=!1,t(n)}),i))}}static xhrPromise(t,i,e){return new Promise(((s,n)=>{const r=new XMLHttpRequest;r.open(i||"GET",t,!0),r.onreadystatechange=function(){r.readyState==XMLHttpRequest.DONE&&(r.status>=200&&r.status<300?s(r):n(null))},"POST"===i&&e?r.send(e):r.send()}))}static clone(t){return JSON.parse(JSON.stringify(t))}static querySelectorOnDocument(t,i){let e=null;if(t instanceof HTMLIFrameElement){const i=this.Bt(t);i&&(e=i.document)}else t instanceof HTMLElement&&t.shadowRoot?e=t.shadowRoot:(t instanceof Document||t instanceof HTMLElement)&&(e=t);return e?Array.prototype.slice.call(e.querySelectorAll(i)).map((i=>({element:i,referer:t}))):[]}static avg(t,i){return i<=0?0:t/i}static getWeightedAvg(t,i,e,s){const n=i+s;return n>0?parseFloat(((t*i+e*s)/n).toFixed(2)):0}static getChildrenMaxHeight(t){let i=0;return Array.from(t.querySelectorAll(":scope > *")).forEach((t=>{i=Math.max(i,t.getBoundingClientRect().height)})),i}static getGAMResponseInfo(t,i){if(!t)return null==i?void 0:i.genericParams.gamInfo;{const i=t.getResponseInformation();if(i)return{oid:i.campaignId,lid:i.lineItemId||i.sourceAgnosticLineItemId}}}static getBrowsiTag(){return window.browsitag||null}static isValidStickyHeight(t){return t<=.3*this.L().height}static isValidStickySize(t){return this.isValidStickyHeight(t.h)&&t.w<=this.L().width}static dispatchDOMEvent(t,i,e){const s=new CustomEvent(t,{detail:i});return e.dispatchEvent(s),!0}static isBrowsiLoggerActive(){return!!a.Profiler.get().loaderParams.lp}static getPredictionToSend(t){var i;const e=null===(i=null==t?void 0:t.od)||void 0===i?void 0:i[50];return(null==e?void 0:e.sp)?e:void 0}static getDemandConfig(t){var i;return t.rt===p.ProviderType.HEADER_BIDDING?null===(i=t.c)||void 0===i?void 0:i.d:t.c}static isSraResponse(t){return t.rt===u.DemandRequestType.SRA}static splitAdUnit(t){const i=t.split("/");return{pubID:i[1],au:i.slice(2).join("/")}}static convertToOldStyleAdUnit(t){const i=this.getDemandConfig(t);if(!i)return t;const e=this.splitAdUnit(i.aup);return i.a.pubID=e.pubID,i.au=e.au,t}static convertToNewStyleAdUnit(t,i){const e=this.getDemandConfig(t);return e?(e.aup===i&&e.p!==p.ProviderType.GENERIC_JS&&(e.aup=`/${e.a.pubID}/${e.au}`),t):t}static startsWith(t,i){return 0===i.indexOf(t)}static injectMoat(t,i){if(t){const e=a.Profiler.get().deviceType;let s=new f.Moat({site_key:a.Profiler.get().siteKey,devicePlatform:e?e.devicePlatform:"",layout_id:a.Profiler.get().supplyConfigId,publisher_key:a.Profiler.get().publisherKey});this.Ut(s.getURL(),t,i).catch((t=>{v.default.get().sendErrorEvent(n.EventType.SCRIPT_LOAD_ERROR,s.getURL(),"moat")}))}}static getElementPercentageInViewport(t){const i=g.Z(t).y,e=g.ut(t).h,s=i+e,n=g.Et();let r;return s<n.top||i>n.bottom?0:s<=n.bottom&&i>=n.top?100:(r=s>n.bottom?n.bottom-i:s-n.top,100*Math.min(Number(r/e),1))}static getShadowRoot(t){let i=t;for(;11!=i.nodeType&&i.parentNode;)i=i.parentNode;return 11===i.nodeType?i:void 0}static generateUuid(t=""){return t?((Number(t)^16*Math.random())>>Number(t)/4).toString(16):"10000000-1000-4000-8000-100000000000".replace(/[018]/g,g.generateUuid)}static flattenArray(t){return t.reduce(((t,i)=>t.concat(i)),[])}static isChangingViewport(t){return g.Z(t).y<g.Et().bottom}}i.default=g,g.userEngaged=!1,g.browsiEmbeddedPlacementsIds=[]},5106:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.PUBLISHER_AD="publisher_ad",t.BROWSI_AD="browsi_ad",t.SA_TO_DENSTIY="sa_to_density"}(i.AdType||(i.AdType={}))},4465:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.BROWSI_SPOT="browsispot"}(i.CustomTagType||(i.CustomTagType={}))},5865:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.LOADED="loaded",t.STARTED="started"}(i.MiddyState||(i.MiddyState={}))},8515:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.BLOCKLIST="bl"}(i.RunMode||(i.RunMode={}))},6792:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.STANDARD="standard",t.SLIDES_ALL="slides_all",t.BROWSI_SPOTS="browsi_spots"}(i.SpotEngineType||(i.SpotEngineType={}))},4236:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.SUCCESS="success",t.FAILURE="failure",t.ERROR="error",t.NO_URL="No hb url was found",t.TIMEOUT="timeout",t.GENERIC_SNIPPET_ERROR="generic_snippet_error",t.NOT_SUPPORTED="not_supported"}(i.Status||(i.Status={}))},1082:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5540),r=e(4436),o=e(7899),h=e(6389),a=e(7016),l=e(1482);class c{constructor(){this.logger=new s.default("RefreshRate"),this.profile=h.Profiler.get()}static get(){return c.instance||(c.instance=new c),c.instance}sendCustomRefreshRate(t,i){let e="";if(t===o.DemandRequestType.SINGLE)if(i&&1===i.length){const t=i[0];e=this.buildRefreshRateSingleUrl(t)}else this.logger.error(`invalid slots params ${i}`);else i&&t===o.DemandRequestType.SRA&&(e=this.buildRefreshRateSRAUrl(i));e?this.refreshRateXhrRequest(e):this.logger.error("error building get custom refresh rate url")}refreshRateXhrRequest(t){n.default.xhrPromise(t,"GET").then((i=>{if(200===i.status){const t=JSON.parse(i.responseText);Array.isArray(t)?t.map((t=>l.ViewabilityService.instance.handleCustomRefreshResponse(t))):l.ViewabilityService.instance.handleCustomRefreshResponse(t)}else r.default.get().sendErrorEvent(a.EventType.XHR_ERROR,t,"get refresh rate failed"),this.logger.error(`Error on get refresh rate. url: ${t}`)})).catch((i=>{r.default.get().sendErrorEvent(a.EventType.XHR_ERROR,t,(null==i?void 0:i.message)||"get refresh rate failed"),this.logger.error("error on xhr promise",i)}))}buildRefreshRateSingleUrl(t){let i=Object.assign(Object.assign(Object.assign(Object.assign({pk:this.profile.publisherKey,sk:this.profile.siteKey,t:n.default.gi()},t.au?{au:t.au}:{}),t.id?{id:t.id}:{}),t.lid?{lid:t.lid}:{}),t.oid?{oid:t.oid}:{});return`//${this.profile.demandHost}/refreshrate/single/mobile?${n.default.ni(i)}`}buildRefreshRateSRAUrl(t){let i=Object.assign({pk:this.profile.publisherKey,sk:this.profile.siteKey,t:n.default.gi()},this.buildRefreshRateSRAParams(t));return`//${this.profile.demandHost}/refreshrate/sra/mobile?${n.default.ni(i)}`}buildRefreshRateSRAParams(t){let i={};return t.map(((e,s)=>{const n=this.buildRefreshRateSRASpotParams(e);for(let e in n)i[e]=i[e]||[],i[e].push(n[e]),s+1===t.length&&(i[e]=i[e].join("||"))})),i}buildRefreshRateSRASpotParams(t){return Object.assign(Object.assign(Object.assign(Object.assign({},t.au?{au:t.au}:{}),t.id?{id:t.id}:{}),t.lid?{lid:t.lid}:{}),t.oid?{oid:t.oid}:{})}}i.CustomRefreshRate=c},5330:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(8562),r=e(2661),o=e(1573),h=e(9150),a=e(208),l=e(470),c=e(5780),d=e(5353),u=e(6389),f=e(4524),v=e(5662),p=e(4236),m=e(2797),g=e(7415),b=e(6448),w=e(1482),_=e(4042),y=e(5690),S=e(9008),O=e(549),A=e(7966),j=e(83),E=e(3486),I=e(1363),P=e(1511);i.DemandManager=class{constructor(){this.demandIndexLimit=99,this.logger=new r.default("Demand"),this.SRAState={[d.SpotType.API]:{nextDemandConfig:0,smallestAllowedAdIndex:0}},this.demandCounter=-1}updateSRAState(t){t.forEach((t=>{let i=t.tags;const e=t.type;if(E.default.isFixedSpot(i)){const i=t.selector;this.SRAState[e]=this.SRAState[e]||{},this.SRAState[e][i]||(this.SRAState[e][i]={nextDemandConfig:0,smallestAllowedAdIndex:0})}else this.SRAState[e]||(this.SRAState[e]={nextDemandConfig:0,smallestAllowedAdIndex:0})}))}getSpotSRAState(t){return this.shouldRelocateAPI(t)||2===t.relocationStatus?this.SRAState[d.SpotType.API]:t instanceof I.FixedSpot?this.SRAState[t.type][t.selector]:this.SRAState[t.type]}waitForFetching(t,i){return new Promise(((e,s)=>{if(t.isLazyLoading&&!t.isRefreshing()&&f.default.isLazySpotsEnabled()){f.default.getLazySpotsInstance().subscribe(t,(()=>this.Hi(t,i,e,s)),(()=>this.Wi(t,i)))}else this.Hi(t,i,e,s)}))}getSpotAdUnit(t,i){var e;const n=s.default.getDemandConfig(i);return(null===(e=t.options)||void 0===e?void 0:e.adUnit)||(null==n?void 0:n.aup)||"NA"}Hi(t,i,e,r){var h;if(t.disableDemand)return void this.logger.info(`spot ${t.spotIndex} is disabled. blocked`);let l=this.getCandidateResponseForSpot(i,t);if(l){const c=this.getViolations(t,l);if(c.length)t.qi(c),1===c.length&&"out_of_focus"===c[0].reason&&n.default.instance.waitForUserFocus().then((()=>this.Hi(t,i,e,r)));else{const n=l;s.default.isSraResponse(i)&&(this.shouldRelocateAPI(t)&&t.Gi(A.DemandTool.get().relocateSpots.shift()),this.confirmResponseForSpot(t));const c=P.InframeManager.get(),d=c.shouldFetchDynamicVideo(t.isRefreshing(),t.type)&&c.hasVideoDemand(t),u=o.ProviderFactory.generateProvider(d?{rt:"inframe",plk:n.plk}:n,t),f=a.EmbeddingFactory.getEmbedder(n,t);u&&f?(this.logger.info(`spot ${t.spotIndex} matched to demand ${d?"video":t.demandIndex}`,n),t.Ji(n),t.selectedSizes=(null===(h=t.options)||void 0===h?void 0:h.sizes)||n.szs,e({provider:u,embedder:f,matchedResponse:n})):(this.logger.error("unknown provider/embedder"),r("unknown provider/embedder"))}}else this.logger.info(`no demand for spot ${t.spotIndex}`)}confirmResponseForSpot(t){const i=this.getSpotSRAState(t);t.demandIndex=i.nextDemandConfig,i.nextDemandConfig<this.demandIndexLimit&&i.nextDemandConfig++,i.smallestAllowedAdIndex=t.typeIndex}getCandidateResponseForSpot(t,i){let e=null;return s.default.isSraResponse(t)?i.typeIndex>=this.getSpotSRAState(i).smallestAllowedAdIndex&&this.hasUnusedDemandResponses(t,i)&&(e=this.getNextDemandResponses(t,i)):e=t,e}hasUnusedDemandResponses(t,i){return!!this.nextDemandResponses(t,i)}getNextDemandResponses(t,i){return s.default.clone(this.nextDemandResponses(t,i))}nextDemandResponses(t,i){const e=e=>{if(e)return e.od=t.ods[i.spotIndex],e},s=this.getSpotSRAState(i);return O.FIXED_TYPES.includes(i.type)?e(t.fc[i.selector]&&t.fc[i.selector][s.nextDemandConfig]):this.shouldRelocateAPI(i)?e(t.ac[s.nextDemandConfig]):e(t.c[s.nextDemandConfig])}shouldRelocateAPI(t){return t.type===d.SpotType.DYNAMIC&&!!A.DemandTool.get().relocateSpots.length}Xi(t,i){if(t=this.fillAPIResponse(t,i)){const e=[];i.forEach((i=>{i.Ki>=2&&o.ProviderFactory.setSpotProviderName(t,i),e.push(this.waitForUserEngagement(i).then((()=>{this.waitForFetching(i,t).then((t=>{this.demandCounter--,0===this.demandCounter&&S.default.get().onStopEngine(),this.Yi(t.provider,t.embedder,t.matchedResponse,i)})).catch((t=>{y.YieldClient.get().handleWaterfallFailed(t,i,null)}))})))}))}else this.logger.info(`Waterfall ended for spot ${i.map((t=>t.spotIndex)).join(", ")}`),i.forEach((t=>{t.Qi()}))}fillAPIResponse(t,i){if(t){if(s.default.isSraResponse(t)){const i=Object.keys(t.ac);for(let e=0;e<i.length;e++)if("empty"===t.ac[i[e]].rt){const s=A.DemandTool.get().relocateSpots[e];if(!s||!this.canFakeResponse(s))return null;t.ac[i[e]]=this.getFakeApiResponse(s.options,s.sizes)}return t}return t}return this.canFakeResponse(i[0])?this.getFakeApiResponse(i[0].options,i[0].sizes):null}canFakeResponse(t){return!!(1==t.Ki&&t.options&&t.options.adUnit&&t.options.sizes)}getFakeApiResponse(t,i){return{rt:"empty_api",c:{a:{autoSize:!0,inIframe:!1},aup:t.adUnit,p:""},plk:"",szs:i}}waitForUserEngagement(t){return new Promise((i=>{if(s.default.ii(t)||t.isEagerFirstFold())return i();{const t=()=>{this.logger.info("detected scroll, fetching"),v.default.get().removeListener("scroll",s.default.S(),t),s.default.userEngaged=!0,i()};v.default.get().listen("scroll",s.default.S(),t)}}))}Yi(t,i,e,n){n.setPlaceholderSize(e.szs),e=n.Zi(e),t.Yi(e,i).then((r=>{var o,h;if(s.default.isBrowsiLoggerActive()){const t=this.buildLoggerData(n,r);window.dispatchEvent(new CustomEvent("fetch_end",{detail:t}))}let a=!1;switch((r.refresh||n.refresh)&&(r.status!==p.Status.SUCCESS&&n.ie(),a=!0),this.logger.logWaterfallDetails(n,e,r.status?r.status.toString():r.toString()),r.status){case p.Status.TIMEOUT:case p.Status.FAILURE:case p.Status.NOT_SUPPORTED:case p.Status.NO_URL:n.destoryDFPSlot(),(null===(o=n.refresh)||void 0===o?void 0:o.noDemandRefresh)?this.handlSpotWithoutDemand(n,t,r,e):null===(h=n.refresh)||void 0===h||h.stopRefreshing(),a||r.refresh||y.YieldClient.get().getNextDemandFromYield(n);break;case p.Status.SUCCESS:this.ee(n,t,i,r,e)}})).catch((t=>{y.YieldClient.get().handleWaterfallFailed(t,n,e)}))}handlSpotWithoutDemand(t,i,e,s){const n=this.getAdditionalFields(e,s);this.runPostFetch(t,s),this.subscribeToViewabilityService(t,i,s,n)}ee(t,i,e,s,n){var r,o,a;const l=this.getAdditionalFields(s,n);if(null===(r=t.placeholder)||void 0===r||r.removePlaceholderStyle(t.newBrowsiAd),t.providerName!=m.ProviderType.DFP){new g.default(t,l.adUnit,n.plk).waitForSpotMeasurable()}"s"!==t.tags.positionTag?t.positionType=b.default.instance.getAdPositionType(t.newBrowsiAd?t.newBrowsiAd.adWrapper:void 0):e.se(t,null===(o=t.newBrowsiAd)||void 0===o?void 0:o.adWrapper),this.ne(u.Profiler.get().moatPercentage)&&e.re(t),t.oe(),h.Embedder.he(t),(null===(a=u.Profiler.get().uxFixes)||void 0===a?void 0:a.fixWiderAds)&&this.fixWiderAds(t),this.runPostFetch(t,n),i.ae(l.adUnit,n.plk),t.providerName!==m.ProviderType.GENERIC_JS&&t.providerName!==m.ProviderType.INFRAME&&i.ce(t),this.subscribeToViewabilityService(t,i,n,l),this.logger.info(`added ${t.providerName}: `,t.newBrowsiAd?t.newBrowsiAd.adWrapper:void 0)}subscribeToViewabilityService(t,i,e,s){if(i.de()){const i=t.type===d.SpotType.STICKY||"s"===t.tags.positionTag;f.default.isCustomRefreshConfigured()&&t.initCustomRefreshRate(),w.ViewabilityService.instance.subscribe(t.ue(s),_.ViewabilityConfigurations.vConfig(i),e)}}ne(t){return Math.floor(100*Math.random())<t}runPostFetch(t,i){var e;const n=f.default.getExternalFlowHandler("postFetch");if(n){const r=null===(e=s.default.getDemandConfig(i))||void 0===e?void 0:e.aup;n(t,i=s.default.convertToOldStyleAdUnit(i)),i=r?s.default.convertToNewStyleAdUnit(i,r):i}}fe(t){return t.args||{}}getAdditionalFields(t,i){var e;const n=this.fe(t),r=(null===(e=s.default.getDemandConfig(i))||void 0===e?void 0:e.aup)||"",o=n.adUnit?n.adUnit:r;return n.adUnit=o,n}ve(t){if("fi"===t.tags.typeTag&&u.Profiler.get().fixedSpotsFirst)return null;const i=l.default.get().isStayAwayViolated(t);return i?{reason:"stay_away",message:i.distance.toString()}:null}pe(t){var i;if(t.type!=d.SpotType.DYNAMIC||!A.DemandTool.get().relocationActive)return null;const e=j.default.getSpots().filter((t=>t.type===d.SpotType.API&&1!==t.relocationStatus&&!s.default.isFixed(t.ref).status)),n=null===(i=u.Profiler.get().spotsSupplyParams.dynamic)||void 0===i?void 0:i.distance;if(!n)return null;return e.some((i=>{const e={element:i.ref,height:s.default.ut(i.ref).h};return l.default.get().getSaDistance(t.ref,e)<n}))?{reason:"api_sa",message:""}:null}checkCLSViolation(t){let i=!1;const e=O.SpotsUtils.getConf(t.tags);return e&&"avoidCLS"in e&&e.avoidCLS&&(i=s.default.isChangingViewport(t.ref)),i?{reason:"CLS",message:""}:null}me(t,i){return c.default.instance.canEmbedAd(t,i)?null:{reason:"density",message:`${c.default.instance.getTotalAdDensity()}/${c.default.instance.densityCap}`}}ge(t,i){var e,s;const n=O.SpotsUtils.getViewabilityThreshold(t);if(n){const t=(null===(s=null===(e=null==i?void 0:i.od)||void 0===e?void 0:e[50])||void 0===s?void 0:s.p)&&Number(i.od[50].p);if(t&&t>0&&t<n)return{reason:"prediction_threshold",message:""}}return null}Wi(t,i){if(!t.disableDemand&&(!s.default.isSraResponse(i)||this.hasUnusedDemandResponses(i,t))){const e=this.getCandidateResponseForSpot(i,t);if(e){const i=this.getViolations(t,e),n=[{reason:"lazy_ad_missed",message:`${s.default.Tt(2)}`}].concat(i);t.qi(n)}}}getViolations(t,i){const e=[];if(this.isSpotNotExist(t)&&e.push({reason:"spot_not_exists",message:""}),t.type===d.SpotType.STICKY)return t.sizes.length||e.push({reason:"no_compatible_sizes",message:""}),e;const s=t.optimizeViewability&&this.ge(t.tags,i);s&&e.push(s);const r=t.isRefreshing()?null:this.checkCLSViolation(t);if(r&&e.push(r),t.type===d.SpotType.API)return e;const o=t.isRefreshing()?null:this.ve(t),h=t.isRefreshing()?null:this.me(t,i.szs),a=t.isRefreshing()?null:this.pe(t);return n.default.instance.isHidden&&e.push({reason:"out_of_focus",message:""}),o&&e.push(o),h&&e.push(h),a&&e.push(a),e}isSpotNotExist(t){var i;if(null===(i=t.options)||void 0===i?void 0:i.shadowElement){const i=t.options.shadowElement,e=s.default.getShadowRoot(i);return!!e&&s.default.Xt(i,e)}return s.default.Xt(t.ref,document.body)}fixWiderAds(t){var i,e,s,n;const r=(null===(i=t.newBrowsiAd)||void 0===i?void 0:i.iframe)||(null===(e=t.newBrowsiAd)||void 0===e?void 0:e.adContainer),o=null==r?void 0:r.getBoundingClientRect();if(o&&r){const i=o.width-((null===(s=t.implementedSize)||void 0===s?void 0:s.w)||0),e=((null===(n=t.implementedSize)||void 0===n?void 0:n.w)||0)+o.x;if(i<0){const t=i/2;r.style.marginLeft=t+"px",r.style.marginRight=t+"px"}else if(0===i&&o.x>0&&window.screen.availWidth<e){const t=-o.x;r.style.marginLeft=t+"px"}}else;}buildLoggerData(t,i){var e,n,r,o;const h=s.default.getGAMResponseInfo(t.slot);let a=(null===(e=t.slot)||void 0===e?void 0:e.getSizes())||[];const l=null==a?void 0:a.map((t=>{if("string"==typeof t)return t;const i=Object.keys(t);return{w:+t[i[0]],h:+t[i[1]]}}));return Object.assign(Object.assign({demandType:t.providerName,placement:null===(n=t.newBrowsiAd)||void 0===n?void 0:n.adContainer,adUnit:null===(r=t.slot)||void 0===r?void 0:r.getAdUnitPath(),requestedSizes:l,targeting:null===(o=t.slot)||void 0===o?void 0:o.getTargetingMap(),responseSize:t.implementedSize||null,refreshCount:t.refreshCount||0,orderId:(null==h?void 0:h.oid)||null,lineItemId:(null==h?void 0:h.lid)||null},t.providerName===m.ProviderType.DFP||t.providerName===m.ProviderType.GENERIC_JS?{}:{winner:i.status===p.Status.SUCCESS?"GAM":"NONE"}),i.status!==p.Status.SUCCESS?{noFill:!0}:{})}isSaas(t){const i=s.default.getDemandConfig(t);if(!i)return!1;const e=s.default.splitAdUnit(i.aup);return"57778053"!==(null==e?void 0:e.pubID)}}},4669:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(4436),r=e(9150),o=e(8867),h=e(7016),a=e(2338),l=e(6389),c=e(5353),d=e(83),u=e(4141),f=e(1675),v=e(4524),p=e(549),m=e(9504),g=e(5673),b=e(4236);class w{constructor(t){this.spot=t,this.we=window;const i=f.default.getDcsActionCounter();this._e=`${t.spotIndex}_ai_${t.Ki?t.Ki:1}_rc_${t.refreshCount}${i&&i>0?`_dcs_${i}`:""}`;const e=l.Profiler.get().predictorsKeyValueNames;this.ye=e.viewability50}Se(){const t=this.spot.getQueryBaseElement(),i=f.default.getDcsActionCounter(),e=`browsi_wrapper_${`${this.spot.spotIndex}_ai_${this.spot.Ki?this.spot.Ki:1}_rc_${this.spot.refresh?this.spot.refresh.lastSuccessfulRefresh:0}${i&&i>0?`_dcs_${i}`:""}`}`;return t.querySelector(`#${e}`)||void 0}Oe(t,i,e,s,n){(1===this.spot.Ki||this.spot.isRefreshing())&&(this.spot.fetchStartTime=Date.now()),this.Ae(t,i,e,s,n),1==this.spot.Ki&&o.default.get().increment(h.EventType.AD_REQUEST)}Ae(t,i,e,s,r){n.default.get().Oe(this.spot,t,i,this.getSizesByOrder(e),s,r)}je(t,i,e,s,r){e&&e.includes(b.Status.GENERIC_SNIPPET_ERROR)&&n.default.get().sendErrorEvent(h.EventType.GENERIC_ERROR,"",r||"",e),this.Ee(i,t.c.aup,t.plk,e,s,r)}Ee(t,i,e,s,r,o){n.default.get().Ie(this.spot,t,i,e,s,null,r,o)}ae(t,i){this.Pe(t,i)}Pe(t,i){var e,n;const r=s.default.getGAMResponseInfo(this.spot.slot,this.spot);let h=!1;l.Profiler.get().sendBrowsiImpressionDOMEvent&&(h=this.Me(t)),this.Te(t,i,h,r),null===(e=this.spot.refresh)||void 0===e||e.handleSuccess(),this.spot.fetchStartTime&&(this.spot.fetchLatency=Math.min(Date.now()-this.spot.fetchStartTime,5e3));const a=(null===(n=this.spot.refresh)||void 0===n?void 0:n.count)||0;o.default.get().browsiImpression(this.spot.fetchLatency||-1,a)}Te(t,i,e,s){n.default.get().ae(this.spot,t,i,e,s)}Me(t){var i,e;const n={element:this.spot.newBrowsiAd.adContainer,adUnit:(null===(i=this.spot.slot)||void 0===i?void 0:i.getAdUnitPath())||t,refreshCount:(null===(e=this.spot.refresh)||void 0===e?void 0:e.count)||0};return s.default.dispatchDOMEvent(g.BROWSI_IMPRESSION_DOM_EVENT_NAME,n,window)}useOriginalSizes(t){if(this.spot.type===c.SpotType.STICKY)return p.SpotsUtils.getConf(this.spot.tags).useOriginalSizes;const i=v.default.getExternalFlowHandler("useOriginalSizes");return!!i&&i(Object.assign({},t))}ke(t){if(this.spot.isRefreshing()){return this.useOriginalSizes(this.spot)?this.spot.selectedSizes.map((i=>this.Re(t,i))):this.Re(t,this.spot.implementedSize)}return this.spot.selectedSizes.filter((i=>t||!s.default._i(i))).map((i=>this.Re(t,i)))}Re(t,i){const e=s.default._i(i);return t?e?["fluid"]:[i.w,i.h]:e?[]:[i.w,i.h]}xe(t,i,e){const s=v.default.getExternalFlowHandler("preAuction");s&&s(t,i,e)}Ce(t){var i;const e=v.default.getExternalFlowHandler("preFetchAsync"),n=v.default.getExternalFlowHandler("preFetch");if(n||e){const r=null===(i=s.default.getDemandConfig(t))||void 0===i?void 0:i.aup;return new Promise(((i,r)=>(t=s.default.convertToOldStyleAdUnit(t),e?void e(this.spot,t,i,r,this):(n&&n(this.spot,t,this),i())))).then((()=>{t=r?s.default.convertToNewStyleAdUnit(t,r):t}))}return Promise.resolve()}De(t,i){if(!i)return Promise.reject("No Config");i=this.updateAmazonBidderConfig(i);const e=t.win;if(t.iframe)return this.$e(e,i,t);if(w.isApstagInitCalled)return Promise.resolve(t);if(e.apstag&&"function"==typeof e.apstag.fetchBids){try{const t=this.getApsInitConfig(i);e.apstag.init(t),w.isApstagInitCalled=!0}catch(t){this.Fe.error("could not init publisher apstag",t)}return Promise.resolve(t)}return w.Ne||(w.Ne=this.$e(e,i,t)),w.Ne.then((()=>(this.Fe.info("Using browsi injected apstag"),t)))}updateAmazonBidderConfig(t){const i=v.default.getExternalFlowHandler("preApsInit");return i?i(t):t}getApsInitConfig(t){return{adServer:t.adServer,pubID:t.pubID,simplerGPT:t.simplerGPT}}$e(t,i,e){return this.Fe.info("Injecting apstag"),new Promise(((s,r)=>{const o=t.document.createElement("script");o.async=!0;const a="//c.amazon-adsystem.com/aax2/apstag.js";o.setAttribute("src",a),o.addEventListener("load",(()=>{if("function"==typeof t.apstag.init){const e=this.getApsInitConfig(i);t.apstag.init(e)}s(e)})),o.addEventListener("error",(()=>{n.default.get().sendErrorEvent(h.EventType.SCRIPT_LOAD_ERROR,a,"apstag"),r(e)})),t.document.head.appendChild(o)}))}Ve(t){var i;return(null===(i=t.win.googletag)||void 0===i?void 0:i.apiReady)?Promise.resolve(t):new Promise(((i,e)=>{const n=document.createElement("script");n.async=!0,n.setAttribute("src","https://securepubads.g.doubleclick.net/tag/js/gpt.js"),n.addEventListener("load",(()=>{i(t)})),n.addEventListener("error",(()=>{e(t)})),s.default.Mi(t.win.document).appendChild(n)}))}Be(){const t=this.useOriginalSizes(this.spot);return this.spot.isRefreshing()&&this.spot.implementedSize&&!t?this.spot.isFluid?["fluid"]:[this.spot.implementedSize.w,this.spot.implementedSize.h]:this.ke(!0)}ze(t,i){return t.slot&&t.slot.getSlotElementId()===i}ce(t){if(l.Profiler.get().adInViewport&&!(t.refreshCount>0)&&t.newBrowsiAd){const i=50+(t.newBrowsiAd.adMarking?s.default.ut(t.newBrowsiAd.adMarking).h:0),e=t.newBrowsiAd.adWrapper;if(s.default.ut(e).h>i)this.Le(e,t);else{const n=new a.default(e);n.addResizeListener((()=>{s.default.ut(e).h>i&&(n.removeResizeListener(),this.Le(e,t))}))}}}Le(t,i){const e=s.default.getElementPercentageInViewport(t);e&&n.default.get().sendAdInViewport(i,e)}Ue(t){return s.default.H(t.p)?"NA":t.p>=0?(Math.floor(10*t.p)/10).toFixed(2):"NA"}He(t,i){i.forEach((i=>{t.setTargeting(i.key,i.value)}))}We(t,i){if(!t.v)return[];const e=this.spot.newBrowsiAd.win.googletag;if(e&&e.pubads&&-1!=e.pubads().getTargetingKeys().indexOf(i))return[];if(!t.j)return t.v;try{return this.we.eval(t.v&&t.v[0])||[]}catch(t){return[]}}qe(){const t=this.Ge||this.spot.refresh&&this.spot.refresh.stickyRefresh&&this.spot.refresh.oldBrowsiAd&&this.spot.refresh.oldBrowsiAd.adWrapper;t&&(r.Embedder.Je(t),s.default.ci(t))}Xe(){return!1}Ke(){return this.spot.spotRequested>this.spot.Ki&&!this.spot.isRefreshing()}Ye(t){return t&&"true"===t.autoSize}Qe(t){const i=Array.isArray(t.setTargeting)?t.setTargeting:[],e=s.default.getPredictionToSend(t);if(e&&i.push({key:this.ye,value:this.Ue(e)}),this.spot.refresh&&this.spot.refresh.isRefreshing&&!this.spot.refresh.stickyRefresh){this.spot.refresh.keyValues&&i.push({key:"browsiRefresh",value:"True"})}const n=t.c.pgkv||t.c&&t.c.d&&t.c.d.pgkv||{},r=Object.assign(s.default.clone(l.Profiler.get().pageKeyValues||{}),s.default.clone(n||{}));for(let t in r){const e=this.We(r[t],t);e.length&&i.push({key:t,value:e})}return i}de(){var t;if(this.spot.type!==c.SpotType.STICKY)return!0;const i=s.default.ut(this.spot.browsiAd);return s.default.isValidStickyHeight(i.h)?((null===(t=p.SpotsUtils.getConf(this.spot.tags))||void 0===t?void 0:t.location)===u.Location.TOP?window.document.body.style.paddingTop=i.h+"px":window.document.body.style.paddingBottom=i.h+"px",!0):(d.default.removeStickyAd(this.spot),this.Fe.info("sticky ad removed,",i.h," is over 30%"),!1)}setGoogleTagPrivacy(t){if(!m.default.hasUserConsent){const i=m.default.getCurrentConsentType();"ccpa"===i?t.pubads().setPrivacySettings({restrictDataProcessing:!0}):"gdpr"===i&&t.pubads().setRequestNonPersonalizedAds(1)}}getSizesByOrder(t){return Array.isArray(t[0])?t.sort(((t,i)=>{if("fluid"===t[0])return-1;if("fluid"===i[0])return 1;try{const e=t[0],s=i[0];return e===s?t[1]-i[1]:e-s}catch(t){return-1}})).map((t=>"fluid"===t[0]?"fluid":t[0]+"x"+t[1])).join("|"):t.join("x")}}i.Provider=w,w.isApstagInitCalled=!1},1573:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(1297),n=e(2797),r=e(5600),o=e(3137),h=e(4830);i.ProviderFactory=class{static generateProvider(t,i){switch(this.setSpotProviderName(t,i)){case n.ProviderType.INFRAME:return new h.Inframe(i,t.plk);case n.ProviderType.HEADER_BIDDING:return new o.HeaderBidding(i);case n.ProviderType.DFP:return i.providerName=n.ProviderType.DFP,new s.DFP(i);case n.ProviderType.GENERIC_JS:const e=t;return new r.GenericJs(i,e)}return null}static setSpotProviderName(t,i){var e;switch(i.genericParams.displayName=void 0,null==t?void 0:t.rt){case n.ProviderType.INFRAME:i.providerName=n.ProviderType.INFRAME;break;case n.ProviderType.HEADER_BIDDING:i.providerName=n.ProviderType.HEADER_BIDDING;break;case"empty_api":i.providerName=n.ProviderType.DFP;break;case"provider":const s=t;switch((null===(e=s.c.a)||void 0===e?void 0:e.template)&&(i.providerName=n.ProviderType.GENERIC_JS,i.genericParams.displayName=s.c.a.template.p),s.c.p){case n.ProviderType.DFP:i.providerName=n.ProviderType.DFP;break;case n.ProviderType.GENERIC_JS:i.providerName=n.ProviderType.GENERIC_JS}}return i.providerName||null}}},5690:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5540),r=e(7899),o=e(5330),h=e(4236),a=e(6389),l=e(5353),c=e(4524),d=e(4436),u=e(1675),f=e(8867),v=e(549),p=e(9504),m=e(7966),g=e(7016),b=e(1511),w=e(2797);class _{constructor(){this.logger=new s.default("YieldClient"),this.profile=a.Profiler.get(),this.demandManager=new o.DemandManager,this.isHidden="hidden"===document.visibilityState}static get(){return _.instance||(_.instance=new _),_.instance}Ze(t){const i=b.InframeManager.get();t.some((t=>t.type===l.SpotType.DYNAMIC))&&i.isInframeConfigured()&&(i.addPotentialSpots(t),i.sendPotentialSpots()),this.demandManager.updateSRAState(t),this.runPreDemand(t),this.prepareSpotsForAPIRelocation(t).then((t=>{this.demandManager.demandCounter=t.filter((t=>!t.isLazyLoading)).length,t.length&&this.ns(t,r.DemandRequestType.SRA)}))}prepareSpotsForAPIRelocation(t){return new Promise((i=>{const e=m.DemandTool.get().relocateSpots;if(!m.DemandTool.get().relocationActive||!e.length)return i(t);const s=t.filter((t=>t.type===l.SpotType.DYNAMIC));if(!(s.length<e.length))return i(t);e.forEach((t=>{t.relocationStatus=-1})),m.DemandTool.get().proceedRelocation(!1).then((()=>{var e;return s.length&&!(null===(e=v.SpotsUtils.getConf(s[0].tags))||void 0===e?void 0:e.maxItems)?(s.forEach((t=>{d.default.get().sendAdRequestBlockedEvent(t,"relocation_fail","")})),i(t.filter((t=>t.type!==l.SpotType.DYNAMIC)))):i(t)})).catch((e=>(this.logger.error("error while resolving relocation",e),i(t))))}))}ns(t,i){if(this.profile.analysisMode)return;let e="";if(t[0].isRefreshing()&&!!this.profile.blockLineItemIds||i===r.DemandRequestType.SINGLE)if(1===t.length){const i=t[0];e=this.buildGetDemandUrl(i)}else this.logger.error("invalid spots list",t);else i===r.DemandRequestType.SRA&&(e=this.buildGetSRADemandUrl(t));e?this.hs(e,t):this.logger.error("error building demand url",t)}hs(t,i){if(this.profile.analysisMode)return;const e=[...i];n.default.xhrPromise(t,"GET").then((s=>{var n,r,o;if(204===s.status)this.demandManager.Xi(null,e);else if(202===s.status)this.handleRefreshBlocked(e);else if(200===s.status){const t=JSON.parse(s.responseText),i=this.convertDemand(t);1===e.length&&(null===(n=e[0].refresh)||void 0===n?void 0:n.isGenericRefresh(e[0]))?null===(o=(r=e[0].genericParams).refresh)||void 0===o||o.call(r,i):(b.InframeManager.get().isInframeConfigured()&&"SRA"===t.rt&&b.InframeManager.get().setTotalVideosToEmbedCount(i),this.runPostDemand(i,e),this.demandManager.Xi(i,e))}else d.default.get().sendErrorEvent(g.EventType.XHR_ERROR,t,"get demand failed"),this.logger.error(`Error on get demand. url:${t},spots ${i}`)})).catch((i=>{d.default.get().sendErrorEvent(g.EventType.XHR_ERROR,t,(null==i?void 0:i.message)||"get demand failed"),this.logger.error("error on xhr promise",i)}))}convertDemand(t){return function(t){return"SRA"===t.rt}(t)?this.convertSRADemand(t):this.convertSingleDemand(t)}convertSRADemand(t){const i=t=>{const i={};for(let e in t)i[e]=this.convertSingleDemand(t[e]);return i};return{rt:"SRA",ods:(t=>{const i={};for(let e in t)i[e]={50:t[e]};return i})(t.ps),c:t.c.c?i(t.c.c):{},fc:(t=>{const i={};for(let e in t){i[e]={};for(let s in t[e])i[e][s]=this.convertSingleDemand(t[e][s])}return i})(Object.assign({},t.c.fc||{},t.c.fb||{},t.c.ft||{})),ac:t.c.ac?i(t.c.ac):{}}}convertSingleDemand(t){var i;let e=Object.assign({rt:"header_bidding"===t.rt?"header_bidding":"provider",setTargeting:t.setTargeting,plk:t.plk,szs:t.c.szs},t.p?{od:{50:t.p}}:{});return"header_bidding"===t.rt?(e.c=Object.assign({if:t.c.if,t:t.c.hb?t.c.hb.t:(null===(i=t.c.tam)||void 0===i?void 0:i.t)||0,ri:{kv:!0,do:!1,r:t.c.rr||-1,l:t.c.mr||0,nd:!!t.c.ndr}},t.c.hb?{b:t.c.hb.b.map((t=>Object.assign(Object.assign({},t.a?{a:t.a}:{}),{bc:{bidder:t.c,params:t.p}})))}:{}),t.c.gam&&(e.c.d=s())):e.c=s(),e;function s(){const i=t.rt===w.ProviderType.GENERIC_JS;return Object.assign(Object.assign({a:Object.assign(Object.assign({upc:"true",autoSize:"true"},i?{url:t.c.u,withCallback:t.c.c?"true":"false",isJS:t.c.js?"true":"false",template:t.c.tm}:{}),{inIFrame:t.c.if?"true":"false"})},t.c.tam?{tam:{adServer:t.c.tam.a,pubID:t.c.tam.p,slotName:t.c.tam.s||t.c.gam.au,timeout:t.c.tam.t,simplerGPT:!!t.c.tam.sgpt}}:{}),i?{p:w.ProviderType.GENERIC_JS,aup:t.c.au||"",ri:{kv:!0,do:!1,r:t.c.rr||-1,l:t.c.mr||0,nd:!!t.c.ndr},t:t.c.t,pgkv:t.c.slt?n(t.c.slt):{}}:{aup:t.c.gam.au,ri:{kv:!0,do:!1,r:t.c.rr||-1,l:t.c.mr||0,nd:!!t.c.ndr},p:"dfp",pgkv:t.c.gam?n(t.c.gam.t):{}})}function n(t){const i={};return t.forEach((t=>{i[t.k]={v:t.v,j:t.j}})),i}}buildGetSRADemandUrl(t){let i=Object.assign(Object.assign(Object.assign({},this.ls(t[0].isDcs)),{ac:u.default.getDcsActionCounter()}),this.buildPotentialSpotsParams(t));if(m.DemandTool.get().relocateSpots.length){const t=[],e=[];m.DemandTool.get().relocateSpots.forEach((i=>{var s;t.push(i.ref.id),e.push((null===(s=i.options)||void 0===s?void 0:s.adUnit)||"")})),i.div=t.join("||"),i.au=e.join("||")}return p.default.hasUserConsent&&Object.assign(i,this.getUserStatistics()),`//${this.profile.demandHost}/sra/mobile?${n.default.ni(i)}`}buildGetDemandUrl(t){let i=Object.assign(Object.assign(Object.assign({},this.ls(t.isDcs)),{ac:u.default.getDcsActionCounter()}),this.buildAdData(t));return p.default.hasUserConsent&&Object.assign(i,this.getUserStatistics()),`//${this.profile.demandHost}/single/mobile?${n.default.ni(i)}`}buildAdData(t){var i;const e={if:t.Ki>1,ai:t.spotIndex,st:t.type,al:n.default.Z(t.ref).y,f:n.default.Ot(t),ll:t.isLazyLoading,pt:t.positionType,rc:t.refreshCount,di:n.default.H(t.demandIndex)?t.spotIndex:t.demandIndex},s=n.default.getGAMResponseInfo(t.slot,t);return(null==s?void 0:s.lid)&&(e.li=null==s?void 0:s.lid),(null==s?void 0:s.oid)&&(e.oi=null==s?void 0:s.oid),(t.type===l.SpotType.API||t.relocationPlid)&&(e.div=t.relocationPlid||t.ref.id,e.au=null===(i=t.options)||void 0===i?void 0:i.adUnit),t.selector&&(e.s=t.selector),e}buildPotentialSpotsParams(t){let i={};return t.map(((e,s)=>{const n=this.buildSRAUrlParamPotentialSpot(e);for(let e in n)i[e]=i[e]||[],i[e].push(n[e]),s+1===t.length&&(i[e]=i[e].join("||"))})),i}buildSRAUrlParamPotentialSpot(t){return{ais:t.spotIndex,als:n.default.Z(t.ref).y,fs:n.default.Ot(t),lls:t.isLazyLoading,sts:t.type,pts:t.positionType,ss:t.selector?t.selector:"",dis:n.default.H(t.demandIndex)?t.spotIndex:t.demandIndex}}getUserStatistics(){const t=f.default.get().analytics;return{bi:t.bi,bv:t.bv,sp:t.uv.t_sp,tiv:t.tiv.b_ativ,pv:t.pv,pi:t.pi,av:t.uv.t_a,oof:t.aof.t_a}}handleRefreshBlocked(t){t[0].refresh&&(t[0].refresh.active=!1),d.default.get().sendAdRequestBlockedEvent(t[0],"liIdBl","")}ls(t){var i,e,s,r,o,h;const a=Object.assign({sk:this.profile.siteKey,pk:this.profile.publisherKey,pvid:this.profile.pageViewID,aid:this.profile.articleId,sid:this.profile.sessionID,uid:c.default.getUserID(),pu:n.default.M(),pl:n.default.q(),d:t,sh:n.default.ht(),lid:this.profile.supplyConfigId,ts:this.profile.trafficSource,cc:this.profile.countryCode,ir:this.profile.isReturningUser,ul:n.default._(),do:null===(i=this.profile.deviceType)||void 0===i?void 0:i.os,dd:null===(e=this.profile.deviceType)||void 0===e?void 0:e.device,dp:null===(s=this.profile.deviceType)||void 0===s?void 0:s.devicePlatform,db:null===(r=this.profile.deviceType)||void 0===r?void 0:r.browser},"number"==typeof(null===(o=this.profile.spotsSupplyParams.lazySpots)||void 0===o?void 0:o.threshold)?{lt:null===(h=this.profile.spotsSupplyParams.lazySpots)||void 0===h?void 0:h.threshold}:{}),l=n.default.Ti();return l.length>0&&(a.qp=l),a}handleWaterfallFailed(t,i,e){this.logger.error("waterfall failed",t),e&&this.logger.logWaterfallDetails(i,e,h.Status.FAILURE),i.isRefreshing()||this.getNextDemandFromYield(i)}getNextDemandFromYield(t){if(t.Ki++,t.Ki>2)return this.demandManager.Xi(null,[t]);this.ns([t],r.DemandRequestType.SINGLE)}runPreDemand(t){const i=c.default.getExternalFlowHandler("onPreDemand");i&&i(t)}runPostDemand(t,i){const e=c.default.getExternalFlowHandler("onPostDemand");e&&e(t,i)}}i.YieldClient=_},9179:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.CUSTOM_REFRESH_RESPONSES_MAP={[-1]:"found rule with no refresh",[-2]:"not found rule",[-3]:"refresh blocked by black/white list",[-4]:"not found line item type in cache",[-5]:"missing publisher refresh rates rules",[-6]:"server error"}},1297:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4669),n=e(2661),r=e(5540),o=e(2797),h=e(9150),a=e(546),l=e(7415),c=e(4236),d=e(4524),u=e(83);i.MIN_AD_SIZE=5;class f extends s.Provider{constructor(t,i){super(t),this.Fe=new n.default("DFP"),this.isPubHeaderBidding=i||!1,this.Ge=this.Se()}static isValidSize(t,e=!1){return e&&r.default._i(t)||t.w>i.MIN_AD_SIZE&&t.h>i.MIN_AD_SIZE}Yi(t,i){return new Promise(((e,s)=>{i.us(this.spot,this.Xe()).then((t=>this.Ve(t))).then((i=>{this.pushGoogleTagCommands(i,t,e)})).catch((t=>{s({status:c.Status.ERROR})}))}))}pushGoogleTagCommands(t,i,e){let s=t.win.googletag||{};s.cmd=s.cmd||[],(s||this.spot.Ki>1)&&(this.runProcessBeforeCallingDFP(i),this.Ce(i).then((()=>{s.cmd.push((()=>{this.pushGptCommands(t,i,e)}))})).catch((t=>{this.spot.handlePreFetchAsyncReject(t)})))}runProcessBeforeCallingDFP(t){var i;const e=d.default.getExternalFlowHandler("processBeforeCallingDFP");if(e){this.Fe.info("processBeforeCallingDFP hook has been invoked"),t.setTargeting=t.setTargeting||[];const s=null===(i=r.default.getDemandConfig(t))||void 0===i?void 0:i.aup;t=r.default.convertToOldStyleAdUnit(t),e(u.default.getSpots(),this.spot.spotIndex,t),t=s?r.default.convertToNewStyleAdUnit(t,s):t}}pushGptCommands(t,i,e){const s=t.win.googletag,n=(s.pubads().getSlots().length,this.ke(!0));this.spot.vs(s.defineSlot(i.c.aup,n,t.adContainer.id)),this.Fe.info(`spot ${this.spot.spotIndex}, definedSlot: ${this.spot.slot.getAdUnitPath()} ${JSON.stringify(n)}`);const r="false"===i.c.a.upc||!i.c.a.upc;this.He(this.spot.slot,this.Qe(i)),this.spot.slot.addService(s.pubads()),this.setGoogleTagPrivacy(s),s.enableServices(),t.isIframe?s.display(t.adContainer):s.pubads().isInitialLoadDisabled()?(s.display(t.adContainer),s.pubads().refresh([this.spot.slot],{changeCorrelator:r})):(r&&googletag.pubads().updateCorrelator(),s.display(t.adContainer)),s.pubads().addEventListener("slotRequested",(e=>{if(this.ze(e,t.adContainer.id)){this.Fe.verbose(`dfp(da) slotRequestedEvent ${t.adContainer.id}`),this.spot.spotRequested++;const e=this.Ke()?"forced_refresh":void 0;this.Oe(i.c.aup,i.plk,this.ke(!0),void 0,e)}})),s.pubads().addEventListener("slotRenderEnded",(s=>{this.ze(s,t.adContainer.id)&&(this.Ke()?this.handleForcedRefreshSlotRenderEnded(i,s):(this.handleSlotRenderEnded(t,i,t.adContainer.id,s,e),this.spot.gs()))})),s.pubads().addEventListener("slotOnload",(t=>{if(this.spot.slot!=t.slot)return;this.Fe.info("send measurable event after slotOnload listener for spot ",this.spot.spotIndex);new l.default(this.spot,i.c.aup,i.plk).sendEvent("DFP slot loaded")}))}handleForcedRefreshSlotRenderEnded(t,i){this.spot.isMeasurable=!1,this.je(t,!i.isEmpty,"forced_refresh",r.default.getGAMResponseInfo(i.slot)),i.isEmpty||this.ae(t.c.aup,t.plk)}handleSlotRenderEnded(t,i,e,s,n){var l,d;let u=r.default.Dt(s);s.size&&this.spot.bs(u),this.Fe.info(`dfp returned ${s.isEmpty?"empty":JSON.stringify(u)} for ${e}`),this.je(i,!s.isEmpty,void 0,r.default.getGAMResponseInfo(s.slot)),s.isEmpty?(h.Embedder.Je(t.adWrapper),n({status:c.Status.FAILURE,refresh:null===(l=this.spot.refresh)||void 0===l?void 0:l.isRefreshing})):(this.spot.isRefreshing()&&(t.win.googletag.destroySlots([null===(d=this.spot.refresh)||void 0===d?void 0:d.oldSlot]),this.qe()),t.display(this.Ye(i.c.a)),r.default.ui(e),n({status:c.Status.SUCCESS,args:{provider:o.ProviderType.DFP,adUnit:i.c.aup}})),a.default.get().waitForBrowsiAV(s.slot,t,i,this.spot)}}i.DFP=f},7899:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.SRA="SRA",t.SINGLE="SINGLE"}(i.DemandRequestType||(i.DemandRequestType={}))},5600:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4669),n=e(2661),r=e(5540),o=e(2797),h=e(4236),a=e(83),l=e(6389),c=e(4436),d=e(1297),u=e(4524),f=e(1511),v=e(4042),p=e(1482);class m extends s.Provider{constructor(t,i){super(t),this.Fe=new n.default("GenericJS"),this.isJs="true"===i.c.a.isJS,this.snippetUrl=i.c.a.url,this.isCallback="true"===i.c.a.withCallback,this.template=i.c.a.template,this.callbackInvoked=!1,this.manualFailureReported=!1,this.adUnit=i.c&&i.c.aup||"NA",this.placementKey=i.plk}Yi(t,i){return new Promise(((e,s)=>i.us(this.spot,this.Xe()).then((i=>{this.Ce(t).then((()=>(this.Oe(this.adUnit,this.placementKey,[]),r.default.xhrPromise(this.snippetUrl).then((t=>t.status&&200===t.status?t.responseText:Promise.reject({status:h.Status.GENERIC_SNIPPET_ERROR,msg:"no response. status - "+t.status}))).then((s=>this.runSnippet(i,s,t,e))).then((s=>this.handleResult(s,i,t,e))).catch((i=>{this.Fe.error(i),this.je(t,!1,h.Status.GENERIC_SNIPPET_ERROR,void 0,(null==i?void 0:i.msg)||""),s({status:h.Status.GENERIC_SNIPPET_ERROR,args:{provider:o.ProviderType.GENERIC_JS,adUnit:"NA"}})}))))).catch((t=>{this.spot.handlePreFetchAsyncReject(t)}))})).catch((i=>{this.je(t,!1,h.Status.GENERIC_SNIPPET_ERROR),s({status:h.Status.GENERIC_SNIPPET_ERROR,args:{provider:o.ProviderType.GENERIC_JS,adUnit:"NA"}})}))))}handleResult(t,i,e,s){if(t.status===h.Status.SUCCESS){if(this.ce(this.spot),!this.isCallback){let t=!1;i.adContainer.style.display="block",this.Fe.verbose("starting valid size interval");const n=setInterval((()=>{this.manualFailureReported&&clearInterval(n),this.isValidAdSize(i)&&(clearInterval(n),t=!0,this.validAdSizeCallback(i,e,s))}),200);setTimeout((()=>{t||this.manualFailureReported||(clearInterval(n),this.spot.browsiAd=i.adContainer,this.je(e,!1),s({status:h.Status.FAILURE}))}),e.c.t)}}else s(t)}getAdSize(t){var i;if(!(null===(i=this.spot.placeholder)||void 0===i?void 0:i.active))return r.default.ut(t.adContainer);let e={w:0,h:0};return t.adContainer.childNodes.forEach((t=>{if(r.default.B(t)){const i=r.default.ut(t);e.w=Math.max(e.w,i.w),e.h+=i.h}})),e}isValidAdSize(t){const i=u.default.getExternalFlowHandler("isValidGenericSize");if(i)return i(t,this.spot);{const i=this.getAdSize(t);return i.w>d.MIN_AD_SIZE&&i.h>d.MIN_AD_SIZE}}validAdSizeCallback(t,i,e){var s;if(!this.callbackInvoked){this.Fe.info("callback triggered",this.spot.demandIndex,i),this.spot.browsiAd=t.adContainer,(null===(s=this.spot.newBrowsiAd)||void 0===s?void 0:s.adMarking)&&(this.spot.newBrowsiAd.adMarking.style.display="block");const n=r.default.ut(this.spot.browsiAd);if(this.isCallback&&!this.isValidAdSize(t))return this.handleFailure(i,e);this.spot.bs(n),this.je(i,!0),e({status:h.Status.SUCCESS,args:{provider:o.ProviderType.GENERIC_JS}})}}handleFailure(t,i){this.Fe.info(`ad height < ${d.MIN_AD_SIZE} for spot`,this.spot.demandIndex),this.je(t,!1),this.spot.Qi(),a.default.removeStickyAd(this.spot),i({status:h.Status.FAILURE})}runSnippet(t,i,e,s){return this.isJSONPTemplate()?this.prepareTemplateFunction(t,e,s):new Promise(((n,o)=>{this.isCallback&&this.assignBrowsiCallbackToWindow(t,e,s),t.adContainer.className=t.adContainer.id;let a=i.replace(/<DIV_ID>/g,`${t.adContainer.id}`).replace(/<SPOT_INDEX>/g,this.spot.spotIndex.toString()).replace(/<DEMAND_INDEX>/g,this.spot.demandIndex.toString()).replace(/<BROWSI_VIEWABILITY_PREDICTION>/g,this.getPredictionReplaceValue(e)).replace(/<PAGEVIEW_ID>/g,l.Profiler.get().pageViewID).replace(/<LAYOUT_ID>/g,l.Profiler.get().supplyConfigId).replace(/"<SPOT_SIZES>"/g,JSON.stringify(this.ke(!0))).replace(/"<TARGETING>"/g,JSON.stringify(this.Qe(e))).replace(/<VIDEO_IDX>/g,JSON.stringify(f.InframeManager.get().getVideoIndex(this.spot.spotIndex)));if(this.template)for(let t in this.template.pr){const i=new RegExp(t,"g");a=a.replace(i,this.template.pr[t])}if(this.assignFunctionsToBrowsiTag(e,s),this.Fe.verbose("running snippet",a),a)if(this.isJs)try{t.win.eval(a),n({status:h.Status.SUCCESS})}catch(t){this.Fe.error(t),o({status:h.Status.GENERIC_SNIPPET_ERROR,msg:t.message})}else{t.adContainer.innerHTML=a;const i=r.default.wi(t.adContainer);this.copyAndAppendScriptTag(t.adContainer,i,n)}}))}isJSONPTemplate(){var t;return!!(null===(t=this.template)||void 0===t?void 0:t.n)}prepareTemplateFunction(t,i,e){return new Promise(((s,n)=>{var o;const h=null===(o=this.template)||void 0===o?void 0:o.n,a=this.buildTemplateArguments(t,i,e);"function"==typeof t.win[h]?this.runTemplateFunction(h,t.win,a,s,n):r.default.Ut(this.snippetUrl,t.win.document.body,t.isIframe).then((()=>{this.runTemplateFunction(h,t.win,a,s,n)}))}))}runTemplateFunction(t,i,e,s,n){try{const n=i[t](e);"function"==typeof(null==n?void 0:n.refresh)&&(this.spot.genericParams.refresh=this.invokeRefreshCallback.bind(this,n.refresh)),s({status:h.Status.SUCCESS})}catch(t){this.Fe.error("Error while running template function",t),n({status:h.Status.GENERIC_SNIPPET_ERROR,msg:t.message})}}buildTemplateArguments(t,i,e){var s,n,r;const o=this.isCallback?(s,n,r)=>this.browsiCallback(t,i,e,s,n,r):void 0;return Object.assign(Object.assign({divId:t.adContainer.id,spotIndex:this.spot.spotIndex,demandIndex:this.spot.demandIndex,viewabilityPrediction:this.getPredictionReplaceValue(i),pageviewID:l.Profiler.get().pageViewID,layoutID:l.Profiler.get().supplyConfigId,spotsSizes:this.ke(!0),targeting:this.Qe(i),adUnit:i.c.aup,refreshRate:(null===(s=i.c.ri)||void 0===s?void 0:s.r)||-1,templateParams:null===(n=this.template)||void 0===n?void 0:n.pr},i.c.tam?{amznBidConf:{pubID:i.c.tam.pubID,adServer:i.c.tam.adServer,slotName:i.c.tam.slotName,timeout:i.c.tam.timeout,simplerGPT:i.c.tam.simplerGPT}}:{}),{sendActiveViewEvent:()=>{this.sendActiveViewEvent(i)},sendGeneralDataEvent:this.sendGeneralDataEvent,reportManualFailureEvent:t=>{this.reportManualFailureEvent(i,e,t)},mapAdUnitToSpot:t=>{this.setAdUnitMap(t)},callback:o,inframeVideoIdx:f.InframeManager.get().getVideoIndex(this.spot.spotIndex),prebidGlobalInstanceName:(null===(r=l.Profiler.get().prebidData)||void 0===r?void 0:r.globalInstanceName)||"pbjs"})}setAdUnitMap(t){this.spot.genericParams.adUnitMap=t}assignFunctionsToBrowsiTag(t,i){const e=window.browsitag;e.__gs=e.__gs||{},e.__gs[this.spot.spotIndex]={av:()=>{this.sendActiveViewEvent(t)},gd:this.sendGeneralDataEvent,rmf:e=>{this.reportManualFailureEvent(t,i,e)}}}sendActiveViewEvent(t){c.default.get().sendViewedImpressionAV(this.spot,t)}sendGeneralDataEvent(t,i){c.default.get().sendGeneralDataEvent(t,i)}reportManualFailureEvent(t,i,e){this.manualFailureReported||this.callbackInvoked||(this.manualFailureReported=!0,this.je(t,!1,e)),i({status:h.Status.FAILURE})}getPredictionReplaceValue(t){const i=r.default.getPredictionToSend(t);return i?this.Ue(i):""}copyAndAppendScriptTag(t,i,e){Array.from(i).forEach((i=>{let e=document.createElement("script");Array.from(i.attributes).forEach((t=>{e.setAttribute(t.name,t.value)})),i.parentElement&&i.parentElement.removeChild(i),e.text=i.text,t.appendChild(e)})),e({status:h.Status.SUCCESS})}assignBrowsiCallbackToWindow(t,i,e){window[`browsiCallback_${this.spot.spotIndex}`]=(s,n)=>this.browsiCallback(t,i,e,s,n)}browsiCallback(t,i,e,s,n,l){var c,d;this.callbackInvoked=!0;const m=f.InframeManager.get().isProviderInframe(this.spot);this.Fe.info("spot: ",this.spot),this.spot.genericParams.gamInfo=(null==l?void 0:l.gamInfo)==={}||null==l?void 0:l.gamInfo,this.spot.genericParams.adUnit=null==l?void 0:l.adUnit,this.manualFailureReported||(s?(this.spot.browsiAd=t.adContainer,this.je(i,!1,n,this.spot.genericParams.gamInfo),m&&f.InframeManager.get().handleVideoWithoutDemand(),e({status:h.Status.FAILURE})):(this.spot.browsiAd=t.adContainer,r.default.ut(this.spot.browsiAd).h<1?(this.Fe.info("ad height <1 for spot",this.spot.demandIndex),this.je(i,!1,"ad height <1",this.spot.genericParams.gamInfo),m&&f.InframeManager.get().handleVideoWithDemand(this.spot.spotIndex),this.spot.Qi(),a.default.removeStickyAd(this.spot),e({status:h.Status.FAILURE})):(this.je(i,!0,void 0,this.spot.genericParams.gamInfo),null===(c=this.spot.newBrowsiAd)||void 0===c||c.display(!1),(null===(d=this.spot.refresh)||void 0===d?void 0:d.isRefreshing)&&(this.ae(this.adUnit,this.placementKey),u.default.isCustomRefreshConfigured()&&this.spot.initCustomRefreshRate(),p.ViewabilityService.instance.subscribe(this.spot.ue({adUnit:this.adUnit}),v.ViewabilityConfigurations.vConfig(),i),this.spot.refresh.handleSuccess()),m&&f.InframeManager.get().handleVideoWithDemand(this.spot.spotIndex)),e({status:h.Status.SUCCESS,args:{provider:o.ProviderType.GENERIC_JS}})))}Xe(){return!0}getRefreshTemplateValues(t){return{targeting:this.Qe(t)}}invokeRefreshCallback(t,i){t&&(p.ViewabilityService.instance.unsubscribe(this.spot),this.Oe(this.adUnit,this.placementKey,[]),t(this.getRefreshTemplateValues(i)))}}i.GenericJs=m},4830:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4669),n=e(2661),r=e(4236),o=e(2797),h=e(4436),a=e(1511);class l extends s.Provider{constructor(t,i){super(t),this.Fe=new n.default("Inframe");const e=a.InframeManager.get();this.adImpressionListener=t=>{t.detail.inframeId===e.inframeId&&(this.ws("",i),window.removeEventListener("video_ad_impression",this.adImpressionListener))},e.shouldFetchDynamicVideo(!1,t.type)&&window.addEventListener("video_ad_impression",this.adImpressionListener)}Yi(t,i){return this.Ce(t).then((()=>new Promise(((e,s)=>{this.Oe("",t.plk,this.ke(!1));let n=!1;try{a.InframeManager.get().activateVideo(this.spot.spotIndex),n=!0}catch(t){this.Fe.error("video activation failed",t)}const h=n?void 0:"video activation failed";this.je(t,n,h),n?i.us(this.spot,this.Xe()).then((t=>{e({status:r.Status.SUCCESS,args:{provider:o.ProviderType.INFRAME}})})).catch((t=>{s({status:r.Status.ERROR})})):s({status:r.Status.ERROR})}))))}Xe(){return!0}ae(t,i){}ws(t,i){this.Pe(t,i)}Te(t,i,e){h.default.get()._s(this.spot,i,e)}Ae(t,i,e,s){h.default.get().ys(this.spot,i)}Ee(t,i,e,s,n,r){h.default.get().Ss(this.spot,t,e,s)}}i.Inframe=l},1511:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6389),n=e(4436),r=e(2797),o=e(2661),h=e(5353);i.INFRAME_DISPLAY_NAME="video";class a{constructor(){var t,i;this.potentialSpots={},this.totalVideosToEmbedCount=0,this.videosHandledCount=0,this.spotToVideoIdxMap={},this.spotsWithDemand={},this.logger=new o.default("Inframe"),this.inframeConf=Object.assign({},null===(t=s.Profiler.get().loaderParams)||void 0===t?void 0:t.ly.inf),this.inframeId=this.inframeConf.id,this.isDynamicVideoConfigured=!!(null===(i=this.inframeConf)||void 0===i?void 0:i.dv)}static get(){return a.instance||(this.instance=new a),a.instance}addPotentialSpots(t){t.forEach((t=>{const i=document.createElement("div"),e=document.createElement("div");i.setAttribute("style","display:none"),e.setAttribute("style","display:none"),i.setAttribute("pp",t.spotIndex.toString()),e.setAttribute("pp",t.spotIndex.toString()),e.appendChild(i),t.ref.insertAdjacentElement("beforebegin",e),this.potentialSpots[t.spotIndex]={adContainer:i,adWrapper:e}}))}sendPotentialSpots(t){const i=window;i.avnts=i.avnts||{hasDemand:t=>!1,placements:[],activation:[]};const e=[];for(let t in this.potentialSpots)e.push({element:this.potentialSpots[t].adContainer,adIndex:t});const s={placements:e};t?(t.slice(1).forEach(((t,e)=>{i.avnts.placements.push({index:e+1,data:s}),this.addVideoIndex(e+1,t)})),n.default.get().sendInframePlacementEvent(e.length)):(i.avnts.placements.push({index:0,data:s}),this.addVideoIndex(0),n.default.get().sendInframePlacementEvent(e.length))}handleVideoWithDemand(t){this.moveSpotToDemandList(t),this.increaseVideosHandledCount()}moveSpotToDemandList(t){this.spotsWithDemand[t]=this.potentialSpots[t],delete this.potentialSpots[t]}handleVideoWithoutDemand(){this.increaseVideosHandledCount()}getSpotContainers(t){return this.potentialSpots[t]||this.spotsWithDemand[t]}setTotalVideosToEmbedCount(t){if(this.isDynamicVideoConfigured)return void(this.totalVideosToEmbedCount=1);const e=t.c,s=Object.keys(e).filter((t=>{var s,n;return(null===(n=null===(s=e[t].c.a)||void 0===s?void 0:s.template)||void 0===n?void 0:n.p)===i.INFRAME_DISPLAY_NAME}));this.totalVideosToEmbedCount=s.length,s.length>1&&this.sendPotentialSpots(s)}increaseVideosHandledCount(){this.videosHandledCount++,this.isHandledAllVideos()&&this.removeAllPotentialSpotsContainers()}isHandledAllVideos(){return this.totalVideosToEmbedCount===this.videosHandledCount}removeAllPotentialSpotsContainers(){Object.keys(this.potentialSpots).forEach((t=>{var i;const e=this.potentialSpots[t];null===(i=e.adWrapper.parentElement)||void 0===i||i.removeChild(e.adWrapper)}))}getVideoIndex(t){const i=this.spotToVideoIdxMap[t];return void 0===i?0:i}addVideoIndex(t,i){void 0!==i&&(this.spotToVideoIdxMap[i]=t)}isProviderInframe(t){return t.genericParams.displayName===i.INFRAME_DISPLAY_NAME||t.providerName===r.ProviderType.INFRAME}isInframeConfigured(){return!!this.inframeId&&this.isDynamicVideoConfigured}shouldFetchDynamicVideo(t,i){return i===h.SpotType.DYNAMIC&&this.isInframeConfigured()&&!this.isHandledAllVideos()&&!t}hasVideoDemand(t){var i;this.logger.verbose(`Requesting inframe has demand for adix:${t.spotIndex}`,t.ref);const e=window.avnts,s=(null==e?void 0:e.ready)&&"function"==typeof(null==e?void 0:e.hasDemand);let r=!1;const o=null===(i=this.potentialSpots[t.spotIndex])||void 0===i?void 0:i.adContainer;s&&o&&(r=null==e?void 0:e.hasDemand({index:this.videosHandledCount,element:o,adIndex:t.spotIndex}));const h=s?r?"":"no demand":"api not ready";return this.logger.verbose(`Response for inframe has demand, adix:${t.spotIndex}: isMatched:${!(!s||!r)}, reason: ${h||"none"} `,t.ref),n.default.get().Os(t,!(!s||!r),h),s&&r}activateVideo(t){const i=window.avnts,{adContainer:e}=this.getSpotContainers(t);this.handleVideoWithDemand(t),null==i||i.activation.push({index:this.videosHandledCount-1,data:{element:e,spotIndex:t}})}}i.InframeManager=a},2797:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.DFP="dfp",t.GENERIC_JS="generic_js",t.ILX="ilx",t.HEADER_BIDDING="header_bidding",t.UNRULY="unruly",t.TEADS="teads",t.MANUAL_TEADS="manual_teads",t.MANUAL_UNRULY="manual_unruly",t.MANUAL_APPNEXUS="manual_appnexus",t.MANUAL_VIDEO_AD="manual_video_ad",t.MANUAL_AD="manual_ad",t.MANUAL_IFRAME_AD="manual_iframe_ad",t.INFRAME="inframe"}(i.ProviderType||(i.ProviderType={}))},8677:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(83),r=e(4436),o=e(6389);class h{constructor(){this.logger=new s.default("AuctionDataCollector"),this.matches={},this.profile=o.Profiler.get()}static get(){return h.instance||(this.instance=new h),h.instance}collectBidRequest(t,i,e){if(this.profile.collectHbEvents){const t=this.getSpotFromAdUnitCode(i);t?this.sendBidRequestEvent(t,e):this.logger.info("could not find spot for",i,"not sending bid request")}}collectBidMatch(t,i,e,s){this.profile.collectHbEvents&&(this.matches[t]=this.matches[t]||{},this.matches[t][i]=this.matches[t][i]||[],this.matches[t][i][+e.im]=this.matches[t][i][+e.im]||[],this.matches[t][i][+e.im].push(e),s&&this.sendBidMatches(t))}sendBidMatches(t){const i=this.getSpotFromAdUnitCode(t);if(!i)return void this.logger.info("could not find spot for",t,"not sending bid match");const e=this.bidMatchedParamsToEvent(this.matches[t]);e&&e.length&&r.default.get().sendBidMatch(i,e),this.matches[t]={}}bidMatchedParamsToEvent(t){let i=[];for(let e in t)t.hasOwnProperty(e)&&t[e].forEach((t=>{let s={n:e,im:t[0].im,s:[]};t[0].reqt&&t[0].rest&&(s.reqt=t[0].reqt,s.rest=t[0].rest),t[0].brc&&(s.brc=t[0].brc),t[0].au&&(s.au=t[0].au),t.forEach((t=>{t.s.forEach((i=>{s.s.push(Object.assign(Object.assign(Object.assign({},i),t.rsn?{rsn:t.rsn}:{}),t.br?{br:t.br}:{}))}))})),i.push(s)}));return i}getSpotFromAdUnitCode(t){let i;if(t.startsWith("browsi")){const e=t.split("_")[2];i=n.default.getSpots().find((t=>t.spotIndex===+e))}else i=n.default.getSpots().find((i=>i.genericParams.adUnitMap===t));return i}collectDFPBidRequest(t,i){this.profile.collectHbEvents&&this.sendBidRequestEvent(t,i)}sendBidRequestEvent(t,i){const e=this.buildRequestParamsToEvent(i);e&&e.length&&r.default.get().sendBidRequests(t,e)}buildRequestParamsToEvent(t){let i=[];return t.forEach((t=>{for(let e in t)t.hasOwnProperty(e)&&i.push({n:e,s:t[e]})})),i}buildSizesFromArray(t){return t.map((t=>({w:t[0],h:t[1]})))}}i.AuctionDataCollector=h},9401:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4669),n=e(8677),r=e(4524),o=e(5540),h=e(7415),a=e(83),l=e(9504);class c extends s.Provider{constructor(t){super(t)}isRefreshingDfpOnly(){var t,i;return this.spot.isRefreshing()&&!(!(null===(t=this.spot.refresh)||void 0===t?void 0:t.stickyRefresh)&&!(null===(i=this.spot.refresh)||void 0===i?void 0:i.dfpOnly))}requestDfpBid(t,i,e,s){this.Ve(t).then((()=>{const n=this.ke(!0);this.pushGptCommands(n,t,s,i),this.subscribeToGptEvents(t,i,e)}))}subscribeToGptEvents(t,i,e){t.win.googletag.cmd.push((()=>{t.win.googletag.pubads().addEventListener("slotRequested",(e=>{this.Fe.verbose(`dfp(da) slotRequestedEvent ${t.adContainer.id}`),this.slotAdRequestHandler(e,t,i)})),t.win.googletag.pubads().addEventListener("slotResponseReceived",(i=>{this.Fe.verbose(`dfp(da) slotResponseReceived ${t.adContainer.id}`)})),t.win.googletag.pubads().addEventListener("slotRenderEnded",(s=>this.slotRenderEndedHandler(s,t,i,e))),t.win.googletag.pubads().addEventListener("slotOnload",(t=>this.slotOnloadHandler(t,i)))}))}runProcessBeforeCallingDFP(t){var i;const e=r.default.getExternalFlowHandler("processBeforeCallingDFP");if(e){this.Fe.info("processBeforeCallingDFP hook has been invoked"),t.setTargeting=t.setTargeting||[];const s=null===(i=o.default.getDemandConfig(t))||void 0===i?void 0:i.aup;t=o.default.convertToOldStyleAdUnit(t),e(a.default.getSpots(),this.spot.spotIndex,t),t=s?o.default.convertToNewStyleAdUnit(t,s):t}}runPreDfpHB(t,i){var e;const s=r.default.getExternalFlowHandler("preDfpHB");if(s){const n=null===(e=o.default.getDemandConfig(t))||void 0===e?void 0:e.aup;t=o.default.convertToOldStyleAdUnit(t),s(this.spot,t,i),t=n?o.default.convertToNewStyleAdUnit(t,n):t}}hasAmazonBidder(t){return!(!t.c.d||!t.c.d.tam)}slotOnloadHandler(t,i){if(!this.spot.slot||this.spot.slot!=t.slot)return;new h.default(this.spot,i.c.d.aup,i.plk).sendEvent("DFP DA slot loaded")}buildAmazonPromise(t,i,e){return this.hasAmazonBidder(t)&&l.default.hasUserConsent?new Promise(((s,h)=>{const a=t.c.d.tam;this.De(e,a).then((t=>{const e=t.win.apstag,h=this.ke(!1),l=(null==a?void 0:a.slotName)||"",c=Object.assign({slots:[{slotID:i,slotName:l,sizes:h}]},a.timeout?{timeout:a.timeout}:{}),d=r.default.getExternalFlowHandler("preApsFetchBids");d&&d(c),e.fetchBids(c,(t=>{const e=t.find((t=>t.slotID===i));this.Fe.info("amazon bid: ",e),this.Fe.apsLog(e);const r=e&&e.size?o.default.Oi(e.size):{w:-1,h:-1},h={im:!!e&&!!e.amzniid,s:[r],br:-1,au:l};return n.AuctionDataCollector.get().collectBidMatch(i,"aps",h,!0),s()}));const u=n.AuctionDataCollector.get();u.collectBidRequest("aps",i,[{aps:u.buildSizesFromArray(h)}])}))})):Promise.resolve()}getSizeForBidders(){return this.spot.isRefreshing()?this.spot.implementedSize||{w:1,h:1}:{w:-1,h:-1}}}i.HbProvider=c},3137:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4856),n=e(4436),r=e(5540),o=e(2797),h=e(546),a=e(4236),l=e(6389),c=e(1297),d=e(8677),u=e(8867),f=e(7016),v=e(2873);class p extends s.PrebidJs{constructor(t){super(t),this.Ge=this.Se(),this.adUnit=null}As(t,i,e,s){const r=this.usingBrowsiPbjs?0:1;if(this.hasDfpBidder(t)||this.Oe(this.Es(t),t.plk,this.ke(!0),r),this.isRefreshingDfpOnly())this.requestDfpBid(i,t,e,!1);else{const r=i.adContainer.id;this.adUnit=this.hasBidders(t)?this.buildAdUnit(t.c.b,t.c.d,r,this.getSizeForBidders()):null,this.xe(this.spot,this.adUnit,t);const o=this.buildHBPromise(t,this.adUnit,i,e),h=this.buildAmazonPromise(t,r,i);Promise.all([o,h]).then((()=>{const s=this.hasBidders(t)?this.getPrebidWinner(r):null,o=!!s;if(this.hasDfpBidder(t))this.requestDfpBid(i,t,e,o);else{if(s)return this.handleBidSuccess(s,i,t,e);{const i=this.getHighestBidCpm(this.adUnit&&this.adUnit.code);u.default.get().updateAvgWiningBid(i),n.default.get().Ie(this.spot,!1,this.Es(t),t.plk,null,null,i),e({status:a.Status.FAILURE})}}})).catch((t=>{this.Fe.error(t),s({status:a.Status.FAILURE})}))}}Es(t){var i;return(null===(i=t.c.d)||void 0===i?void 0:i.aup)||"NA"}buildHBPromise(t,i,e,s){return i&&this.hasBidders(t)?new Promise((n=>{this.pbjsInstance&&(this.pbjsInstance.que=this.pbjsInstance.que||[],this.pbjsInstance.que.push((()=>{if(this.pbjsInstance){this.pbjsInstance.addAdUnits(i),this.pbjsInstance.setConfig(this.getConfig(t.c.t)),this.addConfigByProvider(t.c.b||[]),this.pbjsInstance.onEvent("bidWon",(i=>this.winnerHandler(i,this.spot,e,t,s)));if(this.spot.newBrowsiAd&&this.spot.newBrowsiAd.iframe){const t=this.spot.newBrowsiAd;new v.default(this.getInstanceName(t),t.win).initListeners()}this.pbjsInstance.requestBids(Object.assign({adUnitCodes:[i.code],auctionId:`${i.code}_${r.default.generateUuid()}`,bidsBackHandler:t=>{n()}},t.c.t?{timeout:t.c.t}:{}))}})))})):Promise.resolve()}winnerHandler(t,i,e,s,n){t&&t.adUnitCode===this.adUnit.code&&this.hasDfpBidder(s)&&this.handleBidSuccess(t,e,s,n)}slotAdRequestHandler(t,i,e){if(this.ze(t,i.adContainer.id)){const t=this.usingBrowsiPbjs?0:1;this.Fe.verbose(`dfp(da) slotRequestedEvent ${i.adContainer.id}`),this.spot.spotRequested++;const s=this.Ke()?"forced_refresh":void 0;this.Oe(this.Es(e),e.plk,this.ke(!0),t,s)}}slotRenderEndedHandler(t,i,e,s){var l;if(this.ze(t,i.adContainer.id)){if(this.Ke())return this.handleForcedRefreshSlotRenderEnded(e,t,s);const c=r.default.Dt(t);e.c.b||this.sendDfpBidMatched(null===(l=e.c.d)||void 0===l?void 0:l.aup,!t.isEmpty,c,t.slot.getSlotElementId()),this.Fe.info(`dfp(da) slotRenderEnded ${t.isEmpty?"empty":JSON.stringify(c)} for ${i.adContainer.id}`);const d=this.getHighestBidCpm(this.adUnit&&this.adUnit.code||t.slot.getSlotElementId());u.default.get().updateAvgWiningBid(d),t.isEmpty?(n.default.get().Ie(this.spot,!1,t.slot.getAdUnitPath(),e.plk,null,d,r.default.getGAMResponseInfo(t.slot)),s({status:a.Status.FAILURE})):(this.handleAdMatched(i,e,d,t,c),s({status:a.Status.SUCCESS,args:{adUnit:t.slot.getAdUnitPath(),provider:o.ProviderType.HEADER_BIDDING}})),h.default.get().waitForBrowsiAV(t.slot,i,e,this.spot)}}sendDfpBidMatched(t,i,e,s){const n={im:i,s:[e],br:-1,au:t};d.AuctionDataCollector.get().collectBidMatch(s,o.ProviderType.DFP,n,!0)}handleAdMatched(t,i,e,s,o){var h;this.spot.isRefreshing()&&(t.win.googletag.destroySlots([null===(h=this.spot.refresh)||void 0===h?void 0:h.oldSlot]),this.qe()),this.spot.gs(),n.default.get().Ie(this.spot,!0,s.slot.getAdUnitPath(),i.plk,null,e,r.default.getGAMResponseInfo(s.slot)),this.spot.bs(o),c.DFP.isValidSize(o,!0)&&t.display(this.Ye(i.c.d.a));try{const t=s.slot.getHtml();if(t.includes("apstag.renderImp")||t.includes("amzn_win")){if(r.default.isBrowsiLoggerActive()){const t={winner:"aps",size:o,adUnit:s.slot.getSlotElementId()};window.dispatchEvent(new CustomEvent(f.EventType.AMAZON_WINNER,{detail:t}))}l.Profiler.get().collectHbEvents&&n.default.get().sendAPSWinner(this.spot)}}catch(t){}}pushGptCommands(t,i,e,s){const n=s.c.d,r="false"===n.a.upc||!n.a.upc;let o=i.win.googletag||{};o.cmd=o.cmd||[],this.runProcessBeforeCallingDFP(s),this.runPreDfpHB(s,this.adUnit),o.cmd.push((()=>{if(this.spot.vs(o.defineSlot(n.aup,t,i.adContainer.id)),this.spot.slot.addService(o.pubads()),this.setGoogleTagPrivacy(o),o.pubads().enableSingleRequest(),o.enableServices(),this.hasBidders(s)&&this.pbjsInstance.que.push((()=>{e&&this.pbjsInstance.setTargetingForGPTAsync([i.adContainer.id])})),this.He(this.spot.slot,this.Qe(s)),this.hasAmazonBidder(s)&&i.win.apstag&&i.win.apstag.setDisplayBids(),i.iframe?o.display(i.adContainer):(o.enableServices(),o.display(i.adContainer),o.pubads().isInitialLoadDisabled()&&o.pubads().refresh([this.spot.slot],{changeCorrelator:r})),!s.c.b){const t=this.spot.implementedSize||{w:-1,h:-1};d.AuctionDataCollector.get().collectDFPBidRequest(this.spot,[{dfp:[t]}])}}))}handleForcedRefreshSlotRenderEnded(t,i,e){this.spot.isMeasurable=!1;const s={im:!i.isEmpty,s:[r.default.Dt(i)],br:-1,rsn:"forced_refresh",au:t.c.d.aup};d.AuctionDataCollector.get().collectBidMatch(this.spot.newBrowsiAd.adContainer.id,o.ProviderType.DFP,s,!0);const h=this.getHighestBidCpm(this.adUnit&&this.adUnit.code||i.slot.getSlotElementId());u.default.get().updateAvgWiningBid(h),n.default.get().Ie(this.spot,!i.isEmpty,i.slot.getAdUnitPath(),t.plk,"forced_refresh",h,r.default.getGAMResponseInfo(i.slot)),i.isEmpty||this.ae(this.Es(t),t.plk),e({status:a.Status.SUCCESS,args:{adUnit:"NA",provider:o.ProviderType.HEADER_BIDDING}})}getHighestBidCpm(t){if(!t)return null;let i;return this.pbjsInstance&&(i=this.getHighestBidById(this.pbjsInstance.getBidResponses(),t)),i?i.cpm:null}}i.HeaderBidding=p,p.isBidTimeoutListenerActive=!1},4856:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5540),r=e(2797),o=e(4436),h=e(4236),a=e(6389),l=e(9401),c=e(9504),d=e(7016),u=e(4524);class f extends l.HbProvider{constructor(t){super(t),this.usingBrowsiPbjs=!1,this.Fe=new s.default("PrebidJs"),this.profile=a.Profiler.get()}hasBidders(t){return!(!t.c.b||!t.c.b.length)}Yi(t,i){return new Promise(((e,s)=>{i.us(this.spot,this.Xe()).then((i=>{this.hasBidders(t)&&this.appendPrebidJsToHead(i).catch((t=>{t===h.Status.NOT_SUPPORTED&&(o.default.get().sendAdRequestBlockedEvent(this.spot,"prebid_version_unsupported",`Prebid version ${this.pbjsInstance?this.pbjsInstance.version:""}`),this.Fe.error(`fetching failed: Prebid version ${this.pbjsInstance?this.pbjsInstance.version:""} is not supported`,this.pbjsInstance)),e({status:t})})),this.Ce(t).then((()=>{this.As(t,i,e,s)})).catch((t=>{this.spot.handlePreFetchAsyncReject(t)}))}))}))}getBidResponses(t,i){return i&&i[t]?i[t].bids:[]}buildIframe(t,i){const e=t.win.document.createElement("iframe");return e.id=t.adContainer.id,e.width=`${i.width}`,e.height=`${i.height}`,e.scrolling="no",e.frameBorder="0",e}getHighestBidById(t,i){const e=t[i]&&t[i].bids;return e?e.reduce(((t,i)=>t.cpm>i.cpm?t:i)):null}handleBidSuccess(t,i,e,s){var n;this.spot.bs({w:t.width,h:t.height}),i.display(this.Ye(null===(n=e.c.d)||void 0===n?void 0:n.a)),this.spot.isRefreshing()&&this.qe(),this.hasDfpBidder(e)||(this.renderAd(i,t),s({status:h.Status.SUCCESS,winnerName:t.bidder,args:{adUnit:"NA",adHeight:this.spot.implementedSize.h,provider:r.ProviderType.HEADER_BIDDING}}))}renderAd(t,i){if(t.isIframe)n.default.ci(t.adContainer),this.pbjsInstance.renderAd(t.win.document,i.adId);else{n.default.ci(t.adContainer);const e=this.buildIframe(t,i);t.adContainer=e,t.adWrapper.appendChild(e),e.setAttribute("style",`text-align:center;display: block;margin: auto;auto;width:100% !important; height:${this.spot.implementedSize.h}px !important; width: ${this.spot.implementedSize.w}px !important;`),this.pbjsInstance.renderAd(e.contentWindow.document,i.adId)}}appendPrebidJsToHead(t){if(!this.profile.prebidData||!this.profile.prebidData.prebidPath)return Promise.reject(h.Status.NO_URL);if(t.isIframe)return this.injectPbjsAndResolve(t,!1);const i=this.getInstanceName(t);return this.pbjsInstance=t.win[i],this.Fe.verbose(`checking ${i}`,this.pbjsInstance),this.pbjsInstance?f.isBrowsiPbjsExists?(this.Fe.verbose(`Using browsi ${i}`),this.usingBrowsiPbjs=!0,Promise.resolve(h.Status.SUCCESS)):this.pbjsInstance.version?0===this.pbjsInstance.version.indexOf("v0")?Promise.reject(h.Status.NOT_SUPPORTED):(this.Fe.verbose("Using publisher pbjs"),Promise.resolve(h.Status.SUCCESS)):this.injectPbjsAndResolve(t,!0):this.injectPbjsAndResolve(t,!0)}getInstanceName(t){var i;const e="pbjs";return t.iframe?e:(null===(i=this.profile.prebidData)||void 0===i?void 0:i.globalInstanceName)||e}injectPbjsAndResolve(t,i){return this.injectBrowsiPbjs(t),this.usingBrowsiPbjs=!0,i&&(f.isBrowsiPbjsExists=!0),Promise.resolve(h.Status.SUCCESS)}injectBrowsiPbjs(t){this.Fe.verbose("Injecting Browsi Pbjs"),t.win.pbjs=t.win.pbjs||{},this.pbjsInstance=t.win.pbjs,this.pbjsInstance.que=this.pbjsInstance.que||[];const i=n.default.ki(t.win.document),e=this.profile.prebidData.prebidPath;i.setAttribute("src",e),i.addEventListener("error",(()=>{o.default.get().sendErrorEvent(d.EventType.SCRIPT_LOAD_ERROR,e,"prebid")})),n.default.Mi(t.win.document).appendChild(i)}isValidBid(t){return t&&t.adUnitCode&&Array.isArray(window.browsiAdUnitCodes)&&-1!==window.browsiAdUnitCodes.indexOf(t.adUnitCode)||!1}getWinnerName(t,i){if(t.isEmpty)return"NA";{const e=n.default.Dt(t);return 1===e.w&&1===e.h?i?i.bidder:"NA":r.ProviderType.DFP}}getConfig(t){let i=Object.assign({enableSendAllBids:!0,debug:!!a.Profiler.get().debug},t?{bidderTimeout:t}:{});this.usingBrowsiPbjs&&(i=Object.assign(i,Object.assign(Object.assign({},c.default.prebidConf),this.profile.prebidConfig||{})));let e=u.default.getExternalFlowHandler("setPrebidConfig");return e&&e(i),this.Fe.info("Using Prebid configuration:",i),i}buildAdUnit(t,i,e,s){let n={};const r=t.reduce(((t,e)=>{switch(e.a&&this.handleBidAlias(e.a,e.bc.bidder),this.getBidName(e)){case"pulsepoint":return t.concat(this.buildPulsepointBids(e,s));case"ix":return t.concat(this.buildIXBids(e,s));case"ias":return t.concat(this.buildIASBids(e,i));case"unruly":return n=this.buildVideoMediaType(e),t.concat([e.bc]);default:return t.concat([e.bc])}}),[]);r.forEach((t=>{t.browsiSpot=this.spot.spotIndex}));const o=this.getGPID(e,i);return{code:e,mediaTypes:Object.assign({banner:{sizes:this.getPrebidSizes()}},n),ortb2Imp:{ext:{gpid:o,data:{pbadslot:o,adserver:{adslot:o}}}},bids:r||[]}}getGPID(t,i){return`${i?i.aup+"#":""}${t}`}handleBidAlias(t,i){const e=this.spot.newBrowsiAd&&this.spot.newBrowsiAd.isIframe,s=f.activeBidAlias[t]&&f.activeBidAlias[t]===i,n=e||!s;this.pbjsInstance&&n&&(e||(f.activeBidAlias[t]=i),this.pbjsInstance.que.push((()=>{this.pbjsInstance.aliasBidder(t,i)})))}buildPulsepointBids(t,i){return(n.default.yi(i)?this.ke(!1):[[i.w,i.h]]).map((i=>({bidder:t.bc.bidder,params:Object.assign(Object.assign({},t.bc.params),{cf:n.default.Si(i)})})))}buildIXBids(t,i){return(n.default.yi(i)?this.ke(!1):[[i.w,i.h]]).map((i=>({bidder:t.bc.bidder,params:Object.assign(Object.assign({},t.bc.params),{size:i})})))}buildIASBids(t,i){return[{bidder:t.bc.bidder,params:{pubId:t.bc.params.pubId,adUnitPath:(null==i?void 0:i.aup)||""}}]}buildVideoMediaType(t){const i=t.bc.params["video-context"],e=t.bc.params["video-width"],s=t.bc.params["video-height"];return i&&e&&s?{video:{context:i,playerSize:[[e,s]]}}:{}}getPrebidSizes(){return this.ke(!1)}getBidName(t){return t.a?t.a:t.bc.bidder}addConfigByProvider(t){t.forEach((t=>{switch(this.getBidName(t)){case"pubmatic":case"aardvark":this.pbjsInstance.setConfig({userSync:{filterSettings:{iframe:{bidders:"*",filter:"include"}}}})}}))}hasDfpBidder(t){return!!t.c.d}getPrebidWinner(t){return this.pbjsInstance.getHighestCpmBids().find((i=>i.adUnitCode===t))}}i.PrebidJs=f,f.isBrowsiPbjsExists=!1,f.activeBidAlias={}},8814:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5540);class r{constructor(){this.vendors=[],this.foundCRs=[],this.logger=new s.default("CR"),this.vendors=this.buildVendors()}static get(){return r.instance||(r.instance=new r),r.instance}getVendorsElements(){const t=this.findCR();return t.length?t.map((t=>t.element)):[]}isVendorNode(t){return this.vendors.some((i=>i.checkNode(t)))}isFound(t){return this.foundCRs.some((i=>i.element.isEqualNode(t)||n.default.Lt(t,i.element)))}findCR(){const t=document.getElementsByTagName("iframe"),i=[];return this.vendors.forEach((e=>{i.push(...this.getVendorData(e,document));for(let s=0;s<t.length;s++){if(!t[s])continue;let n;try{n=t[s].contentWindow.document}catch(t){}if(n)try{i.push(...this.getVendorData(e,n))}catch(t){}}})),this.foundCRs=i,i}getVendorData(t,i){let e=[];if(!t.selectors.length)return[];return Array.from(i.querySelectorAll(t.selectors.join(", "))).forEach((i=>{if(t.validateId&&!t.validateId(i.id))return;t.parent&&(i=i.parentNode);const s=this.createVendorData(t,i);s.is_visible&&e.push(s)})),e}createVendorData(t,i){return{type:t.key,width:this.getVendorSize(i).w,height:this.getVendorSize(i).h,offset_top:n.default.Z(i).y,fold:n.default.St(i),is_visible:this.isVendorVisible(i),element:i}}getVendorSize(t){const i=t.getBoundingClientRect();return{w:i.width,h:i.height}}isVendorVisible(t){const i=t.getBoundingClientRect();return!(i.width<2||i.height<2)}buildVendors(){return[this.buildVendor("taboola","Taboola",[".trc_rbox_container"],["taboola_view_id","_taboola"],(t=>"DIV"===t.tagName&&t.classList.contains("trc_rbox_container"))),this.buildVendor("outbrain","Outbrain",["[id^='outbrain_widget_']"],["outbrain","outbrain_rater"],(t=>"DIV"===t.tagName&&t.id.startsWith("outbrain_widget_"))),this.buildVendor("revcontent","Revcontent",["[id^='rcjsload_']"],[],(t=>"DIV"===t.tagName&&t.id.startsWith("rcjsload_"))),this.buildVendor("google","Google Matched Content",["ins.adsbygoogle[data-ad-format='autorelaxed']"],["adsbygoogle"],(t=>!("INS"!==t.tagName||!t.classList.contains("adsbygoogle")||!t.dataset)&&"autorelaxed"===t.dataset.adFormat)),this.buildVendor("gravity","Gravity",["[id^='grv-personalization-']"],[],(t=>"DIV"===t.tagName&&t.id.startsWith("grv-personalization-"))),this.buildVendor("contentAd","ContentAd",["[id^='contentad']"],[],(t=>!("DIV"!==t.tagName||!/^contentad\d+$/.test(t.id)||!t.parentElement||"DIV"!==t.parentElement.tagName)),!0,(t=>/^contentad\d+$/.test(t))),this.buildVendor("adblade","AdBlade",["ins.adbladeads + div.adblade-dyna"],[],(t=>!!("DIV"===t.tagName&&t.classList.contains("adblade-dyna")&&t.previousElementSibling&&"INS"===t.previousElementSibling.tagName&&t.previousElementSibling.classList.contains("adbladeads")))),this.buildVendor("zergnet","ZergNet",["[id^='zergnet-widget']"],[],(t=>"DIV"===t.tagName&&t.id.startsWith("zergnet-widget"))),this.buildVendor("viafoura","Viafoura",["[id^='gmg-vf-articles']"],[],(t=>"DIV"===t.tagName&&t.id.startsWith("gmg-vf-articles")))]}buildVendor(t,i,e,s,n,r,o){return{key:t,name:i,selectors:e,variables:s,checkNode:n,parent:r,validateId:o}}}i.default=r},3200:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),e(5540);const s=e(5540),n=e(2661),r=e(6389),o=e(4524);class h{constructor(){this.disqusSrc=new RegExp(/^.*disqus.com\/embed\/comments*/),this.spotimSrc=new RegExp(/^.*.spot.im*/),this.facebookCommentsRegex=new RegExp(/.*www.facebook.com.*plugins.*comments.php/),this.logger=new n.default("CommentSectionDetector"),this.profile=r.Profiler.get(),this.commentSections=[]}static get(){return h.instance||(this.instance=new h),h.instance}addIfComments(t){if(s.default.$t(t,!0)){let i;switch(t.nodeName){case"IFRAME":let e=s.default.zt(t);this.disqusSrc.test(e)?i=this.resolveCommentSection(t,"disqus"):this.spotimSrc.test(e)?i=this.resolveCommentSection(t,"spot.im"):this.facebookCommentsRegex.test(e)&&(i=this.resolveCommentSection(t,"facebook"));break;case"DIV":case"SECTION":i=this.ResolveCommentsClass(t)}i&&this.commentSections.push(i)}}reportCommentSection(){return this.commentSections.filter((t=>s.default.ut(t.element).h>0&&(t.element.childNodes.length>0||"IFRAME"==t.element.tagName))).map((t=>(this.logger.info("comment section to report ",t.element),{type:t.type,height:s.default.ut(t.element).h,offset_top:s.default.Z(t.element).y})))}getAllCommentSections(){return this.commentSections.filter((t=>s.default.ut(t.element).h>0&&(t.element.childNodes.length>0||"IFRAME"==t.element.tagName))).map((t=>t.element))}alreadyDetected(t){for(let i of this.commentSections){let e=i.element;if(t===e||s.default.isPositionContained(e,t)||s.default.isPositionContained(t,e))return!0;let n=Array.prototype.slice.call(e.childNodes);if(this.alreadyFound(t,n))return!0}return!1}alreadyFound(t,i){for(let e of i){if(t===e)return!0;let i=Array.prototype.slice.call(e.childNodes);if(this.alreadyFound(t,i))return!0}return!1}resolveCommentSection(t,i){if(this.alreadyDetected(t))return;let e=this.getSectionContainer(t);"boolean"!=typeof e&&(t=e);let n=window.getComputedStyle(t),r=n.height?parseInt(n.height):void 0,o=n.width?parseInt(n.width):void 0;if(r||(r=s.default.ut(t).h),o||(o=s.default.ut(t).w),Number.isInteger(r)&&r>0&&Number.isInteger(o)&&o>0){if(r<=50||o<=50){if(!this.hasLinkToComments(t))return;i="button"}return{element:t,type:i}}}ResolveCommentsClass(t){if(this.alreadyDetected(t))return;let i,e,n,r=t.classList;if(!s.default.zi(r,"icon")&&this.hasCommentLikeClasses(r,t)){if(this.isFacebookCommentSection(r,t))i="facebook";else if(this.isGigyaCommentSection(r))i="gigya";else if(this.isTalkbacksSection(r))i="talkbacks";else{let h=t.querySelectorAll("iFRAME");if(h.length>0){for(let a=0;a<h.length;a++)if(h[a].parentElement&&!o.default.isEmbeddedByBrowsi(h[a].parentElement,!1))this.addIfComments(h[a]);else if(i="native",e=this.hasForm(t),n=this.hasList(t)||s.default.zi(r,"comment")&&(s.default.zi(r,"list")||s.default.zi(r,"stream")||s.default.zi(r,"view")||s.default.zi(r,"all")),e||n)return{element:t,type:i};return}if(i="native",e=this.hasForm(t),n=this.hasList(t)||s.default.zi(r,"comment")&&(s.default.zi(r,"list")||s.default.zi(r,"stream")||s.default.zi(r,"view")||s.default.zi(r,"all")),!e&&!n)return}return{element:t,type:i}}}isTalkbacksSection(t){return s.default.zi(t,"talkback")}isGigyaCommentSection(t){return s.default.zi(t,"gig-comments")}isFacebookCommentSection(t,i){return i.id.indexOf("fb-comment")>-1||s.default.zi(t,"fb-comment")}hasCommentLikeClasses(t,i){return s.default.zi(t,"comment")||s.default.zi(t,"talkback")||i.id.indexOf("talkback")>-1||i.id.indexOf("comment")>-1||i.id.indexOf("respond")>-1}hasLinkToComments(t){let i=t.getAttribute("src");if(i&&i.indexOf("comment")>-1)return!0;let e=t.getAttribute("href");if(e&&e.indexOf("comment")>-1)return!0;if(t.hasChildNodes()){let i=t.children;for(let t=0;t<i.length;t++)if(this.hasLinkToComments(i[t]))return!0}return!1}getSectionContainer(t){let i=[],e=t.attributes;for(let t=0;t<e.length;t++)i.push(e.item(t).value);if(t&&("UL"===t.nodeName||"OL"===t.nodeName||s.default.zi(i,"comment")||s.default.zi(i,"talkback")||s.default.zi(i,"respond"))){let i=!!t.parentElement&&this.getSectionContainer(t.parentElement);return!1===i?t:i}return!1}hasForm(t){let i=t.querySelectorAll("FORM"),e=t.querySelectorAll("TEXTAREA");if(i.length>0||e.length>0){for(let t=0;t<i.length;t++)if(i[t].getBoundingClientRect().height>0)return!0;for(let t=0;t<e.length;t++)if(e[t].getBoundingClientRect().height>0)return!0}return!1}hasList(t){let i=t.querySelectorAll("UL,OL");if(i.length>0)for(let t=0;t<i.length;t++)if(i[t].getBoundingClientRect().height>0)return!0;let e=s.default.Ct(t),n=s.default.Ni([e+'//*[contains(@class,"comment") and (contains(@class,"list") or contains(@class,"content") or contains(@class,"stream") or contains(@class,"view") or contains(@class,"all") or contains(@class,"talkback") ) ]']);return n.length>0&&n[0].hasChildNodes()}resetCommentSections(){this.commentSections=[]}}i.default=h},7654:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5540),r=e(5594),o=e(2797),h=e(6389),a=e(1297),l=e(7559),c=e(1675),d=e(4524);var u;!function(t){t[t.VALID=0]="VALID",t[t.LAZY=1]="LAZY",t[t.INVALID=2]="INVALID"}(u||(u={}));class f{constructor(){var t,i;this.manualAdsSlots=[],this.logger=new s.default("Dfp Detector"),this.googletag=window.googletag||{},this.googletag.cmd=this.googletag.cmd||[],this.betweenAdsDistance=(null===(i=null===(t=h.Profiler.get().spotsSupplyParams)||void 0===t?void 0:t.dynamic)||void 0===i?void 0:i.distance)||0,this.isActive=!1,this.profile=h.Profiler.get();const e=h.Profiler.get().predictorsKeyValueNames;this.predictionKey=e.papaas||"browsiViewability",this.profile.manualDfpIframeAds&&(this.addManualAds(this.profile.manualDfpIframeAds.selectors),this.initRecheckManualAdsHook())}static start(){this.instance?this.instance.logger.info("already started"):(this.instance=new f,this.instance.logger.info("starting"),this.instance.run())}static restart(){this.instance?this.instance.checkFetchedSlots():this.start()}static setInactive(){this.instance&&(this.instance.isActive=!1)}initRecheckManualAdsHook(){const t=t=>{this.profile.manualDfpIframeAds&&this.addManualAds(this.profile.manualDfpIframeAds.selectors,t)},i=d.default.getExternalFlowHandler("recheckManualAds");i&&i(t)}run(){this.isActive=!0,this.listenToLazyAds(),this.checkFetchedSlots()}checkFetchedSlots(t){this.checkCurrentSlots(t),setTimeout((()=>this.checkCurrentSlots(t)),1e3)}getManualAdsSlots(){return this.manualAdsSlots}addManualAds(t,i=document){t.forEach((t=>{i.querySelectorAll(t).forEach((t=>{const i=t.querySelector("iframe");if(i&&n.default.Bi(i)){const e=i.contentWindow;if(e){const i=e.googletag=e.googletag||{};i.cmd=i.cmd||[];const s={element:t,window:e,provider:o.ProviderType.MANUAL_IFRAME_AD};this.checkFetchedSlots(s),this.listenToLazyAds(s)}}}))}))}getGoogleTag(t){return t?t.googletag:this.googletag}checkCurrentSlots(t){this.logger.verbose("checking current slots");const i=this.getGoogleTag(null==t?void 0:t.window);i.cmd.push((()=>{i.pubads().getSlots().forEach((i=>{let e=i.getSlotElementId();const s=((null==t?void 0:t.window)||window).document.getElementById(e);if(s&&i.getResponseInformation()){const e=this.validateSlot(s,i,t),n=(null==t?void 0:t.element)||s;if(e.status===u.VALID)return void r.default.get().addFoundProvider(n,this.getProviderType(i,t),this.betweenAdsDistance,!0,n.id,i.getAdUnitPath(),!1,i,e.size);if(e.status===u.LAZY)return void this.handleThirdPartySlowAdRendering(s,i,!0,t)}}))}))}validateSlot(t,i,e){const s=this.resolveInnerMostSingleChild(t),r=n.default.xt(s);return this.validationPassed((null==e?void 0:e.element)||t,i,!!e)?this.isRendered(s,r)?{status:u.VALID,size:r}:{status:u.LAZY}:{status:u.INVALID}}isRendered(t,i){return n.default.Pi(t)&&a.DFP.isValidSize(i)}listenToLazyAds(t){const i=this.getGoogleTag(null==t?void 0:t.window);i.cmd.push((()=>{const e=l.default.get();i.pubads().addEventListener("slotRenderEnded",(i=>{const s=e&&e.handleRenderEnded(i);if(this.isActive&&!i.isEmpty){const e=i.slot,n=e.getSlotElementId(),o=((null==t?void 0:t.window)||window).document.getElementById(n);if(o){const i=this.validateSlot(o,e,t),n=(null==t?void 0:t.element)||o;if(i.status===u.VALID)return void r.default.get().addFoundProvider(n,this.getProviderType(e,t),this.betweenAdsDistance,!1,n.id,e.getAdUnitPath(),!0,e,i.size);if(i.status===u.LAZY)return void this.handleThirdPartySlowAdRendering(n,e,!0,t);i.status===u.INVALID&&(s?r.default.get().addFoundProvider(n,this.getProviderType(e,t),this.betweenAdsDistance,!1,n.id,e.getAdUnitPath(),!0,e,i.size,"browsi"):this.isForcedRefreshed(n,e)&&r.default.get().addFoundProvider(n,this.getProviderType(e,t),this.betweenAdsDistance,!1,n.id,e.getAdUnitPath(),!0,e,i.size,"forced"))}}}))}))}handleThirdPartySlowAdRendering(t,i,e,s){this.waitForDeflating(t).then((n=>{this.logger.verbose("deflated to ",n);const o=(null==s?void 0:s.element)||t;r.default.get().addFoundProvider(o,this.getProviderType(i,s),this.betweenAdsDistance,!1,o.id,i.getAdUnitPath(),e,i,n)})).catch((i=>this.logger.verbose("did not deflate",i,t)))}validationPassed(t,i,e=!1){return!this.isBrowsiAd(i)&&!r.default.get().isDetectedAlready(t,e)&&(c.default.isInCurrentArticle(t)||c.default.isBetweenArticles(t,this.profile.dcs)||n.default.isFixed(t).status)}isForcedRefreshed(t,i){return!this.isBrowsiAd(i)&&r.default.get().isDetectedAlready(t)&&(c.default.isInCurrentArticle(t)||c.default.isBetweenArticles(t,this.profile.dcs)||n.default.isFixed(t).status)}isBrowsiAd(t){const i=t.getSlotElementId();return/^browsi_(ad.*)_ai_-?(\d+).*$/.test(i)}resolveAdSize(t){let i,e=t;for(;1===(i=this.getNonScriptChildren(e)).length;)e=i[0];return n.default.xt(e)}resolveInnerMostSingleChild(t){let i,e=t;for(;1===(i=this.getNonScriptChildren(e)).length;)e=i[0];return e}getNonScriptChildren(t){return Array.from(t.children).filter((t=>"SCRIPT"!==t.tagName))}waitForDeflating(t){return new Promise(((i,e)=>{let s=10;this.logger.verbose("waiting for deflation",t);const n=setInterval((()=>{const r=this.resolveAdSize(t);a.DFP.isValidSize(r)&&(clearInterval(n),i(r)),s--||(clearInterval(n),e(r))}),500)}))}getProviderType(t,i){if(i)return i.provider;const e=t.getTargetingKeys();return-1!=e.indexOf("hb_pb")&&-1!=e.indexOf("hb_size")?o.ProviderType.HEADER_BIDDING:o.ProviderType.DFP}}i.default=f},5594:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(2661),r=e(4436),o=e(7654),h=e(7016),a=e(2797),l=e(470),c=e(6448),d=e(83),u=e(8867),f=e(546),v=e(1482),p=e(6797),m=e(4042),g=e(6389),b=e(2641),w=e(1675),_=e(4524),y=e(5673),S=e(7899),O=e(1082);class A{constructor(){var t,i;this._foundAds=[],this.scanningTagNames="div,iframe,ins,header,class,section",this.profile=g.Profiler.get(),this.betweenAdDistance=(null===(i=null===(t=g.Profiler.get().spotsSupplyParams)||void 0===t?void 0:t.dynamic)||void 0===i?void 0:i.distance)||0,this.teadsSelector="teads-inread",this.unrulySelector="unruly_in_article_placement",this.logger=new n.default("ProvidersDetector"),this._foundAds=[],this.usingCustomRefresh=_.default.isCustomRefreshConfigured(),this.customRefreshBatch=[],this.waitingForCustomRefreshBatch=!0,this.usingCustomRefresh&&this.sendCustomRefreshBatch()}static get(){return this.instance||(this.instance=new A),this.instance}get foundAds(){return this._foundAds}shouldInjectMoat(t){return Math.floor(100*Math.random())<t}injectPublisherAdMoat(t,i){const{percentage:e,browsiIdOnly:n}=this.profile.publisherAdMoat;e&&(n?(null==i?void 0:i.getTargeting("browsiId").length)&&this.shouldInjectMoat(e)&&s.default.injectMoat(t,!1):this.shouldInjectMoat(e)&&s.default.injectMoat(t,!1))}addIfNew(t,i,e,n,o,l,d,p,g=!1,w){if(!w&&this.isDetectedAlready(t))return;if(this.isBrowsiGeneric(t))return;const _=this.getManualIframeWindow(i,t);let y=this.buildPublisherAd(t,i,e,n,o,l,d,p,w,g,_);const S=b.default.get().getFoundPublisherAdData(i,i===a.ProviderType.MANUAL_AD?t.id:n,y.refreshCount,d);y=this.updateFoundAdFromBptData(y,S),this.usingCustomRefresh&&d&&this.initRefreshRateRequest(y),this.updateFoundAds(y),c.default.instance.calculateMCSize(!0);let O=!1;"browsi"===y.refreshType&&this.profile.sendBrowsiImpressionDOMEvent&&(O=this.sendBrowsiImpressionDOMEvent(y)),r.default.get().sendFoundPublisherAd(y,S,O),i!==a.ProviderType.DFP||s.default.Yt(y.positionType)||u.default.get().increment(h.EventType.FOUND_PUBLISHER_AD),this.profile.pubAdsBidsPath&&this.sendPublisherAdBids(y),this.injectPublisherAdMoat.apply(this,[t,d]);const A=this.buildViewabilityDetails(y);return v.ViewabilityService.instance.subscribe(A,m.ViewabilityConfigurations.pubAdConfig(y.positionType),void 0,d,w),i===a.ProviderType.DFP&&d&&f.default.get().waitForPublisherAV(d,y),y.positionType}getManualIframeWindow(t,i){var e;if(t===a.ProviderType.MANUAL_IFRAME_AD)return(null===(e=i.querySelector("iframe"))||void 0===e?void 0:e.contentWindow)||void 0}initRefreshRateRequest(t){if(this.waitingForCustomRefreshBatch)this.customRefreshBatch.push(t);else{const i=this.getPublisherAdCustomRefreshRateParams(t);O.CustomRefreshRate.get().sendCustomRefreshRate(S.DemandRequestType.SINGLE,[i])}}sendCustomRefreshBatch(){setTimeout((()=>{if(this.waitingForCustomRefreshBatch=!1,this.customRefreshBatch.length){let t=this.customRefreshBatch.map((t=>this.getPublisherAdCustomRefreshRateParams(t)));O.CustomRefreshRate.get().sendCustomRefreshRate(S.DemandRequestType.SRA,t),this.customRefreshBatch=[]}}),1500)}getPublisherAdCustomRefreshRateParams(t){var i,e,s,n;return Object.assign(Object.assign(Object.assign(Object.assign({},t.adUnit?{au:t.adUnit}:{}),t.placementId?{id:t.placementId}:{}),(null===(i=t.gamResponseInfo)||void 0===i?void 0:i.lid)?{lid:null===(e=t.gamResponseInfo)||void 0===e?void 0:e.lid}:{}),(null===(s=t.gamResponseInfo)||void 0===s?void 0:s.oid)?{oid:null===(n=t.gamResponseInfo)||void 0===n?void 0:n.oid}:{})}sendBrowsiImpressionDOMEvent(t){const i={element:t.element,adUnit:t.adUnit,refreshCount:t.refreshCount};return s.default.dispatchDOMEvent(y.BROWSI_IMPRESSION_DOM_EVENT_NAME,i,window)}updateFoundAdFromBptData(t,i){return t.placementId=i.plid,t.providerName===a.ProviderType.MANUAL_AD&&(t.adUnit=i.plid),t}sendPublisherAdBids(t){window.dispatchEvent(new CustomEvent("getPbjsBids",{detail:{placementId:t.placementId,callback:t=>{r.default.get().sendPublisherAdBids(t)}}}))}updateFoundAds(t){t.refreshCount>0?this.foundAds.splice(this.foundAds.findIndex((i=>i.placementId===t.placementId)),1,t):this.foundAds.push(t)}isBrowsiGeneric(t){const i=d.default.getSpots().find((i=>!(!i.browsiAd||!s.default.isPositionContained(i.browsiAd,t))));return!i&&w.default.isSlides()?this.isBrowsiGenericFromPreviousSlide(t):!!i}isBrowsiGenericFromPreviousSlide(t){const i=w.default.getWindowObject();if(i){const e=w.default.getCurrentDcsElement(),n=Object.keys(i).map((t=>Number(t))).filter((t=>!isNaN(t))).sort(((t,i)=>t-i));for(let r in n){const n=i[r];if(n.element===e||s.default.isPositionContained(n.element,e)){const e=i[r].pvId;if(window.browsiOutput[e].getSpots().find((i=>i.browsiAd&&s.default.isPositionContained(i.browsiAd,t))))return!0}}}return!1}buildViewabilityDetails(t){return{element:t.element,adIndex:t.adIndex,byBrowsi:!1,Is:!0,positionType:t.positionType,placementId:t.placementId,adUnit:t.adUnit,provider:t.providerName,isLazyLoaded:t.isLazyLoaded,refreshCount:t.refreshCount,manualIframeWindow:t.manualIframeWindow}}buildPublisherAd(t,i,e,n,r,o,h,a,l,c=!1,d){let u=0,f=-1;if(l){const i=this._foundAds.find((i=>i.element===t));i&&(u=++i.refreshCount,f=i.adIndex)}let v=s.default.Z(t).y;const p=this.resolveElementSize(t,a);let m=this.getAdPositionType(t,p,v),g=s.default.Yt(m)?-1:Math.floor(v/s.default.L().height)+1;f=f>-1?f:this.foundAds.length,c&&(n=r=t.id||n+"_"+f);const b={providerName:i,positionType:m,element:t,topPos:v,foldNum:g,adIndex:f,width:p.w,height:p.h,stayAwayDistance:e,placementId:n,adUnit:r,isLazyLoaded:o,forcedRefresh:!(!l||"forced"!==l),refreshCount:u,isRefreshing:!1,refreshType:l,gamResponseInfo:s.default.getGAMResponseInfo(h),manualIframeWindow:d};return b.positionType=this.getAdPositionType(t,p,v,b),this.logger.style("%cFound provider ("+b.positionType+") on page: "+i+"("+b.width+"x"+b.height+")","background: #01ff70; color:#00662C; font-size:18px; font-weight:bold;",t),b}getAdPositionType(t,i,e,s){let n=c.default.instance.getAdPositionType(t,i.h,e,!0);return s&&n==p.AdPositionType.ABOVE_MC?c.default.instance.getAdPositionType(t,i.h,e):c.default.instance.getAdPositionType(t,i.h,e,!0)}scan(t,i=this.scanningTagNames){if(this.profile.scanThirdPartyProviders){const e=w.default.getCurrentDcsElement(),n=e instanceof Element?e:document;let r=Array.from(n.querySelectorAll(i));for(let i of r)switch(i.nodeName){case"P":default:this.handleThirdPartyProviders([i],t);break;case"IMG":s.default.$t(i,!0)&&this.handleThirdPartyProviders([i],t)}}return t&&(o.default.start(),this.logger.info("stayAwayElements after first scan,:",l.default.get().getStayAwayElements())),this.foundAds}handleThirdPartyProviders(t,i){if(0!==this.betweenAdDistance)for(let e of t){let t=!1;if(_.default.isEmbeddedByBrowsi(e,i)||(this.isUnruly(e)?t=this.addFoundProvider(e,a.ProviderType.UNRULY,this.betweenAdDistance,i,"NA","NA",!1):this.isTeads(e)?t=this.addFoundProvider(e,a.ProviderType.TEADS,this.betweenAdDistance,i,"NA","NA",!1):this.isILX(e)&&(t=this.addFoundProvider(e,a.ProviderType.ILX,this.betweenAdDistance,i,"NA","NA",!1))),!t&&"iframe"===e.tagName.toLowerCase()&&s.default.Bi(e)&&!_.default.isEmbeddedByBrowsi(e,i)&&!s.default.N(this.foundAds.map((t=>t.element)),e)){const t=e;let s=Array.prototype.slice.call(t.contentWindow.document.querySelectorAll(this.scanningTagNames));this.handleThirdPartyProviders(s,i)}}}addFoundProvider(t,i,e,n,r,o,h,a,c,d){const u=this.addIfNew(t,i,e,r,o,h,a,c,!1,d);return u&&!s.default.Yt(u)&&u!==p.AdPositionType.INTERSTITIAL&&l.default.get().upsertStayAwayElement(t,{distance:e,toDensity:!0},h,"provider"),!!u}isDetectedAlready(t,i=!1){return!(i||!s.default.Xt(window.document.body,t))||(!!this.foundAds.some((i=>i.element===t))||(!!s.default.N(this.foundAds.map((t=>t.element)),t)||this.foundAds.some((i=>s.default.N([t],i.element)))))}isVisibleAndMatchingSelector(t,i){const e=t;if(!s.default.B(e))return!1;if(s.default.$t(e,!0)&&"0px"!==window.getComputedStyle(e).height&&s.default.ut(e).h>50){if(e.classList.contains(i))return!0;{const t=Array.from(document.querySelectorAll(`.${i}`));if(t&&t.length>0&&s.default.N(t,e))return!0}}return!1}isTeads(t){return this.isVisibleAndMatchingSelector(t,this.teadsSelector)}isUnruly(t){return this.isVisibleAndMatchingSelector(t,this.unrulySelector)}isILX(t){return this.isVisibleAndMatchingSelector(t,"FIOnDemandWrapper")}isValid(t){if(!s.default.B(t))return!1;const i=s.default.ut(t),e=s.default.Bt(t);return i.w>50&&(!(i.h<60&&e&&e.document.body&&e.document.body.children&&0===Array.from(e.document.body.children).filter((t=>"SCRIPT"!==t.nodeName)).length)&&!(i.h<30))}getScanningTagNames(){return this.scanningTagNames}resolveElementSize(t,i){if(i)return i;{const i=t.getBoundingClientRect();return{w:i.width,h:i.height}}}}i.default=A},2350:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5540),r=e(6389);class o{constructor(){this.logger=new s.default("socialWidgetDetector"),this.profile=r.Profiler.get(),this.allSocialElements=[]}static get(){return o.instance||(this.instance=new o),o.instance}reportSocialElements(){return this.logger.info("social widgets to report ",this.allSocialElements.map((t=>t.element))),this.allSocialElements.filter((t=>{let i=n.default.ut(t.element);return i.h>5&&i.w>5})).map((t=>({type:t.type,height:n.default.ut(t.element).h,offset_top:n.default.Z(t.element).y})))}getAllSocialElements(){return this.logger.info("social widgets to report ",this.allSocialElements.map((t=>t.element))),this.allSocialElements.filter((t=>{let i=n.default.ut(t.element);return i.h>5&&i.w>5})).map((t=>t.element))}scanSocialElementsByType(t){let i="";switch(t){case"facebook":i='.fb-post, .fb-comment-embed, .fb-comments, .fb-quote, .fb-video, .fb-page,iframe[src*="www.facebook.com/plugins/comment_embed.php"],iframe[src*="www.facebook.com/plugins/post.php"],iframe[src*="www.facebook.com/plugins/video.php"],iframe[src*="www.facebook.com/plugins/page.php"]';break;case"twitter":i=".twitter-moment, .twitter-timeline, .twitter-grid, .twitter-tweet, twitter-widget";break;case"pintrest":i="span[class*=_embed_grid][class*=PIN],span[class*=_embed_pin][class*=PIN]";break;case"instagram":i="iframe.instagram-media"}n.default.querySelectorOnDocument(document,i).map((i=>{this.allSocialElements.push({element:i.element,type:t})}))}scanAllSocialWidgets(){this.allSocialElements=[],this.scanSocialElementsByType("facebook"),this.scanSocialElementsByType("pintrest"),this.scanSocialElementsByType("instagram"),this.scanSocialElementsByType("twitter")}isSocialWidgetOrInSocialWidget(t){for(let i=0;i<this.allSocialElements.length;i++)if(this.allSocialElements[i].element==t||n.default.isPositionContained(this.allSocialElements[i].element,t))return!0;return!1}}i.default=o},3434:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),e(5540);const s=e(5540),n=e(6875),r=e(2661);class o{constructor(){this.facebookSdkVideoRegex=new RegExp(/^.*www.facebook.com\/.*\/video.*$/),this.facebookIframeRegex=new RegExp(/^.*www.facebook.com\/plugins\/video.*$/),this.youTubeRegex=new RegExp(/^.*www.youtube.com\/embed\/.*$/),this.vimeoRegex=new RegExp(/^.*player.vimeo.com\/video\/.*$/),this.twitterStatusRegex=new RegExp(/^.*twitter.com\/.*\/status\/(\d+).*$/),this.nativeFileExtension=new RegExp(/^.*\.(avi|asv|mov|qt|flv|mp4|mpeg4|webm|wmv|divx)(\?(.*))?$/),this.nativeBlobFile=new RegExp(/^blob:.*$/),this.validMimeTypesForVideo=new RegExp(/^(video\/mp4|video\/webm|video\/ogg)$/),this.facebookSdkExists=!1,this.tweeterSdkExists=!1,this.foundVideoPlayers=new Array,this.facebookSdkExists=this.isFacebookSdkExists(),this.tweeterSdkExists=this.isTwitterSdkExists(),this.scanNativeVideoVendorsImplementation()}static get logger(){return this._logger||(this._logger=new r.default("video detection")),this._logger}static get(){return o.instance||(this.instance=new o),o.instance}getJwPlayerContainer(t){if("function"==typeof t.jwplayer){let i=t.jwplayer();if(i&&"function"==typeof i.getContainer)return i.getContainer()}}static getSerialized(t,i){return t.map((t=>(o.logger.info("found: ",t.element),t.serialized(i))))}isFacebookSdkExists(){return this.facebookSdkExists||!s.default.H(document.getElementById("fb-root"))}isTwitterSdkExists(){return this.tweeterSdkExists||!s.default.H(document.getElementById("twitter-wjs"))}isNodeVideo(t){let i=this.resolveVideoPlayer(t);if(!i&&"IFRAME"===t.nodeName){let e=s.default.Bt(t);if(e){let t=this.getJwPlayerContainer(e);t&&(i=new h(new n.default(t),"native"))}else{let i=s.default.Nt(t);for(let t of i){let i=this.resolveVideoPlayer(t.child);i&&i.height&&this.appendIfUnique(i)}}}return i||null}appendIfVideo(t){let i=this.isNodeVideo(t);i&&i.height&&this.appendIfUnique(i)}resetFoundVideoPlayers(){this.foundVideoPlayers=[]}reportVideos(){return o.logger.info("videos to report ",this.foundVideoPlayers.map((t=>t.element))),this.foundVideoPlayers.map((t=>({type:t.type,height:s.default.ut(t.element).h,offset_top:s.default.Z(t.element).y})))}appendIfUnique(t){this.alreadyDetected(t)||this.foundVideoPlayers.push(t)}resolveVideoPlayer(t){let i=s.default.zt(t);return this.resolveToYouTubePlayer(t,i)||this.resolveToFacebookPlayer(t,i)||this.resolveToVimeoPlayer(t,i)||this.resolveToTwitterPlayer(t)||this.resolveToNativePlayer(t,i)}resolveToFacebookPlayer(t,i){if(this.isFacebookSdkImplementation(t,i)||this.isFacebookIframeImplementation(t,i))return new h(new n.default(t),"facebook")}resolveToNativePlayer(t,i){let e;switch(t.nodeName){case"VIDEO":this.isValidNativeLink(t,i)&&(e=new h(new n.default(t),"native"));let r=s.default.Nt(t);for(let t of r)this.isValidNativeLink(t.parent?t.parent:t.child,s.default.zt(t.child))&&(e=new h(t,"native"));break;case"LINK":if(this.isValidNativeLink(t,i)){let i=t.parentElement?t.parentElement:void 0;e=new h(new n.default(t,i),"native")}}return e}scanNativeVideoVendorsImplementation(){this.appendNativeVendorsImplementations(window),Array.from(document.getElementsByTagName("iframe")).forEach((t=>{let i=s.default.Bt(t);i&&this.appendNativeVendorsImplementations(i,t)})),o.logger.info("native vendors implementations: ",this.foundVideoPlayers)}appendNativeVendorsImplementations(t,i){let e=this.getJwPlayerContainer(t);if(e){let t=new h(new n.default(e,i),"native");t&&t.height&&this.appendIfUnique(t)}}isValidNativeLink(t,i){if(i){if(this.nativeFileExtension.test(i)||this.nativeBlobFile.test(i))return!0;if("VIDEO"===t.nodeName)for(let i of s.default.Nt(t))if("SOURCE"===i.child.nodeName&&i.child.hasAttribute("type")){let t=i.child.getAttribute("type")||"";if(this.validMimeTypesForVideo.test(t))return!0}}return!1}resolveToYouTubePlayer(t,i){if(this.youTubeRegex.test(i))return new h(new n.default(t),"youtube")}resolveToVimeoPlayer(t,i){if(this.vimeoRegex.test(i))return new h(new n.default(t),"vimeo")}resolveToTwitterPlayer(t){if(t.classList.contains("twitter-video")&&t.classList.contains("twitter-video-rendered")){let i=t.getAttribute("data-tweet-id");if(i){let e=s.default.Nt(t);for(let t of e){let e=s.default.zt(t.child),n=this.twitterStatusRegex.exec(e);if(n&&n.length>1&&n[1]===i)return new h(t,"twitter")}}}else if("TWITTER-WIDGET"===t.nodeName&&(s.default.querySelectorOnDocument(t,".PlayButton").length>0||s.default.querySelectorOnDocument(t,".wvp-player-container").length>0))return new h(new n.default(t),"twitter")}isFacebookSdkImplementation(t,i){return!(!this.isFacebookSdkExists()||!t.classList.contains("fb-video"))&&this.facebookSdkVideoRegex.test(i)}isFacebookIframeImplementation(t,i){return"IFRAME"===t.nodeName&&this.facebookIframeRegex.test(i)}alreadyDetected(t){for(let i of this.foundVideoPlayers)if(i===t||i.offset_top===t.offset_top||i.xpath===t.xpath)return!0;return!1}}i.default=o;class h{constructor(t,i){this.type=i.toString();let e=t.parent?t.parent:t.child;this.element=e,this.location=s.default.St(this.element),this.offset_top=s.default.Z(this.element).y;let n=this.getValidSize(t);this.xpath=s.default.Ct(t.child),this.height=n.h,this.width=n.w}getValidSize(t){let i=s.default.ut(t.child);return i.h&&i.w||!t.parent||(i=s.default.ut(t.parent)),i}serialized(t){let i={type:this.type,location:this.location,width:this.width,height:this.height,offset_top:this.offset_top};return t&&(i.xpath=this.xpath),i}}},546:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(4436),r=e(6389);class o{constructor(){this.logger=new s.default("activeViewViewability"),this.isActive=!!r.Profiler.get().activeView}static get(){return o.instance||(this.instance=new o),o.instance}waitForPublisherAV(t,i){if(!this.isActive)return;const e=i.refreshCount;window.googletag.pubads().addEventListener("impressionViewable",(s=>{s.slot==t&&e===i.refreshCount&&n.default.get().sendViewedPublisherAdAV(i)}))}waitForBrowsiAV(t,i,e,s){if(!this.isActive)return;i.win.googletag.pubads().addEventListener("impressionViewable",(i=>{i.slot==t&&n.default.get().sendViewedImpressionAV(s,e)}))}}i.default=o},5780:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(2661),r=e(5594),o=e(83),h=e(6448),a=e(470),l=e(6797),c=e(5106),d=e(6389),u=e(5353);class f{constructor(){this.positionsToDensity=[l.AdPositionType.WITHIN_MC,l.AdPositionType.STICKY_TOP,l.AdPositionType.STICKY_BOTTOM],this.fluidDensitySize={w:300,h:250}}get densityCap(){return this._densityCap}static get instance(){return this._instance||(this._instance=new f),this._instance}init(t,i,e){this.logger=new n.default("AdDensity"),this._densityCap=e?Number((e/100).toFixed(2)):0,this.debugMode=t||!1,this.manualSA=a.default.get().getStayAwayElements();const s=d.Profiler.get().admarking;this.adMarkingSize=s&&s.active?32:0,this.densityRequests=0}getPublisherAdDensity(){return this.calculateAdsDensity(this.getMainContentPublisherAds(),"publisher")}getTotalAdDensity(){return this.densityRequests++,this.densityRequests%5==0&&(h.default.instance.calculateMCSize(!0),this.recalculateAdsPositionType(),this.densityRequests=0),this.calculateAdsDensity(this.getMainContentAds(),"total")}calculateAdsDensity(t,i){let e=h.default.instance.calculateMCSize()||0,n=this.getAccumulatedHeight(t),r=s.default.Wt(n,e);return this.debugMode&&this.logger.verbose(`(${i}) density: ${n} / ${e} = ${r}. `,t.map((t=>[t.type,t.element]))),r}canEmbedAd(t,i){if(t.isRefreshing())return!0;let e=this.getPotentialAdSize(i);if(!e)return!0;if(!this._densityCap)return!0;if(!h.default.instance.withinMainContent(t.ref))return!0;const n=this.getAccumulatedHeight(this.getMainContentAds())+e.h,r=h.default.instance.calculateMCSize()+e.h+this.adMarkingSize,o=s.default.Wt(n,r);return this.logger.verbose(`spot ${t.spotIndex}, expected density: ${n}/${r}=${o}`),o<=this._densityCap}getManualSAElements(){return this.manualSA.filter((t=>t.toDensity&&this.isPositionToDenity(t.positionType))).map((t=>({type:c.AdType.SA_TO_DENSTIY,positionType:t.positionType,element:t.element})))}isPositionToDenity(t){return!!this.positionsToDensity.find((i=>i===t))}recalculateAdsPositionType(){this.logger.verbose("recalculating position_type"),this.manualSA.forEach((t=>{t.positionType=h.default.instance.getAdPositionType(t.element,t.element.getBoundingClientRect().height,s.default.Z(t.element).y)})),r.default.get().foundAds.forEach((t=>{t.positionType=h.default.instance.getAdPositionType(t.element,t.element.getBoundingClientRect().height,s.default.Z(t.element).y,!0)})),o.default.getEmbeddedSpots().forEach((t=>{t.browsiAd&&t.type!==u.SpotType.STICKY&&(t.positionType=h.default.instance.getAdPositionType(t.browsiAd,t.browsiAd.getBoundingClientRect().height,s.default.Z(t.browsiAd).y))}))}getMainContentPublisherAds(){let t=r.default.get().foundAds.filter((t=>t.positionType!=l.AdPositionType.INTERSTITIAL&&(t.positionType==l.AdPositionType.STICKY_TOP||t.positionType==l.AdPositionType.STICKY_BOTTOM||h.default.instance.withinMainContent(t.element)))).map((t=>({type:c.AdType.PUBLISHER_AD,positionType:t.positionType,element:t.element}))),i=this.getManualSAElements();if(i.length){const e=t.map((t=>t.element));i=i.filter((t=>-1===e.indexOf(t.element)&&!s.default.N(e,t.element)&&!e.some((i=>s.default.Lt(i,t.element)))))}return[...t,...i]}getMainContentBrowsiAds(){return o.default.getEmbeddedSpots().filter((t=>{let i=t.browsiAd;return i&&h.default.instance.withinMainContent(i)})).map((t=>{var i;return{type:c.AdType.BROWSI_AD,positionType:l.AdPositionType.WITHIN_MC,element:t.isRefreshing()&&(null===(i=t.refresh)||void 0===i?void 0:i.oldBrowsiAd)?t.refresh.oldBrowsiAd.adContainer:t.newBrowsiAd.adContainer}}))}getMainContentAds(){return this.getMainContentBrowsiAds().concat(this.getMainContentPublisherAds())}getAccumulatedHeight(t){return t.reduce(((t,i)=>t+i.element.getBoundingClientRect().height),0)}getPotentialAdSize(t){const i=t.map((t=>s.default._i(t)?this.fluidDensitySize:t));return i.length?i.reduce(((t,i)=>t.h>i.h?t:i)):null}}i.default=f},8867:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(7016),r=e(5540),o=e(8562),h=e(4436),a=e(6389),l=e(1496),c=e(9504);class d{constructor(){this.storageKey="__bus",this.prebidStorageKey="__brtd",this.maxTimeInView=7,this.maxFetchLatency=5e3,this.maxVelocity=5e3,this.newDataToFlush=!1,this._visitBrowsiImpressions=0,this.logger=new s.default("BrowsiAnalytics"),this.browsiTimeInView={},this.publisherTimeInView={},this.pvUv=this.getEmptyPvUv(),this._analytics=this.buildMergedAnalytics(),this.measurement={previousYOffset:0,previousTime:0,timeLeft:3e5,startTime:0,started:!1,interval:null,timeout:null},this.sessionId=a.Profiler.get().sessionID,this.userId=r.default.Ci("__browsiUID"),c.default.hasUserConsent?(this.flushRequest(),this.flush(),this.startFlushInterval()):(r.default.xi(this.storageKey),r.default.xi(this.prebidStorageKey))}get analytics(){return this._analytics}get currentVisitImpressions(){return this._visitBrowsiImpressions}startFlushInterval(){this.flushInterval||(this.flushInterval=setInterval((()=>{this.newDataToFlush&&this.flush()}),5e3),this.logger.info("started flushInterval"))}static get(){return d.instance||(d.instance=new d),d.instance}sendAnalyticsEvent(){c.default.hasUserConsent&&this._analytics.c>1?h.default.get().sendAnalyticsEvent(this._analytics):this.logger.info("first time user, no event")}startMeasurements(){c.default.hasUserConsent&&!this.measurement.started&&(this.startInterval(),this.startFlushInterval(),this.measurement.started=!0,o.default.instance.subscribe((t=>this.handleOOF(t))))}increment(t,i){switch(t){case n.EventType.FOUND_PUBLISHER_AD:this._analytics.pi++;break;case n.EventType.VIEWED_PUBLISHER_AD:this._analytics.pv++;break;case n.EventType.AD_IMPRESSION:this._analytics.bi++,0==i&&this._visitBrowsiImpressions++;break;case n.EventType.VIEWED_IMPRESSION:this._analytics.bv++;break;case n.EventType.AD_REQUEST_BLOCKED:this._analytics.aof.l_oof++;break;case n.EventType.AD_REQUEST:this._analytics.aof.l_ar++;break;default:return}this.flushRequest()}browsiImpression(t,i){this.increment(n.EventType.AD_IMPRESSION,i),t=Math.min(t,this.maxFetchLatency),this.logger.verbose(`adding ${t}ms to aul`),this._analytics.aul={a:r.default.getWeightedAvg(this._analytics.aul.a,this._analytics.aul.i,t,1),i:this._analytics.aul.i+1},this.flushRequest()}updateAvgWiningBid(t){t=t&&t>-1?t:0;let i=this._analytics.ahb||0,e=this._analytics.nam||0;i=(i*e+t)/(e+1),e++,this._analytics.ahb=i,this._analytics.nam=e,this.flushRequest()}handleOOF(t){if(this.measurement.timeLeft>0)if(t){clearInterval(this.measurement.interval),this.measurement.interval=null,clearInterval(this.flushInterval),this.flushInterval=null,clearTimeout(this.measurement.timeout),this.measurement.timeout=null,this.logger.info("user is out, intervals and timeout cleared");const t=Date.now();this.measurement.timeLeft-=t-this.measurement.startTime}else c.default.hasUserConsent&&(this.logger.info("user is back"),this.startInterval(),this.startFlushInterval(),this.startFlushInterval())}startInterval(){this.measurement.timeLeft>0?(this.logger.verbose(`initiating interval for ${this.measurement.timeLeft/1e3} s`),this.measurement.previousYOffset=r.default._(),this.measurement.previousTime=r.default.vi(),this.measurement.startTime=Date.now(),this.measurement.interval||(this.measurement.interval=setInterval((()=>{const t=r.default.vi(),i=r.default._();this.pvUv=this.getNewAuv(i,t),this._analytics.uv=Object.assign(this._analytics.uv,this.pvUv),this.logger.verbose("auv: ",JSON.parse(JSON.stringify(this._analytics.uv))),this.measurement.previousYOffset=i,this.measurement.previousTime=t,this.flushRequest()}),1e3)),this.measurement.timeout||(this.measurement.timeout=setTimeout((()=>{clearInterval(this.measurement.interval),this.measurement.interval=null,this.measurement.timeLeft=0,this.logger.verbose("stopping interval")}),this.measurement.timeLeft))):this.logger.verbose(`measurementTimeLeft: ${Math.max(0,this.measurement.timeLeft/1e3)} s, not initiating interval`)}getNewAuv(t,i){const e=this.getVelocity(t,i,this.measurement.previousYOffset,this.measurement.previousTime),s=r.default.clone(this.pvUv);return e>0?(s.pv_a=r.default.getWeightedAvg(s.pv_a,s.pv_i,e,1),s.pv_i++):(s.pv_sp=Math.min(parseFloat(r.default.avg(s.pv_si,s.pv_si+s.pv_i).toFixed(2)),1),s.pv_si++),s}getVelocity(t,i,e,s){const n=Math.abs(t-e),r=Math.max(i-s,1),o=r>0?parseFloat(Math.min(n/r,this.maxVelocity).toFixed(2)):0;return this.logger.verbose(`velocity: ${o} = (timeDelta:${r})/(pixelDelta:${n})`),o}flush(){r.default.Ri(this.storageKey,JSON.stringify(this._analytics)),this.newDataToFlush=!1,this.logger.verbose("flushed:",JSON.parse(JSON.stringify(this._analytics))),this.prebidFlush()}prebidFlush(){const t={bi:this._analytics.bi,bv:this._analytics.bv,pi:this._analytics.pi,pv:this._analytics.pv,bativ:this._analytics.tiv.b_ativ,uva:this._analytics.uv.t_a,uvs:this._analytics.uv.t_sp,oof:this._analytics.aof.t_a,sid:this.sessionId,uid:this.userId};r.default.Ri(this.prebidStorageKey,JSON.stringify(t)),this.logger.verbose("set Prebid storage:",JSON.stringify(t))}buildMergedAnalytics(){let t=this.getEmptyAnalytics();if(c.default.hasUserConsent)try{t=Object.assign(t,JSON.parse(r.default.Ci(this.storageKey))),t.tiv=this.mergePreviousAvgTimeInView(t.tiv),t.uv=this.mergePreviousUv(t.uv),t.aof=this.mergePreviousAvgOof(t.aof)}catch(t){this.logger.error(`failed to parse storage with key ${this.storageKey}, ${r.default.Ci(this.storageKey)}`)}return t.c++,t}mergePreviousAvgTimeInView(t){let i=this.getEmptyTimeInViewStructure();return t&&(i.b_ativ=r.default.getWeightedAvg(t.b_ativ||0,t.b_ai||0,t.b_pv_ativ||0,t.b_pv_ai||0),i.b_ai=t.b_ai+(t.b_pv_ai||0),i.p_ativ=r.default.getWeightedAvg(t.p_ativ||0,t.p_ai||0,t.p_pv_ativ||0,t.p_pv_ai||0),i.p_ai=t.p_ai+(t.p_pv_ai||0),i.b_pv_ativ=0,i.b_pv_ai=0),i}mergePreviousUv(t){let i=this.getEmptyUv();return t&&(i.t_a=r.default.getWeightedAvg(t.t_a||0,t.t_i||0,t.pv_a||0,t.pv_i||0),i.t_i=(t.t_i||0)+(t.pv_i||0),i.pv_a=0,i.pv_i=0,i.t_si=(t.t_si||0)+(t.pv_si||0),i.t_sp=r.default.getWeightedAvg(t.t_sp||0,t.t_si||0,t.pv_sp||0,t.pv_si||0)),i}mergePreviousAvgOof(t){let i=this.getEmptyAvgOofStructure();if(t){if(0===t.l_oof&&0===t.l_ar)return t;let e=0;0===t.l_ar?e=1:0!=t.l_oof&&(e=t.l_oof/(t.l_oof+t.l_ar)),i.t_a=r.default.getWeightedAvg(t.t_a||0,t.t_i||0,e||0,1),i.l_ar=0,i.l_oof=0,i.t_i=t.t_i+1}return i}getEmptyAnalytics(){return{c:0,bi:0,bv:0,pi:0,pv:0,tiv:this.getEmptyTimeInViewStructure(),aul:{a:0,i:0},uv:this.getEmptyUv(),aof:this.getEmptyAvgOofStructure()}}getEmptyUv(){return Object.assign({t_a:0,t_i:0,t_sp:0,t_si:0},this.getEmptyPvUv())}getEmptyPvUv(){return{pv_a:0,pv_i:0,pv_sp:0,pv_si:0}}getEmptyTimeInViewStructure(){return{b_pv_ativ:0,b_pv_ai:0,b_ativ:0,b_ai:0,p_pv_ativ:0,p_pv_ai:0,p_ativ:0,p_ai:0}}getEmptyAvgOofStructure(){return{l_ar:0,l_oof:0,t_a:0,t_i:0}}updateTimeInView(t,i,e,s,n){var o;const h=t==l.TimeInViewType.BROWSI,a=h?i.spotIndex:i,c=h?(null===(o=i.refresh)||void 0===o?void 0:o.lastSuccessfulRefresh)||0:e,d=h?this.browsiTimeInView:this.publisherTimeInView;if(this.shouldUpdateTimeInView(d,a,c)){r.default.H(d[a])&&(d[a]={});const t=d[a][c]||0;d[a][c]=Math.min(Math.floor(Math.max(t,n)),this.maxTimeInView);const{sum:i,items:e}=this.getCurrentTimeInView(d);h?(this._analytics.tiv.b_pv_ai=e,this._analytics.tiv.b_pv_ativ=r.default.avg(i,e)):(this._analytics.tiv.p_pv_ai=e,this._analytics.tiv.p_pv_ativ=r.default.avg(i,e)),this.flushRequest()}}shouldUpdateTimeInView(t,i,e){return r.default.H(t[i])||!e||r.default.H(t[i][e])||t[i][e]<this.maxTimeInView}getCurrentTimeInView(t){let i=0,e=0;for(let s of Object.keys(t))for(let n of Object.keys(t[s]))i+=t[s][n],e+=1;return{sum:i,items:e}}flushRequest(){this.newDataToFlush=!0}}i.default=d},9504:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6389),n=e(5540);i.default=class{static get hasUserConsent(){return this.updateConsentStatus(),this.hasConsent}static get location(){return"string"!=typeof this._location&&null!==this._location&&(this._location=s.Profiler.get().userAnonymousContinent||null),this._location}static get prebidConf(){let t=null;return"eu"===this.location?t={gdpr:{cmpApi:"iab",allowAuctionWithoutConsent:!0,timeout:1e3}}:"us"===this.location&&(t={usp:{cmpApi:"iab",timeout:1e3}}),t?{consentManagement:t}:null}static updateConsentStatus(){const t=this.getCurrentConsentType();this.hasConsent=!t||this.getConsentStatus(t)}static getConsentStatus(t){const i=n.default.getBrowsiTag();return i&&i.__cs&&"function"==typeof i.__cs[t]?i.__cs[t]():this.hasConsent}static getCurrentConsentType(){if(this.location){if("eu"===this.location)return"gdpr";if("us"===this.location)return"ccpa"}return null}}},2641:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(2661),r=e(2797);class o{constructor(){this.logger=new n.default("BptBrowsiFunctions"),this.bptBrowsiFunctions=o.getBptBrowsiService()}static get(){return this._instance||(this._instance=new o),this._instance}static getBptBrowsiService(){const t=s.default.getBrowsiTag();return t&&"object"==typeof t.__bbs?t.__bbs:null}getFoundPublisherAdData(t,i,e,s){const n={plid:i};switch(t){case r.ProviderType.DFP:case r.ProviderType.HEADER_BIDDING:if(s)return this.invokeBptFunction({p:r.ProviderType.DFP,args:{slot:s,rc:e}})||n;break;case r.ProviderType.MANUAL_AD:return this.invokeBptFunction({p:r.ProviderType.MANUAL_AD,args:{plid:i,rc:e}})||n}return n}invokeBptFunction(t){if(this.bptBrowsiFunctions&&"function"==typeof this.bptBrowsiFunctions.g_fpa_d)try{let i=this.bptBrowsiFunctions.g_fpa_d(t);return i.praw=parseFloat(i.praw),this.logger.info("request: ",t," response: ",i),i}catch(i){this.logger.info("failed to get data from bpt",t)}return null}}i.default=o},6879:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(2478),r=e(5594),o=e(5540),h=e(4436),a=e(5690),l=e(8562),c=e(7654),d=e(6448),u=e(9008),f=e(1482),v=e(5662),p=e(6389),m=e(9150),g=e(83),b=e(4141),w=e(1675),_=e(3486),y=e(5353),S=e(2350),O=e(3200),A=e(8814),j=e(549),E=e(7966),I=e(1031);class P{constructor(t,i,e,n){if(this.dcsType=t,this.mutationConfig=e,this.mutationElement=i,this.profile=p.Profiler.get(),this.actionCounter=w.default.getDcsActionCounter(),this.windowObject=window[w.default.windowVarName],w.default.setCurrentEndlessPvid(this.profile.pageViewID),this.logger=new s.default(`DCS ${t}`),n){if("slides"!==t){let i;w.default.isDcsPageview()&&(i=w.default.getCurrentDcsElement()),this.spotEngine=u.default.get(),this.spotEngine.setTargetElements(i instanceof Element?[i]:[]),"readMore"===t?this.runPageStructureReport():this.runSpotEngine(!0,!0)}}else this.runPageStructureReport()}createObserver(){"readMore"!==this.dcsType&&(this.observer=new MutationObserver((t=>this.mutationsHandler(t))),this.observer.observe(this.listenElement||document.body,this.mutationConfig))}removeObserver(){this.observer&&this.observer.disconnect()}sendDcsEvent(t,i,e,s){const n=P.getSpotsResults(t,i);h.default.get().sendDcs(t,n.dynamicResults.spotsFound,null!=e?e:n.dynamicResults.maxItems,n.fixedResults.spotsFound,null!=s?s:n.fixedResults.maxItems)}incrementActionCounter(){this.actionCounter++,this.windowObject.count=this.actionCounter}runPageStructureReport(){d.default.instance.findMainContent(r.default.get().foundAds,A.default.get().findCR(),O.default.get().getAllCommentSections(),S.default.get().getAllSocialElements()),c.default.start(),r.default.get().scan(!1)}removeSpotsFromDOM(){g.default.getNonStickySpots().forEach((t=>{m.Embedder.Ps(t)}))}runNewMiddy(t){h.default.get().flushEventsQue(),this.clearExternalServices(),this.keepStickyReference(),this.stopObservers(),this.resetWindowObjects(),this.injectBootstrap(t)}injectBootstrap(t){this.logger.info("injecting bootstrap "+(t?"with siteKey: "+t:""));const i=o.default.Ht(t);i&&i.parentElement&&(this.logger.info("removing old bootstrap tag",i),i.parentElement.removeChild(i))}resetWindowObjects(){window.browsi_bootstrap_loaded=!1,window._middyo=null}stopObservers(){var t;c.default.setInactive(),(null===(t=this.spotEngine)||void 0===t?void 0:t.lazyDetector)&&this.spotEngine.lazyDetector.removeObserver(),l.default.instance.unsubscribe()}runSpotEngine(t,i,e){return new Promise(((s,r)=>{E.DemandTool.get().holdEngineForRelocation().then((()=>{this.logger.info("Running SpotEngine");const r=w.default.getDcsActionCounter(),o={isDcs:r&&r>0||this.actionCounter>0,type:this.dcsType,actionCounter:this.actionCounter,slides:e};return n.default.run(this.spotEngine,this.profile,t,i,o),i||this.profile.analysisMode||a.YieldClient.get().Ze(g.default.getNonStickySpots().filter((t=>!t.browsiAd))),s()}))}))}getDcsType(){return this.dcsType}getActionCounter(){return this.actionCounter}clearExternalServices(){v.default.get().removeAll(),f.ViewabilityService.instance.clearBeforeDcs(),I.Engagement.get().unsubscribe()}keepStickyReference(){const t=g.default.getStickySerializedSpots();t&&(this.windowObject[b.StickyConstants.dcsVar]=t)}static getSpotsResults(t,i){i=i||g.default.getSpots();return{fixedResults:{maxItems:_.default.getFixedTotalMaxItems(),spotsFound:i.filter((t=>"fi"===t.tags.typeTag)).length},dynamicResults:{maxItems:j.SpotsUtils.getDynamicMaxItems(),spotsFound:i.filter((t=>t.type==y.SpotType.DYNAMIC)).length}}}}i.default=P},7920:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(132),n=e(4410),r=e(6767),o=e(9696),h=e(514),a=e(2643);i.default=class{static createDCS(t,i){switch(t){case"gallery":return new s.default("gallery",i,!0);case"readMore":return new n.default("readMore",i,!0);case"spa":return new o.default("spa",i,!0);case"endlessScroll":return new r.default("endlessScroll",i,!0);case"slides":return new h.default("slides",i,!0);case"manual":return new a.default("manual",!0);default:return null}}}},4222:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6389),n=e(2661),r=e(1482),o=e(9150),h=e(5662),a=e(7654),l=e(7559),c=e(4436),d=e(7016),u=e(5540),f=e(83),v=e(8562),p=e(9008),m=e(6879),g=e(1675),b=e(4524),w="browsiDcs";i.DcsApi=class{constructor(t,i){this.logger=new n.default("dcsAPI"),this.logger.info("started"),this.Ms(i,t)}Ms(t,i){window[g.default.windowVarName]=window[g.default.windowVarName]||{dcsType:"script"},this.injectDcsScript(t,(()=>{this.logger.info("DCS script loaded, firing dcsAPI event"),window.top.dispatchEvent(new CustomEvent("dcsAPI",{detail:this.api(i)}))}))}api(t){return{getSpotsMap:()=>{const t=this.getMappedSpots();return this.logger.info("getSpotsMap "+this.getPv(),t),t},removeSpots:t=>{const i=t.map(this.removeSpot.bind(this)),e=i.filter(Boolean);return this.logger.info(`removed ${i.length}/${e.length} spots`,this.getPv()),e.length===i.length},refreshSpots:t=>{const i=this.refreshSpots(t);return this.logger.info("refreshedSpots "+this.getPv(),i),i},getSaObjects:t=>g.default.getSaObjects(t),injectEngine:()=>(this.logger.info("InjectEngine "+this.getPv()),this.runNewPv()),rebuildProfile:i=>{this.logger.info("rebuildProfile","changes:",i,"original",t,this.getPv()),s.Profiler.mergeDeep(t,i);return s.Profiler.rebuild(t)},clearListeners:()=>this.clearListeners(),reportError:t=>{c.default.get().sendErrorEvent(d.EventType.CRASH,t.filename,t.message)},getPossibleSpots:t=>p.default.get().collect(!1,t,void 0,!0),pageViewId:s.Profiler.get().pageViewID}}injectDcsScript(t,i){if(!window.top.document.getElementById(w)){this.logger.info("Injecting Browsi Dcs Script");const e=u.default.ki(window.top.document);return e.setAttribute("src",t),e.id=w,e.onload=i,e.addEventListener("error",(()=>{c.default.get().sendErrorEvent(d.EventType.SCRIPT_LOAD_ERROR,t,"DcsScript")})),window.top.document.head.appendChild(e),e}i()}getPv(){return s.Profiler.get().pageViewID}getSpots(){return f.default.getSpots()}getMappedSpots(){const t=this.getSpots(),i={};return t.forEach((t=>{var e;const s=f.default.serialize(t);i[t.tags.positionTag]=i[t.tags.positionTag]||[],null===(e=i[t.tags.positionTag])||void 0===e||e.push(s)})),i}removeSpot(t){const i=this.getSpots().find((i=>i.spotIndex===t.spotIndex));let e=!1;return i&&(i.destoryDFPSlot(),r.ViewabilityService.instance.unsubscribe(i),e=o.Embedder.Ps(i)),this.logger.info(`Spot ${e?"":"not"} removed from DOM`,t),e}refreshSpots(t){const i=t.map(this.createSpotFromSerialized);return i.forEach((t=>t.Ts())),i}clearListeners(){h.default.get().removeAll(),a.default.setInactive(),v.default.instance.unsubscribe();try{b.default.getLazySpotsInstance().stopService()}catch(t){this.logger.error(t)}const t=l.default.get();t&&(t.config.active=!1),r.ViewabilityService.instance.clearBeforeDcs()}runNewPv(){this.logger.info("runNewPv"),window.browsi_bootstrap_loaded=!1,window._middyo=null,this.logger.info("injecting bootstrap");const t=u.default.Ht();t&&t.parentElement&&t.parentElement.removeChild(t),this.sendDcsEvent()}sendDcsEvent(){const t=m.default.getSpotsResults(d.EventType.DCS_SCRIPT);c.default.get().sendDcs(d.EventType.DCS_SCRIPT,t.dynamicResults.spotsFound,t.dynamicResults.maxItems,t.fixedResults.spotsFound,t.fixedResults.maxItems)}createSpotFromSerialized(t){return p.default.get().createSpot(t,t.selector)}}},6767:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6879),n=e(5540),r=e(7016),o=e(2643),h=e(1675);class a extends s.default{constructor(t,i,e){super(t,i,{childList:!0,attributes:!0,subtree:!0},e),this.articles=[],this.logger.info(`Endless Initialized for pv ${this.profile.pageViewID}`),this.listenElement=i instanceof HTMLElement?i:document.body,this.contentConfiguration=this.profile.dcs?this.profile.dcs:null,this.triggerMinimalPercentage=this.profile.dcs.viewportPercentage/100,this.checkUrlChanges=this.profile.dcs.checkUrlChanges,this.currentURL=window.location&&window.location.href,this.newContentFound=!1,this.contentConfiguration&&this.contentConfiguration.articlesSelector?this.articles=Array.from(document.querySelectorAll(this.contentConfiguration.articlesSelector)):this.articles=[]}mutationsHandler(t){setTimeout((()=>{const i=window.location&&window.location.href;this.profile.dcs.reInjectOnUrl&&i!==this.currentURL?this.reInject():t.forEach((t=>{this.handleIfEndless(t)}))}),1e3)}reInject(){if(this.observer){this.removeObserver(),delete this.observer;new o.default("endlessScroll",!1).trigger()}}handleIfEndless(t){if(t.addedNodes.length>0){const i=Array.from(t.addedNodes).filter((t=>t instanceof HTMLElement&&n.default.$t(t,!0)&&null!==t.offsetParent)),e=this.getNewArticleIfTriggerd(i);e.length&&e.forEach((t=>{this.logger.info("watching article's distance",t),this.watch(t)}))}}watch(t){setTimeout((()=>{this.observer&&this.isWindowCloseToArticle(t)&&this.hasUrlChanged()?(this.incrementActionCounter(),this.windowObject[this.actionCounter]={element:t,pvId:null,saE:h.default.getSaObjects(t)},this.windowObject.dcsType=this.getDcsType(),this.sendDcsEvent(r.EventType.DCS_ENDLESS),this.profile.debug&&(this.windowObject._endlessEvent={event_type:"dcs_endlessScroll"},this.logger.info(`dcs new content at position ${n.default.Z(t).y}`,t)),this.newContentFound=!0,this.removeObserver(),this.runNewMiddy()):this.newContentFound||this.watch(t)}),300)}isWindowCloseToArticle(t){return n.default.gt(t,this.triggerMinimalPercentage)}hasUrlChanged(){const t=window.location&&window.location.href;return!this.checkUrlChanges||!t||this.currentURL!==t}getNewArticleIfTriggerd(t){let i=[];const e=this.contentConfiguration.newContent&&this.contentConfiguration.newContent.className.split(" ");return this.contentConfiguration.articlesSelector?(i=Array.from(document.querySelectorAll(this.contentConfiguration.articlesSelector)),i=i.filter((t=>-1===this.articles.indexOf(t))),i.length&&(this.articles=this.articles.concat(i))):e&&t.some((t=>{const s=Array.from(t.classList).filter((t=>e.some((i=>t.includes(i)))));return(s.length===e.length||t.id.length>0&&t.id===this.contentConfiguration.newContent.id)&&(i.push(t),this.articles.push(t),!0)})),i}}i.default=a},2643:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6879),n=e(5540),r=e(7016);class o extends s.default{constructor(t,i){super(t,null,{},i),this.logger.info("Manual DCS Initalized"),this.windowObject._lastArticle=document.location.href.slice(),this.lastArticle=this.windowObject._lastArticle,this.lastArticle||(this.windowObject._lastArticle=document.location.href.slice());const e=n.default.getBrowsiTag();if(e){const t=this.profile.dcs.delay;e.triggerNewArticle=t?i=>{setTimeout(this.trigger.bind(this,i),t)}:this.trigger.bind(this)}}mutationsHandler(t){}trigger(t){this.removeSpotsFromDOM(),this.windowObject._lastArticle=document.location.href.slice(),this.lastArticle=this.windowObject._lastArticle,this.incrementActionCounter(),this.sendDcsEvent(r.EventType.DCS_MANUAL);const i=n.default.getBrowsiTag();i&&delete i.triggerNewArticle,this.runNewMiddy(t)}}i.default=o},4410:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6879),n=e(2478),r=e(5540),o=e(7016),h=e(7654),a=e(9008),l=e(3486),c=e(549);class d extends s.default{constructor(t,i,e){super(t,i,{childList:!0,attributes:!0,subtree:!0},e),this.logger.info("Read More Initialized"),!this.profile.analysisMode&&c.SpotsUtils.getConf({typeTag:"st",positionTag:"s"})&&a.default.get().buildStickySpot(),this.clickDetector()}mutationsHandler(t){}clickDetector(){if(this.mutationElement){const t=this.mutationElement.children?[this.mutationElement,...Array.from(this.mutationElement.children)]:[this.mutationElement];let i=!1;r.default.$t(this.mutationElement,!0)?t.length&&(this.shouldScanAbove()?this.handleSpotEngineRun(!0,!0,!0):n.default.sendPageViewReport([],this.profile,!0,!0),t.forEach((t=>{t.addEventListener("click",(e=>{if(!i){const s=this.getReadMoreButtonLocation(t),n=e.screenY||s,o=r.default.Zt(),h=Math.max(n,o);setTimeout((t=>this.clickHandler(h)),1e3,n),i=!0}})),this.logger.info("waiting for click on ",t)}))):(this.logger.info("invisible button",this.mutationElement),this.handleSpotEngineRun(!1,!0,!0))}}handleSpotEngineRun(t,i,e,s,n){return new Promise(((r,o)=>{t&&(this.spotEngine.setExternalScanConfig(this.getExternalScanConfig(this.shouldScanAbove(),n)),this.incrementActionCounter()),this.runSpotEngine(i,e,s).then((()=>(h.default.restart(),r())))}))}clickHandler(t){if(this.shouldScanAbove()){this.spotEngine.setExternalScanConfig(this.getExternalScanConfig(!1,t));const i=this.spotEngine.runSecondTimeForBelowReadMore(),e=this.getMaxItemsForDcsEvent(i.firstRunSpots,{typeTag:"dy",positionTag:"in"}),s=c.FIXED_TAGS.map((t=>this.getMaxItemsForDcsEvent(i.firstRunSpots,t))).reduce(((t,i)=>t+i));this.sendDcsEvent(o.EventType.DCS_READMORE,i.secRunSpots,e,s)}else this.handleSpotEngineRun(!0,!1,!0,void 0,t).then((()=>{this.sendDcsEvent(o.EventType.DCS_READMORE)}))}getMaxItemsForDcsEvent(t,i){const e=l.default.getMaxItems(i),s=t.filter((t=>t.tags.typeTag===i.typeTag&&t.tags.positionTag===i.positionTag));return Math.max(e-s.length,0)}shouldScanAbove(){return this.profile.dcs.scanAboveReadMore}getExternalScanConfig(t,i){const e=i||this.getReadMoreButtonLocation();return{forceStartPosition:t?void 0:e,forceEndPosition:t?e:void 0,disablePageStructure:t}}getReadMoreButtonLocation(t){return r.default.Z(t||this.mutationElement).y}}i.default=d},514:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6879),n=e(5540),r=e(7016),o=e(5662),h=e(7654),a=e(8562),l=e(470),c=e(6537),d=e(9008),u=e(4465),f=e(6792),v=e(1675);class p extends s.default{constructor(t,i,e){if(super(t,i,{childList:!0,attributes:!0,subtree:!0},e),this.logger.info(`Slides Initialized for pv ${this.profile.pageViewID}`),this.mutationElement=i,this.slides=[],n.default.Ni(this.profile.dcs.mutationXpaths).forEach((t=>{this.slides.push({element:t,spots:[]})})),this.triggerMinimalPercentage=this.profile.dcs.viewportPercentage/100,this.slideEliminationPercentage=this.triggerMinimalPercentage+.1,this.checkUrlChanges=this.profile.dcs.checkUrlChanges,this.currentURL=window.location&&window.location.href,this.scrollDirection=c.ScrollDirection.DOWN,this.lastPosition=n.default.Zt(),o.default.get().listen("scroll",n.default.S(),(()=>{let t=n.default.Zt();this.scrollDirection=this.lastPosition<=t?c.ScrollDirection.DOWN:c.ScrollDirection.UP,this.lastPosition=t})),this.assignScrollListeners(),v.default.isSlidesTriggered()){const t=this.getCurrentSlide(),i=this.getPreviousSlides().includes(t)?[]:Array.from(t.querySelectorAll(u.CustomTagType.BROWSI_SPOT));this.spotEngine=d.default.get(f.SpotEngineType.BROWSI_SPOTS),this.spotEngine.setTargetElements(i),this.runSpotEngine(!0,!0)}else this.spotEngine=d.default.get(f.SpotEngineType.SLIDES_ALL),this.spotEngine.setTargetElements([]),this.runSpotEngine(!0,!0,this.slides)}mutationsHandler(t){}assignScrollListeners(){this.slides&&this.slides.length>0&&this.getAllSlidesElements().forEach((t=>{o.default.get().listen("scroll",n.default.S(),this.generateScrollListener(t))}))}isWindowCloseToSlide(t){return n.default.wt(t,this.triggerMinimalPercentage)}isInDirectionOfSlide(t){return this.scrollDirection===c.ScrollDirection.UP&&n.default.isPositionedBefore(t,this.getCurrentSlide())||this.scrollDirection===c.ScrollDirection.DOWN&&n.default.isPositionedBefore(this.getCurrentSlide(),t)}generateScrollListener(t){return n.default.Ui((()=>{this.isInDirectionOfSlide(t)&&this.getCurrentSlide()!==t&&this.isWindowCloseToSlide(t)&&this.hasUrlChanged()&&(this.incrementActionCounter(),this.windowObject[this.actionCounter]={element:t,pvId:null,saE:l.default.get().getStayAwayElements().filter((i=>n.default.isPositionedBefore(t,i.element)))},this.windowObject.dcsType=this.getDcsType(),this.sendDcsEvent(r.EventType.DCS_SLIDES),this.profile.debug&&this.logger.info("dcs entering slide ",t),this.keepStickyReference(),this.runNewMiddy())}),100)}runNewMiddy(){h.default.setInactive(),this.spotEngine.lazyDetector&&this.spotEngine.lazyDetector.removeObserver(),this.clearExternalServices(),a.default.instance.unsubscribe(),window.browsi_bootstrap_loaded=!1,window._middyo=null,this.logger.info("injecting bootstrap");const t=n.default.Ht();t&&t.parentElement&&t.parentElement.removeChild(t)}getAllSlidesElements(){return this.slides.map((t=>t.element))}hasUrlChanged(){const t=window.location&&window.location.href;return!this.checkUrlChanges||!t||this.currentURL!==t}getCurrentSlide(){return v.default.isSlides()?this.windowObject[this.getActionCounter()].element:this.slides[0].element}getPreviousSlides(){let t=new Set;for(let i=0;i<this.getActionCounter();i++)t.add(this.windowObject[i].element);return Array.from(t)}}i.default=p},9696:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6879),n=e(7016);class r extends s.default{constructor(t,i,e){super(t,i,{childList:!0,attributes:!0,subtree:!0},e),this.logger.info("Spa Initalized"),this.listenElement=i instanceof HTMLElement?i:document.body,this.windowObject._lastArticle=document.location.href.slice(),this.lastArticle=this.windowObject._lastArticle,this.lastArticle||(this.windowObject._lastArticle=document.location.href.slice())}mutationsHandler(t){t.forEach((t=>{this.handleIfSpa(t)}))}handleIfSpa(t){t.addedNodes.length>0&&t.target instanceof Element&&this.lastArticle!==document.location.href&&(this.removeSpotsFromDOM(),this.windowObject._lastArticle=document.location.href.slice(),this.lastArticle=this.windowObject._lastArticle,this.incrementActionCounter(),this.sendDcsEvent(n.EventType.DCS_SPA),this.removeObserver(),this.runNewMiddy())}}i.default=r},1675:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(6389),r=e(4141),o=e(470);class h{static get windowObj(){return this.initiated||(this._windowObj=window[h.windowVarName]?Object.assign({},window.__dcs):null,this.initiated=!0),this._windowObj}static getWindowObject(){return this._windowObj}static isEndless(){return this.checkType(["endlessScroll"])}static isSlides(){return this.checkType(["slides"])}static isSpa(){return!!this.getSpaLastArticle()}static isManualDcs(){const t=n.Profiler.get();return t.dcs&&t.dcs.enable&&"manual"==t.dcs.type}static checkType(t){var i;const e=this.getDcsActionCounter();return!(!t.includes("script")||!n.Profiler.get().dcsState)||!!(null===(i=this.windowObj)||void 0===i?void 0:i[e])&&this.windowObj[e].element instanceof Element&&t.includes(this.windowObj.dcsType)}static getCurrentDcsElement(){var t;const i=null===(t=n.Profiler.get().dcsState)||void 0===t?void 0:t.mainContentElement;if(i)return i;{const t=this.getDcsActionCounter();return this.windowObj&&this.windowObj[t]?this.windowObj[t].element:null}}static setCurrentEndlessPvid(t){const i=this.getDcsActionCounter();window[this.windowVarName][i]?Object.assign(window[this.windowVarName][i],{pvId:t}):window[this.windowVarName][i]={element:document.body,pvId:t}}static getEndlessElementByPvId(t){if(this.windowObj&&this.getDcsActionCounter())for(let i=0;i<=this.windowObj.count;i++)if(this.windowObj[i].pvId===t)return this.windowObj[i].element;return document.body}static getArticlesList(t){var i;const e=this.isEndless()&&t.articlesSelector?[t.articlesSelector]:[],r=(null===(i=n.Profiler.get().dcsState)||void 0===i?void 0:i.articleSelectors)||[],o=e||r;return o.length?Array.from(document.querySelectorAll(o.join(","))):this.isSlides()?s.default.Ni(t.mutationXpaths):[]}static isBetweenArticles(t,i){const e=this.getArticlesList(i);if(!e.length)return!1;const n=this.getCurrentDcsElement();if(n instanceof Element&&e){const i=e.indexOf(n),r=e[i+1];if(r instanceof HTMLElement){const i=s.default.Z(t).y,e=s.default.Z(n).y,o=s.default.Z(r).y;return e<i&&i<o}}return!1}static getSpaLastArticle(){var t;return null===(t=this.windowObj)||void 0===t?void 0:t._lastArticle}static isDcsPageview(){return!!n.Profiler.get().dcsState||!!(this.windowObj&&this.windowObj.count>0)}static getDcsActionCounter(){var t;const i=(null===(t=n.Profiler.get().dcsState)||void 0===t?void 0:t.count)||(this.windowObj?this.windowObj.count:null);return i&&i>0?i:0}static getDcsParentPageViewID(){var t,i,e;return(null===(i=null===(t=this.windowObj)||void 0===t?void 0:t[0])||void 0===i?void 0:i.pvId)||(null===(e=n.Profiler.get().dcsState)||void 0===e?void 0:e.parentPageView)||n.Profiler.get().pageViewID}static getLatestDcsStayObjects(){var t;const i=null===(t=n.Profiler.get().dcsState)||void 0===t?void 0:t.stayAwayObjects;if(null==i?void 0:i.length)return i;{const t=this.getDcsActionCounter();return this.windowObj&&this.windowObj[t]&&this.windowObj[t].saE}}static isInCurrentArticle(t){const i=this.getCurrentDcsElement();return!(i&&i instanceof Element)||s.default.isPositionContained(i,t)}static isSlidesTriggered(){return!!(this.windowObj&&"slides"===this.windowObj.dcsType&&this.windowObj.count>0)}static shouldRetrieveDcs(){const t=n.Profiler.get();return!!(t.dcs&&t.dcs.enable&&t.dcs.mutationXpaths)}static getFirstElementFromArray(t){return t.find((t=>s.default.B(t)))||null}static retrieveMutationElementIfExists(t,i){return new Promise((function(e,r){let o=null;const a=n.Profiler.get();if(a.dcs.delay&&a.dcs.delay>0){i.info(`waiting ${a.dcs.delay} ms for dcs element`);let n=setInterval((function(){o=h.getFirstElementFromArray(s.default.Ni(t)),o&&(clearInterval(n),i.info("found dcs element"),e(o))}),100);setTimeout((function(){o||(i.info("no dcs element found"),r(new Error(h.dcsFailureMessage)))}),a.dcs.delay||0)}else o=h.getFirstElementFromArray(s.default.Ni(t)),o?e(o):r(new Error(h.dcsFailureMessage))}))}static removeStickyVar(t){try{this.windowVarName[r.StickyConstants.dcsVar]&&(this.windowVarName[r.StickyConstants.dcsVar]=null)}catch(i){t.info("failed to remove sticky ad")}}static hasDcsMc(){var t;return!(!h.isEndless()&&!(null===(t=n.Profiler.get().dcsState)||void 0===t?void 0:t.mainContentElement))}static getSaObjects(t){return o.default.get().getStayAwayElements().filter((i=>s.default.isPositionedBefore(t,i.element)))}}i.default=h,h.initiated=!1,h.dcsFailureMessage="DCSError",h.windowVarName="__dcs"},132:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(6879),r=e(7016),o=e(5662);class h extends n.default{constructor(t,i,e){super(t,i,{childList:!0,attributes:!0,subtree:!0},e),this.logger.info("Galleries Initalized"),this.mutationElement=i,this.logger.info(this.profile),this.listenElements=s.default.Ni(this.profile.dcs.mutationXpaths),this.assignClickListeners()}mutationsHandler(t){}assignClickListeners(){this.listenElements&&this.listenElements.length>0&&this.listenElements.forEach((t=>{this.assignClickListenersForElement(t)}))}assignClickListenersForElement(t){const i=t.children?[t,...Array.from(t.children)]:[t];let e=!1;s.default.$t(t,!0)?i.length&&i.forEach((t=>{o.default.get().listen("click",t,(()=>{e||(this.logger.info("clicked"),this.sendDcsEvent(r.EventType.DCS_GALLERY),o.default.get().removeAll(),setTimeout((()=>this.clickHandler()),1e3),e=!0)})),this.logger.info("waiting for click on ",t)})):this.logger.info("button not found",t)}clickHandler(){this.incrementActionCounter(),this.removeSpotsFromDOM(),this.runNewMiddy()}}i.default=h},7966:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(2661),r=e(5690),o=e(7899),h=e(549),a=e(5812),l=e(83),c=e(6389),d=e(4436),u=e(4524),f=e(470),v={"in-content":"in",top:"t",bottom:"b",adhesive:"s"};class p{constructor(){this.relocationDelayReached=!1,this.spots=[],this.logger=new n.default("BrowsiDemandTool"),this.waitForRelocationDecision=new Promise((t=>this.relocatePromise=t)),this.relocateSpots=[],this.relocationSelectors=(c.Profiler.get().apiRelocationSelectors||[]).join(","),this.relocationActive=!!this.relocationSelectors;const t=s.default.getBrowsiTag();if(t){if(t.display=this.display.bind(this),t.cmd)for(;t.cmd.length;){const i=t.cmd.shift();"function"==typeof i&&this.execute(i)}else t.cmd=[];t.cmd.push=t=>this.execute(t)}}proceedRelocation(t){return new Promise((i=>{this.relocatePromise(t),i()}))}static get(){return p.instance||(this.instance=new p),p.instance}execute(t){try{t()}catch(t){this.reportFailure(t,"")}}display(t,i){this.runApiDisplayHook(t,i),this.logger.info(`display('${t})'`,i),this.buildSpot(t,i).then((t=>this.waitForRelocation(t))).then((t=>{t.shouldProceed&&(this.addPlacementToSA(t.spot),r.YieldClient.get().ns([t.spot],o.DemandRequestType.SINGLE))})).catch((i=>this.reportFailure(i,t)))}buildSpot(t,i){return t&&"string"==typeof t||(null==i?void 0:i.shadowElement)&&s.default.B(i.shadowElement)?this.buildOptionsPromise(t,i).then((i=>this.validateElement(t,i.shadowElement).then((t=>this.validateSpot(t,i))))):Promise.reject(`container ID is null or not a string - ${t}`)}buildOptionsPromise(t,i){return i?Promise.all([this.validateSizeArray(i.sizes),this.validateRefresh(i.refresh),this.validateKeyValuesArray(i.keyValues),this.validateAdUnit(i.adUnit),this.validateViewability(i.disableViewabilityOptimization),this.validatePosition(t,i.positionTag)]).then((t=>{const e={sizes:t[0],refresh:t[1],keyValues:t[2],adUnit:t[3],disableViewabilityOptimization:t[4],positionTag:t[5],shadowElement:null==i?void 0:i.shadowElement};return Object.keys(e).forEach((t=>{void 0===e[t]&&delete e[t]})),e})):Promise.resolve({})}validateSpot(t,i){return new Promise(((e,s)=>{if(this.noSizesDefinedForSpot(i))return s(`No sizes defined for this spot - ${t.id}`);this.logger.info("Processed element and options:",t,i);const n=this.spots.length,r=new a.ApiSpot(t,n,i);this.spots.push(r),r.relocationStatus=this.getRelocationStatus(r),l.default.reportSpot(r),this.attachParamsToRef(t,i),e(r)}))}noSizesDefinedForSpot(t){return(!t.sizes||0===t.sizes.length)&&0===h.SpotsUtils.getSizes({typeTag:"api",positionTag:t.positionTag||"in"}).length}validateElement(t,i){return new Promise(((e,n)=>{if(i&&s.default.B(i))return e(i);const r=document.getElementById(t);return r?e(r):n(`no element with such id exists - ${t}`)}))}validateSizeArray(t){return new Promise(((i,e)=>{t||i(),Array.isArray(t)||e("sizes is not a valid sizes array. Please supply an array of objects: {w: adWidth, h: adHeight}"),(t=this.validateSizes(t)).length||i(),i(t)}))}validateRefresh(t){return new Promise(((i,e)=>{void 0===t&&i(),"boolean"==typeof t?i({active:!!t}):"object"==typeof t&&"boolean"==typeof t.active?(void 0!==t.refreshSecond&&("number"!=typeof t.refreshSecond||t.refreshSecond<=0)&&e("refresh.refresh.refreshSecond should be positive number"),i(Object.assign({active:!!t.active},t.refreshSecond?{refreshSecond:t.refreshSecond}:{}))):e("refresh is not a valid object. Please supply an object: {active: true/false}")}))}validateKeyValuesArray(t){return new Promise(((i,e)=>{t||i(),t&&this.isInvalidKeyValuesArray(t)&&e("keyValues is not a valid key-value array. Please supply an array of objects: {key: key, value: value}"),t=this.removeUnsupportedKeyValues(t),this.processKeyValuesArray(t),i(t)}))}processKeyValuesArray(t){const i=t=>"string"!=typeof t?t.toString():t;t.forEach((t=>{Array.isArray(t.value)?t.value.forEach(((e,s)=>{t.value[s]=i(e)})):t.value=i(t.value)}))}validateAdUnit(t){return new Promise(((i,e)=>{t||i(),t&&this.isInvalidAdUnit(t)&&e('adUnit is not in the valid format. Please make sure to send a string in the format: "/pubId/adUnit"'),s.default.startsWith("/",t)||(t="/"+t),i(t)}))}validateViewability(t){return new Promise(((i,e)=>{if(t&&"boolean"!=typeof t)return e("optimizeViewability is not in the valid format. Please make sure to send a boolean value (true/false)");i(!!t)}))}validatePosition(t,i){return new Promise(((e,s)=>{if(!i){const i=c.Profiler.get().spotsSupplyParams.api||{};return Object.keys(i).forEach((s=>{var n;const r=null===(n=i[s])||void 0===n?void 0:n.positionIds;if(this.matchRegexOrString(t,r))return e(s)})),e("in")}return e(v[i])}))}matchRegexOrString(t,i){return!!(null==i?void 0:i.some((i=>new RegExp("^/.*/$").test(i)?(i=i.substring(1,i.length-1),new RegExp(i).test(t)):t===i)))}isInvalidSizeArray(t){return!Array.isArray(t)||0===t.length||t.some((t=>isNaN(t.w)||isNaN(t.h)))}validateSizes(t){t=t.map((t=>"string"==typeof t&&"fluid"===t.toLowerCase()?{h:0,w:0}:{h:Number(t.h),w:Number(t.w)}));return t.filter((t=>!(t=>(isNaN(t.w)||isNaN(t.h))&&!("string"==typeof t&&"fluid"!==t.toLowerCase()))(t)))}isInvalidKeyValuesArray(t){return!Array.isArray(t)||0===t.length}removeUnsupportedKeyValues(t){const i=t=>"string"!=typeof t.key||!this.isSupportedKeyValType(t.value)&&(!Array.isArray(t.value)||t.value.some((t=>!this.isSupportedKeyValType(t))));return t.filter((t=>!i(t)))}isSupportedKeyValType(t){return["string","number","boolean"].includes(typeof t)}isInvalidAdUnit(t){return"string"!=typeof t||1===t.split("/").length}reportFailure(t,i){this.logger.error("browsitag execution failed:",t),i="string"==typeof i?i:"",d.default.get().sendApiRequestBlockedEvent("api_failed",t,i)}attachParamsToRef(t,i){s.default.isBrowsiLoggerActive()&&(t.spotOptions=i)}runApiDisplayHook(t,i){const e=u.default.getExternalFlowHandler("apiDisplay");e&&e(t,i)}holdEngineForRelocation(){return new Promise(((t,i)=>{if(!this.relocationActive)return t();const e=u.default.getExternalFlowHandler("apiRelocationDelay");e?e(t,i):setTimeout((()=>t()),300)})).then((()=>{this.relocationDelayReached=!0,this.relocateSpots=this.relocateSpots.sort((function(t,i){return 2&t.ref.compareDocumentPosition(i.ref)?1:-1}))}))}addPlacementToSA(t){var i,e,s;if("s"===(null===(i=t.options)||void 0===i?void 0:i.positionTag))return;const n=null===(e=c.Profiler.get().spotsSupplyParams.dynamic)||void 0===e?void 0:e.distance;if(!n)return void(((null===(s=c.Profiler.get().spotsSupplyParams.dynamic)||void 0===s?void 0:s.maxItems)||this.relocationActive)&&this.logger.error("no SA distance configured for inline spots, cant add API spot to SA"));const r={distance:n,toDensity:!1};f.default.get().upsertStayAwayElement(t.ref,r,!1,"API")}waitForRelocation(t){return new Promise((i=>{this.shouldRelocate(t)?(this.relocateSpots.push(t),this.waitForRelocationDecision.then((e=>{if(!e){const i=this.relocateSpots.findIndex((i=>i.spotIndex===t.spotIndex));i>-1&&this.relocateSpots.splice(i,1)}i({shouldProceed:!e,spot:t})}))):i({shouldProceed:!0,spot:t})}))}shouldRelocate(t){return 1===t.relocationStatus}getRelocationStatus(t){if(this.relocationActive)return t.ref.matches(this.relocationSelectors)?this.relocationDelayReached?-2:1:0}}i.DemandTool=p},4436:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(9081),n=e(2661),r=e(7016),o=e(5540),h=e(6448),a=e(5353),l=e(1675),c=e(4524),d=e(1031),u=e(8867),f=e(8562),v=e(5780),p=e(6389);class m{constructor(t){this.eventsQue={},this.profile=t,this.staticFields=this.buildStaticFields(),this.supplyStaticFields=this.buildSupplyStaticFields(),this.demandStaticFields=this.buildDemandStaticFields(),this.inframeStaticFields=this.buildInframeStaticFields(),this.eventServerUrl=t.esReportDomain,this.logger=new n.default("Events"),this.dcsCounter=0,this.sendEventsThrottle=o.default.Ui(this.flushEventsQue.bind(this),this.profile.bulkEventsThrottle||0,!1),this.isValidEventServerUrl=this.isValidURL(this.eventServerUrl),this.isValidEventServerUrl||this.logger.error("Invalid event server URL")}static get(){return m._instance||(this._instance=new m(window._middyo)),m._instance}static getFiredEvents(){return m.firedEvents}static addToFiredEvents(t,i){this.firedEvents[t]&&Array.isArray(this.firedEvents[t])||(this.firedEvents[t]=[]),this.firedEvents[t].push(...i)}sendEngineLoadedEvent(){const t=this.getEngineLoadedEvent();this.addToEventsQue(s.EventTopic.SUPPLY,r.EventType.ENGINE_LOADED,[t]),this.initBeaconFlushQue()}sendPageviewEvent(t,i,e,n){this.profile.analysisMode||"pageview"===p.Profiler.get().billableEvents&&o.default.dispatchDOMEvent("browsi_pageview",{},window);const h=this.getPageViewEvent(t,i,e);n&&(h.ppvid=this.staticFields.pvid,h.pvid=n),this.addToEventsQue(s.EventTopic.SUPPLY,r.EventType.PAGE_VIEW,[h])}sendSpotFoundEvent(t){let i=this.getSpotFoundEvent(t);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.SPOT_FOUND,[i])}sendBidRequests(t,i){let e=this.getBidRequestEvent(t,i);this.addToEventsQue(s.EventTopic.HEADER_BIDDING,r.EventType.BID_REQUEST,[e])}sendBidMatch(t,i){let e=this.getBidMatchedEvent(t,i);this.addToEventsQue(s.EventTopic.HEADER_BIDDING,r.EventType.BID_MATCHED,[e])}Oe(t,i,e,n,o,h){const a=this.getAdRequest(t,i,e,n,o,h);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_REQUEST,[a])}ys(t,i){const e=this.getInframeAdRequest(t,i);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_REQUEST,[e])}Ie(t,i,e,n,o,h,a,l){const c=this.getAdMatchedEvent(t,e,i,n,o,h,a,l);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_MATCHED,[c])}Os(t,i,e){const n=this.ks(i,t,e);this.addToEventsQue(s.EventTopic.INFRAME,r.EventType.INFRAME_HAS_DEMAND,[n])}Ss(t,i,e,n){const o=this.getInframeAdMatchedEvent(t,i,e,n);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_MATCHED,[o])}ae(t,i,e,n,o){const h=this.getAdImpressionEvent(t,i,e,n,o);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_IMPRESSION,[h])}_s(t,i,e){const n=this.Rs(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_IMPRESSION,[n])}sendAdMeasurableEvent(t,i,e,n){const o=this.getAdMeasurableEvent(t,i,e,n);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.MEASURABLE_IMPRESSION,[o])}xs(t,i,e){const n=this.getViewedImpressionEvent(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.VIEWED_IMPRESSION,[n])}Cs(t,i,e){const n=this.Ds(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.VIEWED_IMPRESSION,[n])}sendViewedImpressionAV(t,i){const e=this.getViewedImpressionEventAV(t,i);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.VIEWED_IMPRESSION_AV,[e])}sendFoundPublisherAd(t,i,e){const n=this.getFoundPublisherAd(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.FOUND_PUBLISHER_AD,[n])}sendDcs(t,i,e,n,r){const o=this.getDcsEvent(t,i,e,n,r);this.addToEventsQue(s.EventTopic.SUPPLY,t,[o])}$s(t,i,e){const n=this.Fs(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.VIEWED_PUBLISHER_AD,[n])}sendViewedPublisherAdAV(t){const i=this.getViewedPublisherAdAv(t);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.VIEWED_PUBLISHER_AD_AV,[i])}sendPubAdRefreshRequest(t,i,e,n){const o=this.getPubAdRefreshEvent(t,i,e,n);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.PUB_AD_REFRESH_REQUEST,[o])}sendPageStructureEvent(t,i){const e=this.getPageStructureEvent(t,i);this.addToEventsQue(s.EventTopic.PAGE_STRUCTURE,r.EventType.PAGE_STRUCTURE,[e])}sendAdInViewport(t,i){const e=this.getAdInViewportEvent(t,i);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_IN_VIEWPORT,[e])}sendAnalyticsEvent(t){let i=Object.assign(Object.assign({et:r.EventType.USER_STATS,to:c.default.getTimeOffset(),c:t.c,bi:t.bi,bv:t.bv,pi:t.pi,pv:t.pv,b_ativ:t.tiv.b_ativ,aul:t.aul.a,uva:t.uv.t_a,uvsp:t.uv.t_sp,oofu:t.aof.t_a},t.nam?{nam:t.nam}:{}),t.ahb?{ahb:t.ahb}:{});this.addToEventsQue(s.EventTopic.ANALYTIC,r.EventType.USER_STATS,[i])}sendWebVitalsEvent(t){const{sk:i,pk:e,dp:n}=this.staticFields,{pv:o,fid:h,lcp:a,cls:l}=t;let c=Object.assign(Object.assign(Object.assign({},h?{fid:h}:{}),a?{lcp:a}:{}),l?{cls:l}:{}),d={sk:i,pk:e,dp:n,pvid:o};const u=Object.assign({events:[c]},d);this.sendBeacon(s.EventTopic.WEB_VITALS,[u],!1,r.EventType.WEB_VITALS)||this.addToEventsQue(s.EventTopic.WEB_VITALS,r.EventType.WEB_VITALS,[u])}sendGeneralDataEvent(t,i){let e=Object.assign(Object.assign(Object.assign({},this.staticFields),this.supplyStaticFields),{events:[{now:o.default.vi(),et:r.EventType.GENERAL_DATA,to:c.default.getTimeOffset(),gd:t}]});i&&i.forEach((t=>{delete e[t]}));this.sendBeacon(s.EventTopic.ANALYTIC,[e],!1,r.EventType.GENERAL_DATA)||this.addToEventsQue(s.EventTopic.ANALYTIC,r.EventType.GENERAL_DATA,[e])}sendSummaryEvent(){const t=d.Engagement.get().getData();let i={et:r.EventType.SUMMARY,to:c.default.getTimeOffset(),ads:u.default.get().currentVisitImpressions,dep:t.max_depth_percentage,sl:t.screen_length,plt:t.page_load_time,top:t.time_on_page,v:t.velocity_including_static_time,vest:t.velocity_excluding_static_time,pl:o.default.q(),dt:v.default.instance.getTotalAdDensity(),denp:v.default.instance.getPublisherAdDensity()},e={sid:this.profile.sessionID,scid:this.profile.supplyConfigId,sk:this.staticFields.sk,pk:this.staticFields.pk,pvid:this.staticFields.pvid,dp:this.staticFields.dp,geo:this.staticFields.geo,ts:this.staticFields.ts,db:this.staticFields.db,dos:this.staticFields.dos,d:this.staticFields.d,mv:this.staticFields.mv,bpvid:this.staticFields.bpvid,url:this.staticFields.url};const n=Object.assign({events:[i]},e);this.sendBeacon(s.EventTopic.ENGAGEMENT,[n],!1,r.EventType.SUMMARY)||this.addToEventsQue(s.EventTopic.ENGAGEMENT,r.EventType.SUMMARY,[n])}getPageStructureEvent(t,i){return Object.assign({to:c.default.getTimeOffset(),et:r.EventType.PAGE_STRUCTURE,sse:t.skipped_sa_elements,pl:o.default.q(),ph:i,ba:t.browsi_ads,pa:t.publisher_ads,msc:h.default.instance.calculateMCSize(!0),msct:h.default.instance.getMCStart(),par:t.paragraphs,sow:t.social_widgets,pi:t.images,vd:t.videos,cs:t.comment_section,cr:t.content_recommendation},t.page_meta_data?{pmd:t.page_meta_data}:{})}sendFocusChangedEvent(t,i){const e=this.getFocusChangeEvent(t,i);this.addToEventsQue(s.EventTopic.SUPPLY,r.EventType.FOCUS_CHANGED,[e])}sendAdRequestBlockedEvent(t,i,e){const n=this.getAdBlockEvent(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_REQUEST_BLOCKED,[n])}sendApiRequestBlockedEvent(t,i,e){const n=this.getApiBlockEvent(t,i,e);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.AD_REQUEST_BLOCKED,[n])}sendPubAdRefreshBlockedEvent(t,i){const e=this.getRefreshBlockEvent(t,i);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.PUB_AD_REFRESH_BLOCK,[e])}sendStickyClosedEvent(t){const i=this.getStickClosedEvent(t);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.STICKY_CLOSED,[i])}sendHBWinner(t,i){const e=this.getHBWinnerEvent(t,i.bidder,i.cpm);this.addToEventsQue(s.EventTopic.HEADER_BIDDING,r.EventType.HBWinner,[e])}sendAPSWinner(t){const i=this.getHBWinnerEvent(t,"aps",-1);this.addToEventsQue(s.EventTopic.HEADER_BIDDING,r.EventType.HBWinner,[i])}sendPublisherAdBids(t){const i=t.map((t=>this.getPubAdsBid(t)));this.addToEventsQue(s.EventTopic.PREBID,r.EventType.FOUND_PUBLISHER_AD_BIDS,i)}sendErrorEvent(t,i,e,s){const n=this.getErrorEvent(t,e,i,s);this.sendError(t,n)}sendPlaceholderViewed(t){const i=this.getPlaceholderEvent(t,r.EventType.PLACEHOLDER_VIEWED);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.PLACEHOLDER_VIEWED,[i])}sendPlaceholderClosed(t,i){const e=this.getPlaceholderEvent(t,r.EventType.PLACEHOLDER_CLOSED,i);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.PLACEHOLDER_CLOSED,[e])}sendBillableEvent(t){const i=this.getBillableEvent(t);this.addToEventsQue(s.EventTopic.DEMAND,r.EventType.BILLABLE_EVENT,[i])}sendError(t,i){this.profile.debug?this.logger.error(i):this.addToEventsQue(s.EventTopic.ERROR,t,[i])}addToEventsQue(t,i,e,s){this.isValidEventServerUrl&&(this.shouldThrottleEvent(t)?(this.eventsQue[t]=this.eventsQue[t]||[],this.eventsQue[t].push(...e),this.sendEventsThrottle()):this.send(t,this.getBulkEventByTopic(t,e)),m.addToFiredEvents(t,e),this.logger.style(`%c${this.logger.name} (${i}, ${t})${s?`[${s}]`:""}:`,"background: #2ecc40; color:#0E3E14; font-size:18px; font-weight:bold; text-decoration:underline;",1===e.length?e[0]:e))}shouldThrottleEvent(t){return!!this.profile.bulkEventsThrottle&&![s.EventTopic.ERROR,s.EventTopic.SUPPLY].includes(t)}flushEventsQue(t=!1){for(let i in this.eventsQue)if(this.eventsQue.hasOwnProperty(i)&&this.eventsQue[i].length){let e=!0;t?e=this.sendBeacon(i,this.getBulkEventByTopic(i,this.eventsQue[i]),!0):this.send(i,this.getBulkEventByTopic(i,this.eventsQue[i])),e&&(this.eventsQue[i]=[])}}getBulkEventByTopic(t,i){const e={events:i};if(t===s.EventTopic.HEADER_BIDDING)return i.map((t=>Object.assign(Object.assign(Object.assign({},t),this.staticFields),this.demandStaticFields)));if(t===s.EventTopic.INFRAME)return[Object.assign(Object.assign({},e),this.inframeStaticFields)];if(t===s.EventTopic.DEMAND)return[Object.assign(Object.assign(Object.assign({},e),this.staticFields),this.demandStaticFields)];if(t===s.EventTopic.SUPPLY||t===s.EventTopic.PAGE_STRUCTURE||t===s.EventTopic.ANALYTIC){const n=Object.assign(Object.assign(Object.assign({},e),this.staticFields),this.supplyStaticFields);return t===s.EventTopic.SUPPLY&&i[0].pvid&&(n.pvid=i[0].pvid,delete i[0].pvid),[n]}return t===s.EventTopic.REFRESH?[Object.assign(e,{pk:this.staticFields.pk})]:[e]}send(t,i){const e=new XMLHttpRequest;e.open("POST",`${this.eventServerUrl}v2/${t}?p=${this.staticFields.pvid}`,!0),e.send(JSON.stringify(i))}sendBeacon(t,i,e=!1,s,n){try{if(navigator.sendBeacon(`${this.eventServerUrl}v2/${t}?p=${this.staticFields.pvid}`,JSON.stringify(i)))return e?this.logger.verbose("flush events beacon",i):(m.addToFiredEvents(t,i),this.logger.style(`%c${this.logger.name} (${s}, ${t})${n?`[${n}]`:""}:`,"background: #2ecc40; color:#0E3E14; font-size:18px; font-weight:bold; text-decoration:underline;",1===i.length?i[0]:i)),!0}catch(t){return this.logger.verbose("failed sending events on beacon",i),!1}return!1}initBeaconFlushQue(){f.default.instance.subscribe((t=>{t&&this.flushEventsQue(!0)}))}sendUserEngagedEvent(){const t=this.getUserEngagementEvent();this.addToEventsQue(s.EventTopic.SUPPLY,r.EventType.USER_ENGAGED,[t])}sendCustomRefreshRateEvent(t,i){let e=this.getCustomRefreshRateEvent(t,i);this.addToEventsQue(s.EventTopic.REFRESH,r.EventType.CUSTOM_REFRESH_RATE_RULE,[e])}buildStaticFields(){return{bpvid:this.profile.bootstrapPageViewId,sk:this.profile.siteKey,pk:this.profile.publisherKey,pvid:this.profile.pageViewID,geo:this.profile.countryCode,url:encodeURIComponent(o.default.M()),ts:this.profile.trafficSource,db:this.profile.deviceType&&this.profile.deviceType.browser||"",dbt:this.profile.deviceType&&this.profile.deviceType.browserType||"",d:this.profile.deviceType&&this.profile.deviceType.device?this.profile.deviceType.device:"",dp:this.profile.deviceType&&this.profile.deviceType.devicePlatform||"",dv:this.profile.deviceType&&this.profile.deviceType.vendor||"",dos:this.profile.deviceType&&this.profile.deviceType.os||"",dosv:this.profile.deviceType&&this.profile.deviceType.osVersion||"",mv:this.profile.version,aid:this.profile.articleId}}buildSupplyStaticFields(){return{iru:this.profile.isReturningUser,scid:this.profile.supplyConfigId,res:`${screen.width}x${screen.height}`}}buildDemandStaticFields(){return{mv:this.profile.version,scid:this.profile.supplyConfigId}}buildInframeStaticFields(){var t,i;return{sid:this.profile.sessionID,geo:this.profile.countryCode,db:(null===(t=this.profile.deviceType)||void 0===t?void 0:t.browser)||"",dos:(null===(i=this.profile.deviceType)||void 0===i?void 0:i.os)||"",scid:this.profile.supplyConfigId,pk:this.staticFields.pk,pvid:this.staticFields.pvid,mv:this.staticFields.mv,sk:this.staticFields.sk,dp:this.staticFields.dp,d:this.staticFields.d}}getEngineLoadedEvent(){return Object.assign({now:o.default.vi(),et:r.EventType.ENGINE_LOADED,to:c.default.getTimeOffset()})}getPageViewEvent(t,i,e){return Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.PAGE_VIEW,uid:c.default.getUserID(),sid:this.profile.sessionID,mi:t,fmi:i,pl:o.default.q(),sl:o.default.ht(),to:c.default.getTimeOffset(),mcs:h.default.instance.calculateMCSize(!0),mcst:h.default.instance.getMCStart(),mcc:h.default.instance.getScanStatus()},this.profile.runMode?{mod:this.profile.runMode}:{}),e?{dcst:c.default.getDcsType()}:{}),e&&this.profile.pageViewID!==l.default.getDcsParentPageViewID()?{ac:l.default.getDcsActionCounter()}:{}),this.shouldSendParentPageViewId(e)?{ppvid:l.default.getDcsParentPageViewID()}:{})}getSpotFoundEvent(t){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.SPOT_FOUND,adix:t.spotIndex,pt:t.positionType,to:c.default.getTimeOffset(),dcs:t.isDcs,f:o.default.Ot(t),ot:o.default.Z(t.ref).y,ill:t.isLazyLoading,ul:o.default._(),st:t.type},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===a.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),t.type===a.SpotType.API?{plid:t.ref.id}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{})}getBidRequestEvent(t,i){return Object.assign({now:o.default.vi(),et:r.EventType.BID_REQUEST,adix:t.spotIndex,di:t.demandIndex,atix:t.Ki,ot:o.default.Z(t.ref).y,rc:t.refreshCount,to:c.default.getTimeOffset(),st:t.type,b:i},this.getSpotTypeAndTags(t))}getBidMatchedEvent(t,i){return Object.assign({now:o.default.vi(),et:r.EventType.BID_MATCHED,adix:t.spotIndex,di:t.demandIndex,atix:t.Ki,ot:o.default.Z(t.ref).y,rc:t.refreshCount,to:c.default.getTimeOffset(),st:t.type,b:i},this.getSpotTypeAndTags(t))}getHBWinnerEvent(t,i,e){const s={n:i,s:[{br:e}]};return Object.assign({now:o.default.vi(),et:r.EventType.HBWinner,di:t.demandIndex,st:t.type,to:c.default.getTimeOffset(),adix:t.spotIndex,atix:t.Ki,rc:t.refreshCount,b:[s]},this.getSpotTypeAndTags(t))}getAdRequest(t,i,e,s,n,h){var d;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.AD_REQUEST,adix:t.spotIndex,di:t.demandIndex,au:i,atix:t.Ki,pr:t.genericParams.displayName||t.providerName||"NA",f:o.default.Ot(t),ot:o.default.Z(t.ref).y,ill:t.isLazyLoading,rc:t.refreshCount,to:c.default.getTimeOffset(),plk:e,dcs:t.isDcs,ul:o.default._(),st:t.type,s},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===a.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.type===a.SpotType.API?{plid:t.ref.id}:{}),t.type===a.SpotType.API&&(null===(d=t.options)||void 0===d?void 0:d.disableViewabilityOptimization)?{vod:!0}:{}),t.generalData?{gd:t.generalData}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{}),"number"==typeof n?{pi:n}:{}),h?{rsn:h}:{})}getDcsEvent(t,i,e,s,n){return Object.assign({now:o.default.vi(),to:c.default.getTimeOffset(),et:t,pl:o.default.q(),mi:e,fmi:n})}getAdMatchedEvent(t,i,e,s,n,d,u,f){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.AD_MATCHED,adix:t.spotIndex,di:t.demandIndex,au:i||"NA",atix:t.Ki,pr:t.genericParams.displayName||t.providerName||"NA",im:e,w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.Ot(t),ot:o.default.Z(t.ref).y,pt:t.type===a.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.ref),ill:t.isLazyLoading,rc:t.refreshCount,to:c.default.getTimeOffset(),plk:s,dcs:t.isDcs,ul:o.default._(),st:t.type},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===a.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),n?{rsn:n}:{}),d?{hb:d}:{}),t.generalData?{gd:t.generalData}:{}),u),t.relocationPlid?{plid:t.relocationPlid}:{}),t.type===a.SpotType.API?{plid:t.ref.id}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{}),f?{msg:f}:{})}getInframeAdMatchedEvent(t,i,e,s){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.AD_MATCHED,adix:t.spotIndex,pr:t.genericParams.displayName||t.providerName||"NA",im:i,w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.Ot(t),ot:o.default.Z(t.ref).y,pt:t.type===a.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.ref),ill:t.isLazyLoading,to:c.default.getTimeOffset(),plk:e,dcs:t.isDcs,ul:o.default._(),st:t.type},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===a.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),s?{rsn:s}:{}),t.generalData?{gd:t.generalData}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),t.type===a.SpotType.API?{plid:t.ref.id}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{})}getAdImpressionEvent(t,i,e,s,n){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.AD_IMPRESSION,adix:t.spotIndex,di:t.demandIndex,au:i||"NA",atix:t.Ki,pr:t.genericParams.displayName||t.providerName||"NA",w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.Ot(t),ot:o.default.Z(t.browsiAd).y,pt:t.type===a.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.browsiAd),ill:t.isLazyLoading,rc:t.refreshCount,to:c.default.getTimeOffset(),plk:e,dcs:t.isDcs,ul:o.default._(),st:t.type},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===a.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),n),t.generalData?{gd:t.generalData}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),t.type===a.SpotType.API?{plid:t.ref.id}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{})}Rs(t,i,e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.AD_IMPRESSION,adix:t.spotIndex,pr:t.genericParams.displayName||t.providerName||"NA",w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.Ot(t),ot:o.default.Z(t.browsiAd).y,pt:t.type===a.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.browsiAd),ill:t.isLazyLoading,to:c.default.getTimeOffset(),plk:i,dcs:t.isDcs,ul:o.default._(),st:t.type},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===a.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.generalData?{gd:t.generalData}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),t.type===a.SpotType.API?{plid:t.ref.id}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{}),e?{ded:!0}:{})}getAdMeasurableEvent(t,i,e,s){return Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.MEASURABLE_IMPRESSION,adix:t.spotIndex,di:t.demandIndex,au:i||"NA",atix:t.Ki,pr:t.genericParams.displayName||t.providerName||"NA",w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.Ot(t),ot:o.default.Z(t.browsiAd).y,pt:t.type===a.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.browsiAd),ill:t.isLazyLoading,rc:t.refreshCount,to:c.default.getTimeOffset(),plk:e,dcs:t.isDcs,ul:o.default._(),st:t.type},this.getSpotTypeAndTags(t)),s?{rsn:s}:{}),this.getDcsCountAndType(t.isDcs)),t.type===a.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{})}getViewedImpressionEvent(t,i,e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.VIEWED_IMPRESSION,adix:t.spot.spotIndex,di:t.spot.demandIndex,au:t.adUnit||(t.demandResponse.c.d?t.demandResponse.c.d.au:t.demandResponse.c.au)||"NA",atix:t.spot.Ki,pr:t.spot.genericParams.displayName||t.spot.providerName||"",w:t.spot.implementedSize?t.spot.implementedSize.w:-1,h:t.spot.implementedSize?t.spot.implementedSize.h:-1,f:o.default.Ot(t.spot),ot:o.default.Z(t.spot.browsiAd).y,pt:t.spot.type===a.SpotType.STICKY?t.spot.positionType:h.default.instance.getAdPositionType(t.spot.browsiAd),ill:t.spot.isLazyLoading,rc:t.refreshCount,to:c.default.getTimeOffset(),tiv:i,c:t.viewedImpressions,piv:e,plk:t.demandResponse.plk,dcs:t.spot.isDcs,ul:o.default._(),st:t.spot.type},this.getSpotTypeAndTags(t.spot)),this.getDcsCountAndType(t.spot.isDcs)),t.spot.type===a.SpotType.API||this.shouldSendParentPageViewId(t.spot.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.spot.generalData?{gd:t.spot.generalData}:{}),t.gamResponseInfo),t.spot.relocationPlid?{plid:t.spot.relocationPlid}:{}),t.spot.type===a.SpotType.API?{plid:t.spot.ref.id}:{}),"number"==typeof t.spot.relocationStatus?{rs:t.spot.relocationStatus}:{})}Ds(t,i,e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.VIEWED_IMPRESSION,adix:t.spot.spotIndex,pr:t.spot.genericParams.displayName||t.spot.providerName||"",w:t.spot.implementedSize?t.spot.implementedSize.w:-1,h:t.spot.implementedSize?t.spot.implementedSize.h:-1,f:o.default.Ot(t.spot),ot:o.default.Z(t.spot.browsiAd).y,pt:t.spot.type===a.SpotType.STICKY?t.spot.positionType:h.default.instance.getAdPositionType(t.spot.browsiAd),ill:t.spot.isLazyLoading,to:c.default.getTimeOffset(),tiv:i,c:t.viewedImpressions,piv:e,plk:t.demandResponse.plk,dcs:t.spot.isDcs,ims:t.spot.isMeasurable,ul:o.default._(),st:t.spot.type},this.getSpotTypeAndTags(t.spot)),this.getDcsCountAndType(t.spot.isDcs)),t.spot.type===a.SpotType.API||this.shouldSendParentPageViewId(t.spot.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.spot.generalData?{gd:t.spot.generalData}:{}),t.spot.relocationPlid?{plid:t.spot.relocationPlid}:{}),t.spot.type===a.SpotType.API?{plid:t.spot.ref.id}:{}),"number"==typeof t.spot.relocationStatus?{rs:t.spot.relocationStatus}:{})}getViewedImpressionEventAV(t,i){var e;return Object.assign({now:o.default.vi(),et:r.EventType.VIEWED_IMPRESSION_AV,adix:t.spotIndex,di:t.demandIndex,au:o.default.getDemandConfig(i).aup||"NA",atix:t.Ki,pr:t.genericParams.displayName||t.providerName||"",w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,f:o.default.Ot(t),ot:o.default.Z(t.browsiAd).y,pt:t.type===a.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.browsiAd),ill:t.isLazyLoading,rc:(null===(e=t.refresh)||void 0===e?void 0:e.lastSuccessfulRefresh)||0,to:c.default.getTimeOffset(),ul:o.default._(),st:t.type},this.getSpotTypeAndTags(t))}getFoundPublisherAd(t,i,e){return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.FOUND_PUBLISHER_AD,adix:t.adIndex,h:t.height,f:o.default.jt(t.element),ot:o.default.Z(t.element).y,to:c.default.getTimeOffset(),pt:t.positionType,pr:t.providerName,plid:t.placementId,au:t.adUnit,dcs:l.default.isDcsPageview(),ul:o.default._(),rc:t.refreshCount},i),this.getDcsCountAndType(l.default.isDcsPageview())),this.shouldSendParentPageViewId(l.default.isDcsPageview())?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.refreshType?{rt:t.refreshType}:{}),t.gamResponseInfo),e?{ded:!0}:{})}Fs(t,i,e){const s=t.ref;let n=o.default.Z(s).y,a=t.ref.getBoundingClientRect(),d=h.default.instance.getAdPositionType(s,a.height,n,!0);return Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.VIEWED_PUBLISHER_AD,adix:t.adIndex,h:a.height,f:o.default.jt(s),ot:n,rc:t.refreshCount,to:c.default.getTimeOffset(),pt:d,tiv:i,piv:e,pr:t.provider,plid:t.placementId,au:t.adUnit,c:t.viewedImpressions,ill:t.isLazyLoaded,dcs:l.default.isDcsPageview(),ul:o.default._()},this.getDcsCountAndType(l.default.isDcsPageview())),this.shouldSendParentPageViewId(l.default.isDcsPageview())?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.refreshType?{rt:t.refreshType}:{}),t.gamResponseInfo)}getViewedPublisherAdAv(t){let i=o.default.Z(t.element).y,e=t.element.getBoundingClientRect(),s=h.default.instance.getAdPositionType(t.element,e.height,i,!0);return Object.assign({now:o.default.vi(),et:r.EventType.VIEWED_PUBLISHER_AD_AV,rc:t.refreshCount,h:t.height,f:o.default.jt(t.element),ot:o.default.Z(t.element).y,to:c.default.getTimeOffset(),pt:s,pr:t.providerName,plid:t.placementId,au:t.adUnit,ill:t.isLazyLoaded,ul:o.default._()})}getPubAdRefreshEvent(t,i,e,s){const n=t.ref;let a=o.default.Z(n).y,d=n.getBoundingClientRect(),u=h.default.instance.getAdPositionType(n,d.height,a,!0);return Object.assign({now:o.default.vi(),et:r.EventType.PUB_AD_REFRESH_REQUEST,adix:t.adIndex,rc:i,f:o.default.jt(n),ot:o.default.Z(n).y,to:c.default.getTimeOffset(),pt:u,pr:s,plid:t.placementId,au:t.adUnit,dcs:l.default.isDcsPageview(),ul:o.default._(),rt:e})}getFocusChangeEvent(t,i){return Object.assign({now:o.default.vi(),et:r.EventType.FOCUS_CHANGED,if:t,to:c.default.getTimeOffset()},i&&{opl:!0})}getAdBlockEvent(t,i,e){return Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.AD_REQUEST_BLOCKED,adix:t.spotIndex,atix:t.Ki,pr:t.genericParams.displayName||t.providerName||"NA",f:o.default.Ot(t),ot:o.default.Z(t.ref).y,ill:t.isLazyLoading,rc:t.refreshCount,rsn:i,msg:e,to:c.default.getTimeOffset(),dcs:t.isDcs,st:t.type},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.generalData?{gd:t.generalData}:{})}getApiBlockEvent(t,i,e){return Object.assign({now:o.default.vi(),et:r.EventType.API_REQUEST_BLOCKED,rsn:t,msg:i,to:c.default.getTimeOffset(),plid:e})}getRefreshBlockEvent(t,i){return Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.PUB_AD_REFRESH_BLOCK,ot:o.default.Z(t).y,rsn:i,to:c.default.getTimeOffset(),dcs:l.default.isDcsPageview()},this.getDcsCountAndType(l.default.isDcsPageview())),this.shouldSendParentPageViewId(l.default.isDcsPageview())?{ppvid:l.default.getDcsParentPageViewID()}:{})}getUserEngagementEvent(){return Object.assign({now:o.default.vi(),et:r.EventType.USER_ENGAGED,pl:o.default.q(),to:c.default.getTimeOffset()})}getPubAdsBid(t){return Object.assign({now:o.default.vi(),et:r.EventType.FOUND_PUBLISHER_AD_BIDS,pvid:this.staticFields.pvid},t)}getAdInViewportEvent(t,i){return{now:o.default.vi(),to:c.default.getTimeOffset(),et:r.EventType.AD_IN_VIEWPORT,rc:t.refreshCount,atix:t.Ki,adix:t.spotIndex,ivp:i.toFixed(2)}}getStickClosedEvent(t){return{now:o.default.vi(),et:r.EventType.STICKY_CLOSED,adix:t.spotIndex,di:t.demandIndex,pr:t.genericParams.displayName||t.providerName||"NA",w:t.implementedSize?t.implementedSize.w:-1,h:t.implementedSize?t.implementedSize.h:-1,ot:o.default.Z(t.browsiAd).y,pt:t.type===a.SpotType.STICKY?t.positionType:h.default.instance.getAdPositionType(t.browsiAd),rc:t.refreshCount,to:c.default.getTimeOffset(),ul:o.default._()}}getErrorEvent(t,i,e,s){var n,r,o,h,a,l;return Object.assign({et:t,msg:i,file:e,now:Math.floor(Date.now()/1e3),to:+new Date-this.profile.timeOffset,lineNo:-1,columnNo:-1,url:this.staticFields.url,d:this.staticFields.d,res:this.supplyStaticFields.res,bpvid:this.profile.bootstrapPageViewId,sk:this.profile.siteKey,pk:this.profile.publisherKey,uid:c.default.getUserID(),sid:this.profile.sessionID,pvid:this.profile.pageViewID,geo:this.profile.countryCode,ts:this.profile.trafficSource,mv:this.profile.version,iru:this.profile.isReturningUser,scid:this.profile.supplyConfigId,db:(null===(n=this.profile.deviceType)||void 0===n?void 0:n.browser)||"",dbt:(null===(r=this.profile.deviceType)||void 0===r?void 0:r.browserType)||"",dp:(null===(o=this.profile.deviceType)||void 0===o?void 0:o.devicePlatform)||"",dv:(null===(h=this.profile.deviceType)||void 0===h?void 0:h.vendor)||"",dos:(null===(a=this.profile.deviceType)||void 0===a?void 0:a.os)||"",dosv:(null===(l=this.profile.deviceType)||void 0===l?void 0:l.osVersion)||""},s?{error:s}:{})}getPlaceholderEvent(t,i,e){return Object.assign(Object.assign({now:o.default.vi(),et:i,di:t.demandIndex,st:t.type,to:c.default.getTimeOffset(),adix:t.spotIndex,atix:t.Ki,ul:o.default._()},this.getSpotTypeAndTags(t)),e?{rsn:e}:{})}getInframePlacementEvent(t){return{now:o.default.vi(),pc:t,to:c.default.getTimeOffset(),et:r.EventType.PLACEMENTS_SENT}}ks(t,i,e){return{now:o.default.vi(),to:c.default.getTimeOffset(),et:r.EventType.INFRAME_HAS_DEMAND,ill:i.isLazyLoading,im:t,st:i.type,rsn:e,adix:i.spotIndex}}getInframeAdRequest(t,i){var e;return Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({now:o.default.vi(),et:r.EventType.AD_REQUEST,adix:t.spotIndex,pr:t.genericParams.displayName||t.providerName||"NA",f:o.default.Ot(t),ot:o.default.Z(t.ref).y,ill:t.isLazyLoading,to:c.default.getTimeOffset(),plk:i,dcs:t.isDcs,ul:o.default._(),st:t.type},this.getSpotTypeAndTags(t)),this.getDcsCountAndType(t.isDcs)),t.type===a.SpotType.API||this.shouldSendParentPageViewId(t.isDcs)?{ppvid:l.default.getDcsParentPageViewID()}:{}),t.type===a.SpotType.API?{plid:t.ref.id}:{}),t.type===a.SpotType.API&&(null===(e=t.options)||void 0===e?void 0:e.disableViewabilityOptimization)?{vod:!0}:{}),t.generalData?{gd:t.generalData}:{}),t.relocationPlid?{plid:t.relocationPlid}:{}),"number"==typeof t.relocationStatus?{rs:t.relocationStatus}:{})}getCustomRefreshRateEvent(t,i){return{et:r.EventType.CUSTOM_REFRESH_RATE_RULE,now:o.default.vi(),at:t,rr:i}}getBillableEvent(t){return{now:o.default.vi(),et:r.EventType.BILLABLE_EVENT,to:c.default.getTimeOffset(),pr:t.type}}getSpotTypeAndTags(t){return{ptg:t.tags.positionTag,st:t.type}}shouldSendParentPageViewId(t){return t&&this.profile.pageViewID!==l.default.getDcsParentPageViewID()&&l.default.checkType(["slides","script"])}sendInframePlacementEvent(t){const i=this.getInframePlacementEvent(t);this.addToEventsQue(s.EventTopic.INFRAME,r.EventType.PLACEMENTS_SENT,[i])}getDcsCountAndType(t){return t&&this.profile.pageViewID!==l.default.getDcsParentPageViewID()?{ac:l.default.getDcsActionCounter(),dcst:c.default.getDcsType()}:{}}isValidURL(t){if(!t)return!1;try{return new URL("https://"+t),!0}catch(t){return!1}}}i.default=m,m.firedEvents={spotEngineStatus:"in_progress"}},8562:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4436),n=e(2661),r=e(5662),o=e(6389);class h{constructor(){this.logger=new n.default("FocusService"),this.isHidden="hidden"===document.visibilityState,this.unloading=!1,this.logger.info(`focus on start. in focus: ${!this.isHidden}`),this.isSubscribed=!0,this.isHidden&&!this.unloading&&s.default.get().sendFocusChangedEvent(!1,!0),this.subscribe((t=>{this.isHidden=t,this.logger.info(`focus changed. in focus: ${!this.isHidden}`),this.unloading||s.default.get().sendFocusChangedEvent(!t)}))}static get instance(){return this._instance||(this._instance=new h),this._instance}subscribe(t){o.Profiler.get().debug&&this.listenToDemoVisibilityChange(t);const i=r.default.get();i.listen("visibilitychange",document,(()=>{if(this.isSubscribed)switch(document.visibilityState){case"hidden":h.instance.isHidden=!0,t(!0);break;case"visible":h.instance.isHidden=!1,this.unloading=!1,t(!1)}})),i.listen("beforeunload",window,(()=>{this.unloading=!0}))}unsubscribe(){return this.isSubscribed=!1,!0}waitForUserFocus(){return this.isHidden?(this.logger.info("oof focus, waiting"),new Promise((t=>{this.subscribe((i=>{i||t()}))}))):Promise.resolve()}listenToDemoVisibilityChange(t){r.default.get().listen("demoVisibilityChange",document,(()=>{window._isHidden?(h.instance.isHidden=!0,t(!0)):(h.instance.isHidden=!1,t(!1))}))}}i.default=h},3510:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(8562),r=e(1297),o=e(6389);i.default=class{constructor(t,i,e=[1e3],n,r,o,h){this.timeouts=[],this.isInView=!1,this.logger=new s.default("IntersectionHandler"),this.element=t,this.threshold=i,this.rootMargin=r,e=Array.from(new Set(e)),this.breakpoints=e.sort(((t,i)=>t-i)),this.observer=this.initObserver(),this.callback=n,this.outOfThresholdCallback=o||(()=>{}),this.isContinuousObserver=!!h}initObserver(){let t={threshold:[this.threshold,Math.max(0,this.threshold-.01)],rootMargin:this.rootMargin};return n.default.instance.subscribe((t=>{t?this.clearAllTimeouts():this.isInView&&this.setBreakpointsTimeouts()})),new IntersectionObserver(this.observationCallback.bind(this),t)}observe(){return this.logger.verbose("observe ",this.element,` for threshold of ${this.threshold} with breakpoint of ${this.breakpoints} and ${this.rootMargin||"no"} rootMargin`),this.observer.observe(this.element),new Promise((t=>{this.resolver=t}))}observationCallback(t){const i=t[0];i.intersectionRatio>=this.threshold&&this.isAboveMinimumSize(i.boundingClientRect.height)?(this.isInView=!0,this.setBreakpointsTimeouts()):(this.isInView=!1,this.clearAllTimeouts(),this.outOfThresholdCallback())}isAboveMinimumSize(t){return o.Profiler.get().measureViewabilityForAllSizes||t>=r.MIN_AD_SIZE}setBreakpointsTimeouts(){const t=this.isContinuousObserver?[...this.breakpoints]:this.breakpoints;t.forEach((i=>{this.timeouts.push(setTimeout((()=>{const i=t.shift();this.callback(i),this.breakpoints.length||this.observationDone()}),i))}))}clearAllTimeouts(){this.timeouts.forEach((t=>{clearTimeout(t)}))}observationDone(){this.logger.info("All break points reached for element:",this.element),this.resolver(),this.clearObserver()}clearObserver(){this.logger.info("Stop observing",this.element),this.clearAllTimeouts(),this.observer.unobserve(this.element),this.observer.disconnect()}}},4469:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(2661),r=e(6537),o=e(5662),h=e(6389),a=e(4524),l=e(549),c=e(5353);class d{constructor(){var t,i;if(this.logger=new n.default("LazySpots"),this.userPositionInterval=-1,this.postMovementTimeoutActive=!1,this.serviceActive=!1,this.lazySpots=[],!a.default.isLazySpotsEnabled())throw new Error("no config found");this.generalLazyConfig=l.SpotsUtils.getGeneralLazyConfig(),this.lazyStatus=this.getLazyStatus(!0),this.lazySpotsListener=s.default.Ui((()=>this.checkLocationAndFetch()),100),this.approvalsCountTarget=(null===(t=this.generalLazyConfig)||void 0===t?void 0:t.approvalCount)||-1,this.profile=h.Profiler.get(),this.autoFirstFold=(null===(i=this.generalLazyConfig)||void 0===i?void 0:i.autoThreshold)?this.calculateFirstFoldByThreshold(this.generalLazyConfig.autoThreshold):0,this.fetchTime=this.buildFetchTime()}buildFetchTime(){return this.generalLazyConfig?this.generalLazyConfig.avgFetchTime:-1}static getThresholdMidPoint(t,i){const e=s.default.Z(t.ref).y,n=d.getThresholdLocation(e,i);return Math.floor(e-.5*(e-n))}checkLocationAndFetch(){this.lazyStatus.positionListenerActive||this.startUserPositionInterval(),this.fetchChecking()}fetchChecking(t=!1){if(this.lazyStatus.scrollDirection===r.ScrollDirection.DOWN)for(const i of this.lazySpots)if(this.isSpotMissed(i.spot))this.logger.verbose(`spot ${i.spot.spotIndex} at position ${s.default.Z(i.spot.ref).y} missed, current position: ${s.default.Zt()}`),i.missedCallback(),this.zeroApprovalsCount(i);else if(this.isUserInThreshold(i)){if(this.logger.verbose(`user in threshold of spot ${i.spot.spotIndex}`),this.isExpectedNextPositionOk(i)){i.approvalsCount++,this.logger.verbose(`spot ${i.spot.spotIndex} approvalsCount ${i.approvalsCount}/${this.approvalsCountTarget}`),(this.approvalsTargetReached(i)||t)&&(this.logger.info(`spot ${i.spot.spotIndex} is good for fetching, userStatic=${t}`),i.fetchCallback(),this.lazySpots.splice(this.lazySpots.indexOf(i),1),this.lazySpots.length||this.stopService());break}this.zeroApprovalsCount(i)}else this.zeroApprovalsCount(i);else this.lazySpots.forEach((t=>this.zeroApprovalsCount(t)))}approvalsTargetReached(t){return t.approvalsCount>=this.approvalsCountTarget}zeroApprovalsCount(t){t.approvalsCount>0&&this.logger.verbose(`reset spot ${t.spot.spotIndex} approvalsCount 0/${this.approvalsCountTarget}`),t.approvalsCount=0}isExpectedNextPositionOk(t){return this.lazyStatus.expectedNextPosition<s.default.Z(t.spot.ref).y}getLazyStatus(t){const i=s.default.Zt(),e=Date.now(),n=t?0:i-this.lazyStatus.lastPosition,o=t?0:e-this.lazyStatus.previousTime,h=t||this.lazyStatus.lastPosition<i?r.ScrollDirection.DOWN:i==this.lazyStatus.lastPosition?this.lazyStatus.scrollDirection:r.ScrollDirection.UP,a=this.fetchTime/o;return{scrollDirection:h,expectedNextPosition:0===o?i:i+n*a,previousTime:e,lastPosition:i,positionListenerActive:!t&&this.lazyStatus.positionListenerActive}}static get(){return d._instance||(this._instance=new d),d._instance}calculateFirstFoldByThreshold(t){const i=s.default.q(),e=s.default.L().height,n=(e+(t-1)*((i-e)/9))/e+1,r=Math.round(100*n)/100;return Math.max(r,1)}isLazy(t){if(t.isEagerFirstFold())return!1;const i=l.SpotsUtils.getLazyConf(t.tags);if(!this.shouldCheckLazyLoad(t)||!i)return!1;if(this.isIllegalConfig(i))return this.logger.error(`${t.type} spot ${t.spotIndex} has an illegal configuration`,i),!1;t.adDistanceFromTop=s.default.Z(t.ref).y;const e=s.default.At(t)+1;return this.autoFirstFold?e>=this.autoFirstFold:e>=i.firstFold&&t.typeIndex>=i.firstAdIndex}shouldCheckLazyLoad(t){return t.type!==c.SpotType.STICKY&&this.fetchTime>-1}isIllegalConfig(t){return!this.autoFirstFold&&(void 0===t.firstFold||void 0===t.firstAdIndex)}subscribe(t,i,e){var n;this.serviceActive||this.startService(),this.isSpotMissed(t)&&e();const r=s.default.Z(t.ref).y,o=d.getThresholdLocation(r,null===(n=this.generalLazyConfig)||void 0===n?void 0:n.threshold);this.logger.info(`spot ${t.spotIndex} at ${r} will start at ${o.toFixed(2)}`),this.lazySpots.push({spot:t,approvalsCount:0,thresholdLocation:o,fetchCallback:i,missedCallback:e}),this.fetchChecking()}static getThresholdLocation(t,i=0){return t-s.default.It().height*i}isSpotMissed(t){return s.default.Z(t.ref).y<=this.lazyStatus.lastPosition}stopService(){var t;this.logger.info("stopping service"),o.default.get().removeListener("scroll",s.default.S(),this.lazySpotsListener),clearInterval(this.userPositionInterval),this.lazyStatus.positionListenerActive=!1,this.serviceActive=!1,this.lazyStatus=this.getLazyStatus(),null===(t=this.thresholdMonitor)||void 0===t||t.stopMonitoring(),this.fetchChecking()}startService(){var t;this.logger.info("starting service"),o.default.get().listen("scroll",s.default.S(),this.lazySpotsListener),this.startUserPositionInterval(),(null===(t=this.profile.spotsSupplyParams.lazySpots)||void 0===t?void 0:t.recalculateThreshold)&&(this.thresholdMonitor=this.ThresholdMonitor(),this.thresholdMonitor.startMonitoring()),this.serviceActive=!0}startUserPositionInterval(){this.lazyStatus=this.getLazyStatus(),this.lazyStatus.positionListenerActive||(this.userPositionInterval=window.setInterval((()=>{if(this.lazyStatus=this.getLazyStatus(),this.logger.verbose(`direction: ${this.lazyStatus.scrollDirection.toString()}, at ${s.default.Zt().toFixed(2)}, next location: ${this.lazyStatus.expectedNextPosition.toFixed(2)}`),this.noMovement()&&!this.postMovementTimeoutActive){const t=this.lazyStatus.lastPosition;setTimeout((()=>{var i;this.postMovementTimeoutActive=!1,t===this.lazyStatus.lastPosition&&(clearInterval(this.userPositionInterval),(null===(i=this.generalLazyConfig)||void 0===i?void 0:i.staticUser)&&this.fetchChecking(!0),this.lazyStatus.positionListenerActive=!1,this.logger.verbose("positionInterval stopped, static user"))}),500),this.postMovementTimeoutActive=!0}}),100)),this.lazyStatus.positionListenerActive=!0,this.logger.verbose("positionInterval started")}isUserInThreshold(t){const i=s.default.Z(t.spot.ref).y;return this.lazyStatus.lastPosition<i&&this.lazyStatus.lastPosition>t.thresholdLocation}noMovement(){return this.lazyStatus.lastPosition===this.lazyStatus.expectedNextPosition}ThresholdMonitor(){let t,i,e=s.default.q();return{startMonitoring:()=>{window.ResizeObserver?(i=new ResizeObserver((()=>{e=this.recalculateLazySpots(e)})),i.observe(s.default._t())):t=window.setInterval((()=>{e=this.recalculateLazySpots(e)}),800)},stopMonitoring:()=>{i?i.disconnect():clearInterval(t)}}}recalculateLazySpots(t){const i=s.default.q();return i>t&&(t=i,this.lazySpots.forEach((t=>{this.reCalculateSpotThreshold(t)}))),t}reCalculateSpotThreshold(t){var i;const e=s.default.Z(t.spot.ref).y,n=d.getThresholdLocation(e,null===(i=this.generalLazyConfig)||void 0===i?void 0:i.threshold);n-t.thresholdLocation>50&&(this.logger.info(`spot ${t.spot.spotIndex} moved to ${e}px and will start at ${n}`),t.thresholdLocation=n)}}i.default=d},5662:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661);class n{constructor(){this.callbackMap={},this.logger=new s.default("ListenerService"),this.externalListenersRemovers=[]}static get(){return this.instance||(this.instance=new n),this.instance}addExternalListenerRemoveFunction(t){this.externalListenersRemovers.push(t)}listen(t,i,e){i&&"function"==typeof i.addEventListener?(this.insert(t,e,i),i.addEventListener(t,e),this.logger.verbose(`Listening to ${t} on `,i)):this.logger.error("Failed listening to: ",i)}removeListener(t,i,e){if(i&&"function"==typeof i.removeEventListener){const s=this.findListener(t,e);e=s?s.callback:e,this.remove(t,e,i),i.removeEventListener(t,e),this.logger.verbose(`Stopped listening to ${t} on `,i)}else this.logger.error("Failed listening to: ",i)}removeAll(){var t;for(let t in this.callbackMap)this.callbackMap.hasOwnProperty(t)&&(this.callbackMap[t].forEach((i=>{try{i.listenObject.removeEventListener(t,i.callback),this.logger.verbose(`Stopped listening to ${t} on `,i.listenObject)}catch(e){this.logger.info(`failed to remove ${t} listener from`,i.listenObject,e.message)}})),this.callbackMap[t]=[]);null===(t=this.externalListenersRemovers)||void 0===t||t.forEach((t=>t()))}findListener(t,i){return this.callbackMap[t]&&this.callbackMap[t].find((t=>t.callback.name===i.name))}insert(t,i,e){this.callbackMap.hasOwnProperty(t)||(this.callbackMap[t]=[]),this.callbackMap[t].push({listenObject:e,callback:i})}remove(t,i,e){if(this.callbackMap.hasOwnProperty(t)){let s=this.callbackMap[t].find((t=>t.callback.toString()===i.toString()&&t.listenObject===e));if(null!=s){let i=this.callbackMap[t].indexOf(s);i>-1&&this.callbackMap[t].splice(i,1)}}}}i.default=n},7415:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(2661),r=e(4436);i.default=class{constructor(t,i,e){this.logger=new n.default("MeasurableImpressions"),this.spot=t,this.nonFriendlyFound=0,this.rootFrames=[],this.secLevelFrames=[],this.mutationConfig={childList:!0,subtree:!0},this.adUnit=i,this.plk=e}waitForSpotMeasurable(){if(this.spot.newBrowsiAd){if(this.rootFrames=this.scanAllFrames(this.spot.newBrowsiAd.adWrapper),this.rootFrames.forEach((t=>{this.secLevelFrames=this.secLevelFrames.concat(this.scanAllFrames(t))})),0==this.nonFriendlyFound&&!this.adFramesFound())return void this.waitForIframe();if(this.nonFriendlyFound>0&&!this.adFramesFound())return void this.sendEvent("non-friendly iframes");this.promiseAll(this.rootFrames.concat(this.secLevelFrames))}}sendEvent(t){this.spot.isMeasurable||(this.spot.isMeasurable=!0,r.default.get().sendAdMeasurableEvent(this.spot,this.adUnit,this.plk,t))}adFramesFound(){return this.secLevelFrames.length>0||(!this.spot.newBrowsiAd||!this.spot.newBrowsiAd.isIframe)&&this.rootFrames.length>0}promiseAll(t){let i=t.map((t=>this.waitForIframeLoad(t)));Promise.all(i).then((t=>{t.filter((t=>!t.status||"complete"!=t.status)).length||(this.logger.info("send measurable event after frames scan for spot ",this.spot.spotIndex," iframes scaned ",t," nonFriendly found ",this.nonFriendlyFound),this.sendEvent("all frames loaded"))})).catch((t=>this.logger.error("measurable no iframe loaded found ",t)))}waitForIframeLoad(t){return new Promise(((i,e)=>{const s=t.contentDocument||t.contentWindow.document;this.isIframeLoaded(s)?i({status:"complete",frame:t}):t.onload=e=>{i({status:"complete",frame:t})}}))}isIframeLoaded(t){return"complete"==t.readyState&&null!=t.querySelector("head")&&t.querySelector("head").childNodes.length>0&&null!=t.querySelector("body")&&t.querySelector("body").childNodes.length>0}scanAllFrames(t){const i=s.default.querySelectorOnDocument(t,"iframe"),e=i.filter((t=>s.default.Bi(t.element)));return this.nonFriendlyFound+=i.length-e.length,e.map((t=>t.element))}waitForIframe(){this.observer=new MutationObserver((t=>this.handleMutationFound(t))),this.rootFrames.length?this.rootFrames.forEach((t=>{this.observer.observe(t.contentDocument||t.contentWindow.document,this.mutationConfig)})):this.spot.newBrowsiAd&&this.observer.observe(this.spot.newBrowsiAd.adWrapper,this.mutationConfig)}handleMutationFound(t){if(t.forEach((t=>{Array.from(t.addedNodes).forEach((t=>{"IFRAME"==t.nodeName&&this.secLevelFrames.push(t)}))})),this.secLevelFrames.length){this.logger.info("Observer destroyed");const t=this.secLevelFrames.filter((t=>s.default.Bi(t)));t.length?this.promiseAll(t):this.sendEvent("non-friendly iframes")}}}},9813:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(2661),r=e(6537),o=e(6389),h=e(4524),a=e(549),l=e(5353),c=e(3510);class d{constructor(){if(this.logger=new n.default("NativeLazySpots"),this.lazySpots=[],this.lazySpotsQue=[],!h.default.isLazySpotsEnabled())throw new Error("no config found");this.bucketsMap={},this.profile=o.Profiler.get()}Ns(t){const{scrollDirection:i}=t.scrollStatus;if(i===r.ScrollDirection.UP)return{shouldFetch:!1};if(this.isUserInThreshold(t)){if(this.logger.verbose(`user in threshold of spot ${t.spot.spotIndex}`),this.Vs(t))return{shouldFetch:!0};t.retestTimeoutId||this.retestExpectedNextPosition(t)}else this.isSpotMissed(t.spot)&&this.Bs(t);return{shouldFetch:!1}}Bs(t){clearTimeout(t.retestTimeoutId),t.isMissed||(t.isMissed=!0,this.logger.verbose(`spot ${t.spot.spotIndex} at position ${s.default.Z(t.spot.ref).y} missed, current position: ${s.default.Zt()}`),t.missedCallback())}zs(t){var i;clearTimeout(this.fetchTimeoutId),null===(i=t.observer)||void 0===i||i.clearObserver();const e=this.lazySpots.indexOf(t),s={spotIndex:t.spot.spotIndex,fetchCallback:this.Ls.bind(this,t)};this.lazySpotsQue.push(s);const n=!this.lazySpots[e-1]||this.lazySpots[e-1].isMissed;this.setFetchTimeout(n)}setFetchTimeout(t){t?this.fetchQue():this.fetchTimeoutId=setTimeout((()=>{this.fetchQue()}),50)}fetchQue(){this.lazySpotsQue.sort(((t,i)=>t.spotIndex-i.spotIndex)),this.lazySpotsQue.forEach((t=>{t.fetchCallback()})),this.lazySpotsQue.splice(0,this.lazySpotsQue.length)}Ls(t){this.logger.info(`spot ${t.spot.spotIndex} is good for fetching`),t.fetchCallback(),this.Us(t),this.lazySpots.length||this.stopService()}Us(t){this.lazySpots.splice(this.lazySpots.indexOf(t),1)}Vs(t){return t.scrollStatus.expectedNextPosition<s.default.Z(t.spot.ref).y}Hs(t,i){const{userLastPosition:e,previousTime:n,scrollDirection:o}=t.scrollStatus,h=s.default.Zt(),a=Date.now(),l=i?0:h-e,c=i?0:a-n,d=e<h?r.ScrollDirection.DOWN:h==e?o:r.ScrollDirection.UP,u=this.bucketsMap[t.spot.spotIndex].avgFetchTime/c;return{scrollDirection:d,expectedNextPosition:0===c?h:h+l*u,previousTime:a,userLastPosition:h,isIntersecting:!0}}static get(){return d._instance||(this._instance=new d),d._instance}getBucketsMap(t){let i={};return t.forEach((t=>{i[t.firstAdIndex]=t})),i}getSpotLazyConfig(t){const i=a.SpotsUtils.getLazyBucketsConf(t.tags),e=t.positionTagIndex?t.positionTagIndex:t.typeIndex;if(i&&"number"==typeof e){const s=this.getBucketsMap(i),n=Object.keys(s).map((t=>Number(t))),r=Math.max(...n.filter((t=>t<=e)));if(r>=0){const i=s[r];return this.logger.verbose(`${t.type} spot ${t.spotIndex} lazy bucket config`,i),this.bucketsMap[t.spotIndex]=i,i}}this.logger.verbose(`no lazy bucket config found for ${t.type} spot ${t.spotIndex}`)}isLazy(t){if(t.isEagerFirstFold())return!1;const i=this.getSpotLazyConfig(t);if(!this.shouldCheckLazyLoad(t)||!i)return!1;if(this.isIllegalConfig(i))return this.logger.error(`${t.type} spot ${t.spotIndex} has an illegal configuration`,i),!1;t.adDistanceFromTop=this.Ws(t);const e=s.default.At(t)+1,n=t.positionTagIndex?t.positionTagIndex:t.typeIndex;return e>=i.firstFold&&n>=i.firstAdIndex}shouldCheckLazyLoad(t){var i;return t.type!==l.SpotType.STICKY&&(null===(i=this.bucketsMap[t.spotIndex])||void 0===i?void 0:i.avgFetchTime)>-1}isIllegalConfig(t){return void 0===t.firstFold||void 0===t.firstAdIndex}qs(t){var i;const e=(null===(i=this.bucketsMap[t.spot.spotIndex])||void 0===i?void 0:i.threshold)||0;this.logger.info(`spot ${t.spot.spotIndex}, will start ${Math.trunc(e*s.default.ht())}px before spot.ref: `,t.spot.ref);const n=d.Gs(e),r=this.Js.bind(this,t),o=this.Xs(t.spot),h=new c.default(t.spot.ref,.01,o,(i=>{this.observerCallback.apply(this,[t,i])}),n,r,!0);return h.observe().then(),h}observerCallback(t,i){if(t.scrollStatus=this.Hs(t,!i),i){const{shouldFetch:i}=this.Ns(t);i&&this.zs(t)}}retestExpectedNextPosition(t){this.observerCallback(t,0);const i=this.Xs(t.spot)[1];t.retestTimeoutId=setTimeout((()=>{this.observerCallback(t,i)}),i)}subscribe(t,i,e){const n={spot:t,fetchCallback:i,missedCallback:e,scrollStatus:{scrollDirection:r.ScrollDirection.DOWN,userLastPosition:s.default.Zt()},isMissed:!1},o=this.qs(n);n.observer=o,this.isSpotMissed(t)&&this.Bs(n),this.lazySpots.push(n)}static Gs(t){return`0% 0% ${Math.trunc(100*t)}% 0%`}isSpotMissed(t){return this.Ws(t)<=s.default.Zt()}Js(t){t.scrollStatus.isIntersecting=!1,this.isSpotMissed(t.spot)&&this.Bs(t)}stopService(){this.logger.info("stopping service"),this.lazySpots.forEach((t=>{this.Us(t)}))}isUserInThreshold(t){if(!t.scrollStatus.isIntersecting)return!1;const i=this.Ws(t.spot);return s.default.Zt()<i}Ws(t){return s.default.Z(t.ref).y}Xs(t){return[0,100*(this.bucketsMap[t.spotIndex].approvalCount||-1)]}}i.default=d},3468:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(2661),r=e(4436),o=e(470),h=e(7016),a=e(5594),l=e(9150),c=e(6448),d=e(2350),u=e(3434),f=e(3200),v=e(8814),p=e(5345),m=e(6389),g=e(1675),b=e(4524),w=e(3486);class _{constructor(){this.metaDataIdentifiers={property:["og:title","og:description","og:url","og:type","article:section","article:author","article:published_time","article:modified_time","article:tag"],name:["title","description","url","keywords","section","author"]},this.logger=new n.default("pageStructure"),this.profile=m.Profiler.get(),this.allParagraphs=[],this.allImages=[]}static get(){return _.instance||(this.instance=new _),_.instance}buildPageStructureEvent(){u.default.get().resetFoundVideoPlayers(),d.default.get().scanAllSocialWidgets(),f.default.get().resetCommentSections(),this.scanElementsOnPage();const t=this.analyzeMetaData();return{event_type:h.EventType.PAGE_STRUCTURE,skipped_sa_elements:[...this.getSAElements(),...this.getSkippedElements()],page_meta_data:t.isFoundMetaData?t.metaData:null,publisher_ads:this.getPublisherAds(),browsi_ads:this.getBrowsiAds(),social_widgets:d.default.get().reportSocialElements(),paragraphs:this.getParagraphs(),images:this.getImages(),videos:u.default.get().reportVideos(),comment_section:f.default.get().reportCommentSection(),content_recommendation:this.getCRElements()}}sendPageStructureEvent(t,i){if((!i||i==g.default.getCurrentDcsElement())&&this.checkIfSendReport()){let i=this.buildPageStructureEvent();this.logger.info(`Page Structure Report ${t} is sent`),r.default.get().sendPageStructureEvent(i,t)}}sendPageStructureEventWithDelay(){if(!this.checkIfSendReport())return;let t=1e3*this.profile.pageStructureDelay;t-=b.default.getTimeOffset();const i=g.default.getCurrentDcsElement();setTimeout((()=>this.sendPageStructureEvent(p.PSPhase.DELAY,i)),Math.max(0,t))}analyzeMetaData(){let t=!1,i={},e=JSON.parse(JSON.stringify(this.metaDataIdentifiers));return t=this.compareMetasAtrr(s.default.Mi(document).querySelectorAll("meta"),e,t,i),(e.name.length>0||e.property.length>0)&&(t=this.compareMetasAtrr(document.body.querySelectorAll("meta"),e,t,i)),{isFoundMetaData:t,metaData:i}}compareMetasAtrr(t,i,e,s){for(let n=0;n<t.length;n++)for(let r in i){const o=i[r],h=t[n].getAttribute(r);if(!h)continue;let a=o.indexOf(h);if(a>-1){e=!0,s[o[a].split(":").pop()]=t[n].getAttribute("content"),o.splice(a,1)}}return e}checkIfSendReport(){return this.profile.sendPageStructure}getSAElements(){const t=o.default.get().getStayAwayElements();return this.logger.info("stay away elements to report ",t.map((t=>t.element))),t.map((t=>({type:"stay away",height:s.default.ut(t.element).h,offset_top:s.default.Z(t.element).y,sub_type:t.subType,stayAwayDistance:t.stayAwayDistance})))}getSkippedElements(){const t=w.default.getSkippedElementsContainers();return this.logger.info("skipped elements to report ",t),t.map((t=>({type:"skipped",height:s.default.ut(t).h,offset_top:s.default.Z(t).y})))}getPublisherAds(){const t=a.default.get().foundAds;return this.logger.info("publisher ads to report ",t.map((t=>t.element))),t.map((t=>({height:s.default.ut(t.element).h,offset_top:s.default.Z(t.element).y})))}getBrowsiAds(){const t=l.Embedder.Ks();return this.logger.info("browsi ads to report ",t),t.map((t=>({height:s.default.ut(t).h,offset_top:s.default.Z(t).y})))}getParagraphs(){const t=this.allParagraphs.filter((t=>t.element.innerText.replace(/ /g,"").length>10&&this.isValidContent(t.element)&&s.default.ut(t.element).h>5));return this.logger.info("paragraphs to report ",t.map((t=>t.element))),t.map((t=>({height:s.default.ut(t.element).h,offset_top:s.default.tt(t),word_count:t.element.innerText.split(/\s+/).length})))}getImages(){const t=this.allImages.filter((t=>{let i=s.default.ut(t.element);return i.h>5&&i.w>5&&this.isValidContent(t.element)}));return this.logger.info("images to report ",t.map((t=>t.element))),t.map((t=>({height:s.default.ut(t.element).h,offset_top:s.default.tt(t),width:s.default.ut(t.element).w})))}getCRElements(){const t=v.default.get().findCR();return this.logger.info("CR elements to report ",t.map((t=>t.element))),t.map((t=>({type:t.type,height:t.element?s.default.ut(t.element).h:-1,offset_top:s.default.Z(t.element).y})))}scanElementsOnPage(){const t="p:not(:empty)",i="img",e=g.default.getCurrentDcsElement(),n=e&&e instanceof HTMLElement?e:document;this.logger.verbose("dcs  is ",e," and queryroot is ",n),this.allParagraphs=s.default.querySelectorOnDocument(document,t).filter((t=>this.isInMainContent(t.element))),this.allImages=s.default.querySelectorOnDocument(n,i).filter((t=>this.isInMainContent(t.element))),s.default.querySelectorOnDocument(n,"*").map((t=>{u.default.get().appendIfVideo(t.element),f.default.get().addIfComments(t.element)}));Array.from(n.getElementsByTagName("iframe")).filter((t=>s.default.Bi(t)&&this.isValidExternalElement(t))).forEach((e=>{this.allParagraphs=this.allParagraphs.concat(s.default.querySelectorOnDocument(e,t)),this.allImages=this.allImages.concat(s.default.querySelectorOnDocument(e,i)),s.default.querySelectorOnDocument(e,"*").map((t=>{u.default.get().appendIfVideo(t.element),f.default.get().addIfComments(t.element)}))})),Array.from(n.getElementsByTagName("*")).filter((t=>t.shadowRoot&&this.isValidExternalElement(t))).forEach((e=>{this.allParagraphs=this.allParagraphs.concat(s.default.querySelectorOnDocument(e,t)),this.allImages=this.allImages.concat(s.default.querySelectorOnDocument(e,i)),s.default.querySelectorOnDocument(e,"*").map((t=>{u.default.get().appendIfVideo(t.element),f.default.get().addIfComments(t.element)}))}))}isValidContent(t){return s.default.Pi(t)&&!this.isInContentRecommendations(t)&&!this.isInVideoSection(t)&&!d.default.get().isSocialWidgetOrInSocialWidget(t)&&!this.isAdOrInAd(t)&&(!s.default.isFixed(t).status||s.default.Pi(s.default.isFixed(t).element))}isValidExternalElement(t){return this.isInMainContent(t)&&!d.default.get().isSocialWidgetOrInSocialWidget(t)&&!(t instanceof HTMLIFrameElement&&this.isAdOrInAd(t))}isInContentRecommendations(t){return v.default.get().isFound(t)}isInVideoSection(t){return 1==!!u.default.get().isNodeVideo(t)}isInMainContent(t){return c.default.instance.withinMainContent(t)}isAdOrInAd(t){const i=[...l.Embedder.Ks(),...a.default.get().foundAds.map((t=>t.element))];for(let e=0;e<i.length;e++)if(i[e]==t||s.default.isPositionContained(i[e],t))return!0;return!1}}i.default=_},3899:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5540),r=e(6389);class o{constructor(){this.titleSelectors=["h1","h2","h3","h4","h5","h6","header"],this.minDistance=60,this.oneLineSelectors=["span","div","p"],this.logger=new s.default("ContentTitle"),this.excludeElements=this.getExcludeElements(r.Profiler.get().pageLayoutSA.ex),this.titlesOnPage=this.collectTitles(),this.logger.verbose("titles",this.titlesOnPage),this.titlesLocations=this.getLocations(this.titlesOnPage),this.oneLinersOnPage=this.collectOneLiners(),this.logger.verbose("one liners",this.oneLinersOnPage),this.oneLinersLocations=this.getLocations(this.oneLinersOnPage)}static get(){return o.instance||(this.instance=new o),o.instance}collectTitles(t){return Array.from((t||document).querySelectorAll(this.titleSelectors.join(","))).filter((t=>n.default.$t(t,!1)&&!this.isExcluded(t)))}collectOneLiners(){const t=.3*n.default.X();return Array.from(document.querySelectorAll(this.oneLineSelectors.join(","))).filter((i=>this.isOneLine(i,t)))}isOneLine(t,i){return n.default.$t(t,!1)&&t.offsetHeight<30&&t.offsetWidth>i&&t.innerText.trim().length>0&&!this.isExcluded(t)}getLocations(t){return t.map((t=>this.getBottomOffset(t))).filter((t=>t>0)).sort(((t,i)=>t-i))}isTitle(t){return-1!=this.titlesOnPage.indexOf(t)}isCollectedOneLine(t){return-1!=this.oneLinersOnPage.indexOf(t)}isAfterOneLiner(t){const i=n.default.Z(t).y;if(i<1)return!1;if(this.isCollectedOneLine(t)){const e=this.getBottomOffset(t),s=this.oneLinersLocations.indexOf(e);if(s&&this.oneLinersLocations[s-1])return i-this.oneLinersLocations[s-1]<this.minDistance}for(let t=this.oneLinersLocations.length;t>=0;t--)if(i>=this.oneLinersLocations[t])return i-this.oneLinersLocations[t]<this.minDistance;return!1}isBetweenTitleAndContent(t){const i=t.previousElementSibling;if(i&&n.default.B(i)&&this.isTitle(i))return!0;const e=n.default.Z(t).y;if(e<1)return!1;if(this.isTitle(t)){const i=this.getBottomOffset(t),s=this.titlesLocations.indexOf(i);if(s&&this.titlesLocations[s-1])return e-this.titlesLocations[s-1]<this.minDistance}for(let t=this.titlesLocations.length;t>=0;t--)if(e>=this.titlesLocations[t])return e-this.titlesLocations[t]<this.minDistance;return!1}getBottomOffset(t){return n.default.Z(t).y+n.default.ut(t).h}getExcludeElements(t){return t&&t.length?Array.from(document.querySelectorAll(t.join(","))):[]}isExcluded(t){const i=-1!=this.excludeElements.indexOf(t);return i&&this.logger.verbose("element is excluded from page auto layout stay away by config",t),i}}i.default=o},2209:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(3510),r=e(4436),o=e(5540),h=e(9150),a=e(5353);i.default=class{constructor(){this.logger=new s.default("PlaceholderService"),this.isOpen=!1,this.active=!0}openPlaceholder(t){t.newBrowsiAd&&(this.applyPlaceholderStyle(t),this.isOpen=!0,this.observer=new n.default(t.newBrowsiAd.adContainer,.25,[1e3],(()=>{r.default.get().sendPlaceholderViewed(t)})),this.observer.observe())}getPlaceholderStyle(){return this.size?`display:block; width:${this.size.w}px; max-width:100%; min-height:${this.size.h}px; background-color:transparent;`:""}applyPlaceholderStyle(t){var i,e;const s=(null===(i=t.newBrowsiAd)||void 0===i?void 0:i.adContainer.style.cssText)||"";null===(e=t.newBrowsiAd)||void 0===e||e.adContainer.setAttribute("style",`${s} ${this.getPlaceholderStyle()}`)}stopObserving(){var t;this.active&&(null===(t=this.observer)||void 0===t||t.clearObserver(),this.observer=void 0)}closePlaceholder(t){if(this.active){if(!t.newBrowsiAd||!this.isOpen)return;const i="none"===t.newBrowsiAd.adContainer.style.display;if(!i&&t.type!==a.SpotType.STICKY&&o.default.isChangingViewport(t.newBrowsiAd.adWrapper))return void this.logger.verbose("placeholder changes viewport, keep open",t.newBrowsiAd);this.deactivatePlaceholder(),r.default.get().sendPlaceholderClosed(t,i?"other":"browsi"),h.Embedder.Ps(t)}}removePlaceholderStyle(t){if(this.active){if(!t)return;t.adContainer.style.removeProperty("width"),t.adContainer.style.removeProperty("max-width"),t.adContainer.style.removeProperty("background-color"),this.deactivatePlaceholder()}}setSize(t){this.size=t}deactivatePlaceholder(){this.isOpen=!1,this.stopObserving(),this.active=!1}}},2873:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(8677),n=e(4436),r=e(6389),o=e(2797),h=e(5540),a=e(2661),l=e(7016),c=e(1675);i.default=class{constructor(t,i){this.involvedSlotsIds=[],this.window=i,this.pbjsInstance=this.getPbjsInstance(t),this.googleTag=this.getGoogleTag(),this.logger=new a.default("PrebidListeners"),this.dcsWindowObject=i[c.default.windowVarName],this.functionBridge={init:t=>{this.onAuctionInit(t)},end:t=>{this.onAuctionEnd(t)},timeout:t=>{this.onBidTimeout(t)},won:t=>{this.onBidWon(t)},billable:t=>{this.onBillableEvent(t)}},this.profile=r.Profiler.get()}removeListeners(){this.pbjsInstance.que.push((()=>{this.pbjsInstance.offEvent("bidWon",this.functionBridge.won),this.profile.collectHbEvents&&(this.pbjsInstance.offEvent("auctionInit",this.functionBridge.init),this.pbjsInstance.offEvent("auctionEnd",this.functionBridge.end),this.pbjsInstance.offEvent("bidTimeout",this.functionBridge.timeout)),r.Profiler.get().sendPrebidBillableEvents&&this.pbjsInstance.offEvent("billableEvent",this.functionBridge.billable),this.dcsWindowObject&&(this.dcsWindowObject._prebidEventsCount=this.pbjsInstance.getEvents().length)}))}getPbjsInstance(t){return this.window[t]=this.window[t]||{},this.window[t].que=this.window[t].que||[],this.window[t]}getGoogleTag(){let t=this.window.googletag||{};return t.cmd=t.cmd||[],this.window.googletag=t,t}initListeners(){this.pbjsInstance.que.push((()=>{this.pbjsInstance.onEvent("bidWon",this.functionBridge.won),this.profile.collectHbEvents&&(this.initSlotRenderEndedListener(),this.initSlotRequestListener(),this.pbjsInstance.onEvent("auctionInit",this.functionBridge.init),this.pbjsInstance.onEvent("auctionEnd",this.functionBridge.end),this.pbjsInstance.onEvent("bidTimeout",this.functionBridge.timeout)),this.profile.sendPrebidBillableEvents&&this.initBillableEventsListener()}))}initSlotRenderEndedListener(){this.googleTag.cmd.push((()=>{this.googleTag.pubads().addEventListener("slotRenderEnded",(t=>{const i=t.slot.getSlotElementId();if(!this.involvedSlotsIds.includes(i))return;const e=h.default.Dt(t);this.sendDfpBidMatched(t.slot.getAdUnitPath(),!t.isEmpty,e,i)}))}))}initSlotRequestListener(){this.googleTag.cmd.push((()=>{this.googleTag.pubads().addEventListener("slotRequested",(t=>{const i=t.slot.getSlotElementId();if(!this.involvedSlotsIds.includes(i))return;const e=h.default.Dt(t),n=s.AuctionDataCollector.get().getSpotFromAdUnitCode(i);n&&s.AuctionDataCollector.get().collectDFPBidRequest(n,[{dfp:[e]}])}))}))}onBidTimeout(t){if(t){t=Array.isArray(t)?t:[t];const i={im:!1,rsn:"timeout",s:[{w:-1,h:-1}]};t.forEach((t=>{this.isBrowsiAuction(t.auctionId,t.adUnitCode,[t.adUnitCode])&&s.AuctionDataCollector.get().collectBidMatch(t.adUnitCode,t.bidder,i)}))}}onBidWon(t){const i=s.AuctionDataCollector.get().getSpotFromAdUnitCode(t.adUnitCode);if(i&&(this.profile.collectHbEvents&&n.default.get().sendHBWinner(i,t),h.default.isBrowsiLoggerActive())){const i={adUnit:t.adUnitCode,winner:t.bidder,size:{w:t.width,h:t.height}};window.dispatchEvent(new CustomEvent(l.EventType.HBWinner,{detail:i}))}}onAuctionEnd(t){const i=t.adUnitCodes[0],e=t.bidsReceived;this.isBrowsiAuction(t.auctionId,i,t.adUnitCodes)?(this.collectBidMatched(i,e),this.logger.hbLog(e,i,this.getNoBids(i),this.getPrebidWinner(i))):this.logger.verbose("not browsi auction",t)}isBrowsiAuction(t,i,e){return t.includes(i)&&t.includes("browsi")||e.some((t=>!!s.AuctionDataCollector.get().getSpotFromAdUnitCode(t)))}initBillableEventsListener(){var t;let i=this.pbjsInstance.getEvents();const e=null===(t=this.dcsWindowObject)||void 0===t?void 0:t._prebidEventsCount;e&&(i=i.slice(e));i.filter((t=>"billableEvent"===t.eventType)).forEach((t=>{n.default.get().sendBillableEvent(t.args)})),this.pbjsInstance.onEvent("billableEvent",this.functionBridge.billable)}onBillableEvent(t){n.default.get().sendBillableEvent(t)}onAuctionInit(t){let i=[];const e=t.adUnitCodes;if(!e[0]||!this.isBrowsiAuction(t.auctionId,e[0],e))return;const n={};t.bidderRequests.forEach((t=>{const i=t.bidderCode;t.bids.forEach((t=>{const e=Array.isArray(t.sizes[0])?t.sizes:[t.sizes],s=t.adUnitCode;n[s]=n[s]||{},n[s][i]=n[s][i]||{},n[s][i].sizes=n[s][i].sizes||[],n[s][i].sizes.push(e)}))})),Object.keys(n).forEach((t=>{this.involvedSlotsIds.push(t),Object.keys(n[t]).forEach((e=>{const r=[...new Set(h.default.flattenArray(n[t][e].sizes))];i.push({[e]:s.AuctionDataCollector.get().buildSizesFromArray(r)})})),s.AuctionDataCollector.get().collectBidRequest("prebid",t,i),i=[]}))}collectBidMatched(t,i){const e={};i.forEach((i=>{const n={im:Number(i.cpm)>0,s:[{w:i.width,h:i.height}],br:Number(i.cpm)};i.currency&&(n.brc=i.currency),i.requestTimestamp&&i.responseTimestamp&&(n.reqt=i.requestTimestamp,n.rest=i.responseTimestamp),e[i.bidder]=e[i.bidder]||[],e[i.bidder]=e[i.bidder].concat(n.s),s.AuctionDataCollector.get().collectBidMatch(t,i.bidder,n)}));let n=[];this.getNoBids(t).forEach((i=>{if(i.bidderRequestId&&n.includes(i.bidderRequestId))return;const r=e[i.bidder]||[];i.bidderRequestId&&n.push(i.bidderRequestId);const o={im:!1,rsn:"no_bid",s:s.AuctionDataCollector.get().buildSizesFromArray(i.sizes).filter((t=>!r.some((i=>i.w===t.w&&i.h===t.h))))};0!==o.s.length&&s.AuctionDataCollector.get().collectBidMatch(t,i.bidder,o)})),s.AuctionDataCollector.get().sendBidMatches(t)}getNoBids(t){if(this.pbjsInstance&&this.pbjsInstance.getNoBids&&"function"==typeof this.pbjsInstance.getNoBids){const i=this.pbjsInstance.getNoBids()[t];return i?i.bids:[]}return[]}sendDfpBidMatched(t,i,e,n){const r={im:i,s:[e],br:-1,au:t};s.AuctionDataCollector.get().collectBidMatch(n,o.ProviderType.DFP,r,!0)}getPrebidWinner(t){return this.pbjsInstance.getHighestCpmBids().find((i=>i.adUnitCode===t))}}},6389:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(4436),r=e(7016),o=e(5540);class h{constructor(t){this.logger=new s.default("Profile"),this.profile=this.buildProfile(t)}static get(){return this._instance||(this._instance=new h(window._middyo),this.updateExternalFlowHandler()),this._instance.profile}static rebuild(t){return this._instance=new h(t),this.updateExternalFlowHandler(),this._instance.profile}static setLoadTime(){this.get().loadTime=Date.now()-this.get().timeOffset}buildProfile(t){const i=h.evaluateLoaderParams(t);return h.mergeDeep(i,h.getDebugConfig()),window._middyo=i,i}static updateExternalFlowHandler(){const t=h._instance.profile;if(t.externalFlowHandler&&t.externalFlowHandler.preEngine)try{t.externalFlowHandler.preEngine(t)}catch(t){n.default.get().sendErrorEvent(r.EventType.CRASH,"preEngine",t.message)}this.updatePostHooks(t)}static updatePostHooks(t){var i;const e=t.spotsSupplyParams.dynamic;e&&(null===(i=t.loaderParams.ly.in)||void 0===i?void 0:i.di)&&(e.distance=this.getDistanceInPixelsByType(t.loaderParams.ly.in.di))}static evaluateLoaderParams(t){var i,e,s,n;return{loaderParams:t,admarking:h.convertAdMarking(t.sec.adm),analysisMode:t.ly.am,bootstrapPageViewId:t.bpvi,contentRecommendationStayAwayDistance:t.sec.crd,countryCode:t.r.cc,deviceType:h.convertDeviceType(t.dt),moatPercentage:t.ly.mp,esReportDomain:t.r.es,h:t.si.h,demandHost:t.si.dh,runMode:t.m,isReturningUser:t.r.ru,pageViewID:t.i.pv,prebidData:h.convertPrebidData(t.si.pd),prebidConfig:h.convertPrebidConfig(t.pc),prebidPath:t.si.pd.p,publisherKey:t.i.pk,sessionID:t.i.s,siteKey:t.i.sk,supplyConfigId:t.i.sc,targetElements:t.sec.te||[],timeOffset:t.to||0,trafficSource:t.r.ts,userID:t.i.u,version:t.ses.v,externalFlowHandler:t.externalFlowHandler,maxAdDensity:t.ly.mad,mainContentConfig:h.convertMC(t.sec.mc),debug:!!t.debug,draw:!!t.draw,yieldHostname:t.yhn,dcs:h.convertDCS(t.sec.dcs),lazyStayAway:t.sec.lsa,sendPageStructure:!!t.sec.psd,pageStructureDelay:t.sec.psd||0,articleId:t.i.aid,scanningTags:t.sec.st||[],activeView:t.si.av,pageLayoutSA:t.sec.plsa,predictorsKeyValueNames:h.convertPredictorKeyValueNames(t.si.v50,null===(i=t.pub)||void 0===i?void 0:i.p),adInViewport:t.si.aiv,logEngagement:t.ses.le,pageKeyValues:t.ly.pgkv||{},pubAdsRefresh:h.getPubAdsRefreshConfig(null===(e=t.pub)||void 0===e?void 0:e.r,null===(s=t.si.pd)||void 0===s?void 0:s.g),sampleViewed:t.si.sve,userAnonymousContinent:t.r.cl,blockLineItemIds:t.si.bli,pubAdsBidsPath:t.si.pabp,reportResponseTime:{active:t.si.rrt,timers:t.td},spotsSupplyParams:this.getLayoutConfig(t.ly,!!t.ly.ars,t.od),uxRules:this.convertUxRules(t.sec.ux||[]),uxFixes:this.getUxFixes(t),placeholder:t.ly.ph,eagerFirstFold:t.ly.eff,fixedSpotsFirst:t.ly.fsf,useWebVitals:t.ly.wv,apiRelocationSelectors:t.ly.ars,dcsState:t.dcss&&this.getDcsState(t.dcss),billableEvents:t.si.be,bulkEventsThrottle:t.si.bet,sendBrowsiImpressionDOMEvent:t.si.bi,scanThirdPartyProviders:!!t.ly.stp,cacheUtilsFunctions:!!t.ly.cuf,sendViewabilityCheckpoints:!!t.ly.vc,sendPrebidBillableEvents:!!t.ly.spbe,publisherAdMoat:{browsiIdOnly:!!t.ly.padm.bio,percentage:t.ly.padm.p},usingMagnite:!1,measureViewabilityForAllSizes:!!t.ly.mvas,customRefresh:!!(null===(n=t.pi)||void 0===n?void 0:n.crr),manualDfpIframeAds:void 0,collectHbEvents:!!t.si.chbe}}static getUxFixes(t){var i,e;return{dynamicIframeSize:null===(i=t.ly.uxfx)||void 0===i?void 0:i.dis,fixWiderAds:!!(null===(e=t.ly.uxfx)||void 0===e?void 0:e.fwa)}}static convertUxRules(t){return t.sa=t.sa||[],t.sk=t.sk||{},{stayAway:t.sa.map((t=>({selectorType:t.st,toDensity:t.td,values:t.v,adProviderName:t.adn,distance:t.d}))),skipped:{css:t.sk.c||[],xpath:t.sk.x||[]}}}static convertMC(t){return t?{enabled:!0,start:t.s||[],end:t.e||[]}:null}static convertDCS(t){return t&&"script"!==t.ty?{enable:!0,checkUrlChanges:t.cuc,newContent:t.acc?{className:t.acc.cn,id:t.acc.id,nodeName:t.acc.nn}:null,type:t.ty,articlesSelector:t.as,viewportPercentage:t.vp||0,mutationXpaths:t.xp||[],delay:t.d,scanAboveReadMore:t.sbrm,reInjectOnUrl:t.rij}:{enable:!1,checkUrlChanges:!1,newContent:{className:"",id:"",nodeName:""},type:"none",articlesSelector:"",viewportPercentage:0,mutationXpaths:[],scanAboveReadMore:!1}}static convertPredictorKeyValueNames(t,i){return{viewability50:t||"browsiViewability",papaas:i}}static convertPrebidData(t){return t?{prebidPath:t.p,globalInstanceName:t.g}:null}static convertPrebidConfig(t){return t?JSON.parse(t.pcm):null}static convertAdMarking(t){return t?{active:!0,color:t.c,text:t.t,customStyle:t.s}:{active:!1,color:null,text:null,customStyle:null}}static convertDeviceType(t){return{browser:t.b,os:t.os,browserType:t.bt,osVersion:t.osv,vendor:t.v,devicePlatform:t.p,device:t.d}}static getPubAdsRefreshConfig(t,i){return t&&t.c&&t.r&&t.l&&t.t?{active:!0,adIdType:t.t,adIds:t.l,refreshCount:t.c,refreshRate:t.r,dfpOnly:t.d,sendRefreshKV:t.kv,customPbjsName:i}:null}static getLayoutConfig(t,i,e){return{dynamic:this.convertLayoutDynamicConfig(i,t.in),fixed:this.convertLayoutFixedConfig(t.in),fixedTop:this.convertLayoutFixedConfig(t.t),fixedBottom:this.convertLayoutFixedConfig(t.b),sticky:this.convertLayoutStickyConfig(t),api:this.convertLayoutApiConfig(t),lazySpots:this.convertLayoutLazyConfig(t,e)}}static convertLayoutDynamicConfig(t,i){var e,s,n;if(i&&(i.dy||t))return Object.assign(Object.assign({},this.convertScannedSpot(i)),{distance:400,mainContentOnly:(null===(e=i.dy)||void 0===e?void 0:e.ico)||!1,maxItems:(null===(s=i.dy)||void 0===s?void 0:s.dmi)||0,startInFoldSelectors:i.sfs,potentialSpots:i.ps,avoidCLS:null===(n=i.acls)||void 0===n?void 0:n.dy})}static getDistanceInPixelsByType(t){if("PIXEL"===t.dt)return t.d;const i=o.default.L().height;return t.d*i}static convertLayoutFixedConfig(t){var i,e;if(null===(i=null==t?void 0:t.fi)||void 0===i?void 0:i.ds)return Object.assign(Object.assign(Object.assign(Object.assign({},this.convertScannedSpot(t)),{maxItems:-1,targetElements:t.fi.ds||t.fi.pids,targetElementPosition:t.fi.tep}),t.sfs?{startElementSelector:t.sfs}:{}),t.acls?{avoidCLS:null===(e=t.acls)||void 0===e?void 0:e.fi}:{})}static convertScannedSpot(t){var i,e,s,n,r,o,h,a,l,c;return Object.assign(Object.assign(Object.assign(Object.assign({allowedCreativeSizes:t.ds||[],engagedUsers:null===(i=t.ov)||void 0===i?void 0:i.eu,lazyLoading:(null===(e=t.ov)||void 0===e?void 0:e.ll)?{firstAdIndex:null===(n=null===(s=t.ov)||void 0===s?void 0:s.ll)||void 0===n?void 0:n.fai,firstFold:null===(o=null===(r=t.ov)||void 0===r?void 0:r.ll)||void 0===o?void 0:o.ff}:void 0,lazyLoadingBuckets:this.converLazyLoadingBucketsConfig(t),viewabilityThreshold:null===(h=t.ov)||void 0===h?void 0:h.vt},t.start?{startInFold:t.start}:{}),t.stop?{stopInFold:t.stop}:{}),(null===(a=t.acls)||void 0===a?void 0:a.api)?{avoidCLS:null===(l=t.acls)||void 0===l?void 0:l.api}:{}),{style:null===(c=t.st)||void 0===c?void 0:c.b})}static converLazyLoadingBucketsConfig(t){var i;if(!(null===(i=t.ov)||void 0===i?void 0:i.llb))return;const e=[];return t.ov.llb.map((t=>{e.push({firstAdIndex:t.fai,firstFold:t.ff,threshold:t.t,approvalCount:t.ac,avgFetchTime:t.aft})})),e}static convertLayoutStickyConfig(t){var i;if(t.s)return{location:t.s.l,allowedCreativeSizes:t.s.ds||[],closeButton:!!t.s.cb,useOriginalSizes:!!t.s.uos,style:null===(i=t.s.st)||void 0===i?void 0:i.b}}static convertLayoutApiConfig(t){if(!t)return;const i={};return["in","t","b","s"].forEach((e=>{var s,n,r;const o=t[e];i[e]=o?Object.assign(Object.assign({},"s"===e?this.convertLayoutStickyConfig(t):this.convertScannedSpot(o)),{viewabilityOptimizationBlocklist:(null===(s=o.api)||void 0===s?void 0:s.vob)||[],positionIds:null===(n=o.api)||void 0===n?void 0:n.ids,targetElementPosition:t.atep||"INSIDE",style:null===(r=o.st)||void 0===r?void 0:r.b}):{targetElementPosition:"INSIDE"}})),i}static convertLayoutLazyConfig(t,i){if(!t.ll)return;const e={avgFetchTime:t.ll.aft,approvalCount:t.ll.ac,staticUser:t.ll.su,threshold:t.ll.t,recalculateThreshold:t.ll.rct,bucketsConfigured:t.ll.llb};return t.ll.m||(e.autoThreshold=t.ll.d),e}static isObject(t){return t&&"object"==typeof t&&!Array.isArray(t)}static mergeDeep(t,i){if(this.isObject(t)&&this.isObject(i))for(const e in i)!i.hasOwnProperty(e)||!this.isObject(i[e])||i[e]instanceof Node?Object.assign(t,{[e]:i[e]}):(t[e]||Object.assign(t,{[e]:{}}),this.mergeDeep(t[e],i[e]));return t}static getDebugConfig(){const t=sessionStorage.getItem("__brwsidbg");let i={};return t&&(i=JSON.parse(t)),i}static getDcsState(t){return{count:t.c,mainContentElement:t.mc,stayAwayObjects:t.sao,articleSelectors:t.as,prevPvSpots:t.pps,parentPageView:t.ppv}}}i.Profiler=h},7559:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(4436),r=e(5540),o=e(6389),h=e(2641),a=e(2797),l=e(4524);class c{constructor(t){this.googletag=this.initGoogletag(),this.apstag=window.apstag,this.pubAdsData=[],this.logger=new s.default("PubadsRefresh"),this.config=t,this.pbjsInstanceName=this.config.customPbjsName||"pbjs",this.pbjsInstance=c.getPbjs(this.pbjsInstanceName),this.vendor=o.Profiler.get().usingMagnite?"magnite":"prebid"}static get(){if(c.instance)return c.instance;const t=this.getPubAdsRefreshConfig();return t&&(c.instance=new c(t))}static getPubAdsRefreshConfig(){let t;return t=o.Profiler.get().customRefresh?this.getCustomRefreshConfig():o.Profiler.get().usingMagnite?this.getMagniteConfig():o.Profiler.get().pubAdsRefresh,t}static getCustomRefreshConfig(){var t;return{active:!0,adIdType:"AD_UNIT",adIds:[],refreshCount:100,refreshRate:3e4,dfpOnly:!1,sendRefreshKV:!0,customPbjsName:(null===(t=o.Profiler.get().prebidData)||void 0===t?void 0:t.globalInstanceName)||"pbjs"}}static getMagniteConfig(){var t,i,e,s,n,r,h,a;const l=(null===(t=o.Profiler.get().prebidData)||void 0===t?void 0:t.globalInstanceName)||"pbjs",d=null===(i=c.getPbjs(l))||void 0===i?void 0:i.getConfig(),u=null===(s=null===(e=null==d?void 0:d.realTimeData)||void 0===e?void 0:e.dataProviders)||void 0===s?void 0:s.find((t=>"browsi"===t.name)),f=null===(r=null===(n=null==u?void 0:u.params)||void 0===n?void 0:n.rp)||void 0===r?void 0:r.nonBrowsiAds,v=this.getMagniteAdIds(f).concat((null===(h=o.Profiler.get().manualDfpIframeAds)||void 0===h?void 0:h.adUnits)||[]),{refreshRate:p}=f||{};if(v.length>0&&p){return{active:!0,adIdType:"AD_UNIT",adIds:v,refreshCount:(null===(a=o.Profiler.get().pubAdsRefresh)||void 0===a?void 0:a.refreshCount)||100,refreshRate:p,dfpOnly:!1,sendRefreshKV:!0,customPbjsName:l}}return null}static getMagniteAdIds(t){var i;let e=new Set;return null===(i=null==t?void 0:t.placements)||void 0===i||i.forEach((t=>{this.findMatchedSlots(t).forEach((t=>{e.add(t)}))})),Array.from(e)}static findMatchedSlots(t){var i,e;let s=[];const n=null===(e=null===(i=window.googletag)||void 0===i?void 0:i.pubads)||void 0===e?void 0:e.call(i).getSlots();return null==n||n.forEach((i=>{const e=i.getSlotElementId(),n=i.getAdUnitPath();this.isMatchAdUnitPattern(t,e,n)&&s.push(n)})),s}findMatchAd(t,i,e){if("magnite"===this.vendor){if(this.pbjsInstance&&this.pbjsInstance.rp){this.pbjsInstance.rp.adUnitPatterns.find((e=>c.isMatchAdUnitPattern(e,i,t)))?e.isValidMagnite=!0:this.logger.info("Couldn't find valid magnite match")}}else this.pbjsInstance&&this.pbjsInstance.adUnits&&(e.adUnit=this.pbjsInstance.adUnits.find((e=>[t,i].includes(e.code))))}static isMatchAdUnitPattern(t,i,e){return!(t.divPattern&&!i.match(t.divPattern)||t.slotPattern&&!e.match(t.slotPattern))}preparePubadsRefresh(t,i,e){e&&!e.refreshInfo.requested&&this.isAllowedLineItemId(t).then((()=>{this.runPreRefresh(t,e).then((()=>{if(e.refreshInfo.requested=!0,this.logger.info("preparing refresh for adData",e),!e.manualIframeWindow&&(this.pbjsInstance=c.getPbjs(this.pbjsInstanceName),!this.config.dfpOnly&&this.pbjsInstance)){const i=t.getAdUnitPath(),s=t.getSlotElementId();this.findMatchAd(i,s,e)}this.refreshBid(e,i)}))})).catch((t=>{this.logger.error("pubadsRefresh rejected slot refresh:",t),"liIdBl"===t&&(e.refreshInfo.active=!1,n.default.get().sendPubAdRefreshBlockedEvent(e.element,t))}))}runPreRefresh(t,i){return new Promise(((e,s)=>{const n=l.default.getExternalFlowHandler("prePubadsRefresh");if(n){t.getSlotElementId(),i.refreshInfo.count;n(t,i,e,s)}else e()}))}refreshBid(t,i){if(!t.slot||!t.element)return!1;const e=this.getAdSize(t.element);this.attachSizeMapping(e,t.slot),this.handleKVs(t),t.refreshInfo.count++,this.sendRefreshRequestEvent(t,i),t.refreshInfo.viewedTime=Date.now();const s=this.getGoogleTag(t.manualIframeWindow);return s.cmd=this.googletag.cmd||[],s.cmd.push((()=>{const i=this.createHbPromise(t,e),n=this.createAmazonPromise(t.slot,e,t.manualIframeWindow);Promise.all([i,n]).then((i=>{this.logger.info(`refreshing dfp ${i}`),t.slot.setCollapseEmptyDiv(!1),s.pubads().refresh([t.slot])}))})),!0}handleKVs(t){const i=this.getTargeting(t.slot);t.slot.clearTargeting(),Object.keys(i).forEach((e=>{e.indexOf("hb_")+e.indexOf("amzn")===-2&&t.slot&&t.slot.setTargeting(e,i[e])})),this.config.sendRefreshKV&&t.slot.setTargeting("browsiRefresh","pubtrue");const e=o.Profiler.get().supplyConfigId;t.slot.setTargeting("browsiLayout",e)}createHbPromise(t,i){const e=i=>!(!i||!t.adUnit&&!t.isValidMagnite||this.config.dfpOnly);return new Promise((s=>{const n=c.getPbjs(this.pbjsInstanceName,t.manualIframeWindow);e(n)?(n.que=n.que||[],n.que.push((()=>{"magnite"==this.vendor?n.rp?n.rp.requestBids({callback:()=>{s("magnite")},gptSlotObjects:[t.slot]}):s():(this.setAdUnitSizes(t.adUnit,i),n.requestBids({adUnitCodes:[t.adUnit.code],bidsBackHandler:()=>{t.slot&&(n.setTargetingForGPTAsync([t.adUnit.code]),s("pbjs"))}}))}))):s()}))}createAmazonPromise(t,i,e){return new Promise((s=>{const n=this.getApsTag(e);if(!n||"function"!=typeof n.fetchBids||this.config.dfpOnly)return s();{const e=t.getSlotElementId(),r={slotID:e,slotName:t.getAdUnitPath(),sizes:[[i.w,i.h]]};n.fetchBids({slots:[r]},(t=>{const i=t.find((t=>t.slotID===e));return this.logger.info("amazon bid: ",i),this.logger.apsLog(i),this.apstag.setDisplayBids(),s("amazon")}))}}))}handleRenderEnded(t){const i=this.findExistingAdData(t.slot);if(i)if(t.isEmpty)this.logger.info("refresh for adData:",i,"returned empty. disabling refresh for this slot."),i.refreshInfo.active=!1;else{if(i.refreshInfo.requested)return this.logger.info("refresh for adData:",i,"ended successfully"),i.refreshInfo.requested=!1,!0;this.logger.info("adData:",i,"was forced refresh. disabling refresh for this slot."),i.refreshInfo.active=!1}return!1}sendRefreshRequestEvent(t,i){const e=this.getSlotWinner(t.slot);n.default.get().sendPubAdRefreshRequest(i,t.refreshInfo.count,"browsi",e)}findExistingAdData(t){return this.pubAdsData.find((i=>i.slot===t))}createAdData(t,i,e){const s={slot:t,element:i,refreshInfo:{active:!0,requested:!1,count:0,viewedTime:Date.now()},manualIframeWindow:e};return this.pubAdsData.push(s),s}getAdData(t,i,e){if(!i)return null;let s=this.findExistingAdData(i);return this.checkConditions(i,s)?(s||(s=this.createAdData(i,t,e)),s):null}checkConditions(t,i){if(i&&!i.refreshInfo.active)return!1;const e=[];l.default.isCustomRefreshConfigured()||!this.isWhitelisted(t)&&e.push("not in whitelist");const s=this.checkRefreshCount(i);s&&e.push(s),i&&i.refreshInfo.count===this.config.refreshCount&&e.push(`refresh count ${i.refreshInfo.count} passed limit ${this.config.refreshCount}`);const n=!e.length;return this.logger.info("checkConditions for",t.getSlotElementId(),"result ? ",n||e),n}checkRefreshCount(t){if(t&&t.refreshInfo.count===this.config.refreshCount)return`refresh count ${t.refreshInfo.count} passed limit ${this.config.refreshCount}`}isWhitelisted(t){if(this.config.adIds.includes("*"))return!0;switch(this.config.adIdType){case"AD_UNIT":const i=t.getAdUnitPath();return this.config.adIds.includes(i);case"PLACEMENT":const e=t.getSlotElementId();return this.config.adIds.includes(e);case"MACRO":const s=h.default.get().getFoundPublisherAdData(a.ProviderType.DFP,t.getSlotElementId(),0,t);if(s&&s.plid)return this.config.adIds.includes(s.plid)}return!1}getAdSize(t){let i=r.default.kt(t);return i||(i={size:r.default.ut(t),element:t}),i.size}setAdUnitSizes(t,i){t.mediaTypes.banner.sizes=[[i.w,i.h]],t.sizes&&(t.sizes=[i.w,i.h])}attachSizeMapping(t,i){const e=googletag.sizeMapping().addSize([0,0],r.default._i(t)?["fluid"]:[t.w,t.h]).build();i.defineSizeMapping(e),this.logger.info("attachedSizeMapping",e)}initGoogletag(){const t=window.googletag||(window.googletag={});return t.cmd=t.cmd||[],t}getTargeting(t){return t.getTargetingMap?t.getTargetingMap():t.getTargeting()}static getPbjs(t,i=window){return i[t]}getGoogleTag(t){return t?t.googletag:this.googletag}getApsTag(t){return t?t.apstag:this.apstag}getSlotWinner(t){const i=t.getHtml();return i.indexOf("renderAd")>-1?"prebid":i.indexOf("renderImp")>-1?"amazon":"dfp"}isAllowedLineItemId(t){const i=o.Profiler.get();if(i.blockLineItemIds){const e=r.default.getGAMResponseInfo(t);if(!e)return Promise.resolve();const s={sk:i.siteKey,dt:"mobile"};(null==e?void 0:e.lid)&&(s.li=null==e?void 0:e.lid),(null==e?void 0:e.oid)&&(s.oi=null==e?void 0:e.oid);const n=`//${i.yieldHostname}/bli?${r.default.ni(s)}`;return r.default.xhrPromise(n,"GET").then((t=>202===t.status?Promise.reject("liIdBl"):Promise.resolve()))}return Promise.resolve()}}i.default=c},2338:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661);i.default=class{constructor(t){this.resizeRAF=null,this.resizeListeners=[],this.resizeElement=t,this.obj=document.createElement("object"),this.logger=new s.default("ResizeListener"),this.logger.verbose("set resize listener for",t)}resizeListener(){this.resizeRAF&&window.cancelAnimationFrame(this.resizeRAF),this.resizeRAF=window.requestAnimationFrame((()=>{this.resizeListeners.forEach((t=>{t.call(this.obj)}))}))}objectLoad(){this.obj.contentDocument.defaultView.addEventListener("resize",this.resizeListener.bind(this)),this.resizeListener.bind(this)()}addResizeListener(t){this.resizeListeners.length||("static"==getComputedStyle(this.resizeElement).position&&(this.resizeElement.style.position="relative"),this.obj.setAttribute("style","display: block; position: absolute; top: 0; left: 0; height: 100%; width: 100%; overflow: hidden; pointer-events: none; z-index: -999;"),this.obj.onload=this.objectLoad.bind(this),this.obj.type="text/html",this.obj.data="about:blank",this.resizeElement.appendChild(this.obj)),this.resizeListeners.push(t)}removeResizeListener(t){var i,e;t?this.resizeListeners.splice(this.resizeListeners.indexOf(t),1):this.resizeListeners=[];const s=null===(e=null===(i=this.obj)||void 0===i?void 0:i.contentDocument)||void 0===e?void 0:e.defaultView;!this.resizeListeners.length&&s&&(s.removeEventListener("resize",this.resizeListener),this.resizeElement.removeChild(this.obj))}}},470:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5540),r=e(6448),o=e(5594),h=e(8814),a=e(6389),l=e(1675),c=e(1297),d=e(6032);class u{constructor(){this.stayAwayElements=[],this.profile=a.Profiler.get(),this.logger=new s.default("SAService"),this.domScanned=!1;const t=d.TAGS_TO_SCAN.map((t=>t.toLowerCase())),i=this.profile.scanningTags.map((t=>t.toLowerCase()))||[];this.typesToSaFrom=Array.from(new Set(["iframe","ins","center","footer","class","h2","aside","img","id","twitterwidget","video",...t,...i]))}static get(){return u.instance||(this.instance=new u),u.instance}isToStayAway(t){return t={ref:t},this.stayAwayElements.some((i=>null!==this.hasViolatedStayAway(t,i)))}getStayAwayElements(){return this.stayAwayElements}handleStayAwayConfig(t,i,e,s,n,r){if(!this.isValidHeightForSkipSa(t))return;const o=this.upsertStayAwayElement(t,e,s,n,r,i);null!=e.adProviderName&&o&&this.reportPublisherAd(o,e)}upsertStayAwayElement(t,i,e,s,r,o){if(!i.distance)return this.logger.verbose("Received distance is 0, not adding element: ",t," to Stay Aways"),null;let h=this.stayAwayElements.find((i=>i.element===t));if(h)this.updateSAElement(h,t,s,i,e,r);else{if(!(i.adProviderName&&n.default.ut(t).h<=25)){const n=this.insertSaElement(t,i,e,s,r,o);return this.logSaAdded(i,e,n),n}this.logger.verbose("ignoring sa ad element, height <= 25",t)}return null}insertSaElement(t,i,e,s,o,h){const a=t.getBoundingClientRect();o||(o=r.default.instance.getAdPositionType(t,a.height,a.top));const l={element:t,top:n.default.getSAPositionFromTop(t),height:a.height,stayAwayDistance:i.distance,toDensity:i.toDensity,positionType:o,isLazy:e,subType:s,isValid:u.isSaValid(t),selector:h};return this.stayAwayElements.push(l),l}updateSAElement(t,i,e,s,r,o){const h=Object.assign({},t);t.top=n.default.getSAPositionFromTop(i),t.height=i.getBoundingClientRect().height,t.isValid=u.isSaValid(i),h.top===t.top&&h.height===t.height&&i.style.display===t.element.style.display||this.logger.verbose("Updated: ",h," TO: ",t)}logSaAdded(t,i,e){const s=[i?"Lazy ":"","Added",e];void 0!==t.values&&s.push("By Config: ",Object.assign(Object.assign({},t),e.selector?{values:[e.selector]}:{})),this.logger.verbose(...s)}isAdType(t){return"provider"===t||"content_recommendation"===t}resetStayAwayElements(){this.stayAwayElements=this.stayAwayElements.filter((t=>{if(!document.body.contains(t.element))return!t.element}))}scanDomForSA(t=!1){const i=u.getElementToScanFrom();if(t)this.domScanned=!0,this.logger.verbose("Re-scanning dom for SA");else if(this.logger.verbose("Start scanning dom for SA"),(l.default.hasDcsMc()||l.default.isSlides())&&l.default.getDcsActionCounter()>0){(l.default.getLatestDcsStayObjects()||[]).forEach((t=>{this.upsertStayAwayElement(t.element,{toDensity:t.toDensity,distance:t.stayAwayDistance},!1,t.subType,t.positionType)}))}const e=this.typesToSaFrom?this.typesToSaFrom.join(","):o.default.get().getScanningTagNames();this.logger.info("Staying away from these types: ",e);for(let s of this.profile.uxRules.stayAway)try{if(s.values.length)if("XPATH"===s.selectorType)for(let e of s.values){const r=n.default.Ni([e],i,!0);for(let i of r)this.handleStayAwayConfig(i,e,s,t,"configuration")}else if("CSS"===s.selectorType)for(let n of s.values){const r=Array.from(i.querySelectorAll(n)).filter((t=>!(!e.includes(t.tagName.toLowerCase())&&!e.includes(t.tagName))||(this.logger.verbose("Not sa - element is not in types to sa from",t),!1)));for(let i of r)this.handleStayAwayConfig(i,n,s,t,"configuration")}}catch(t){this.logger.error("Problem while adding SaConfig to SaElements",s,t)}}isStayAwayViolated(t){if(!this.profile.lazyStayAway)return null;this.scanForCR(t.ref),!t.isLazyLoading&&this.domScanned||this.scanDomForSA(!0);let i=null;return this.stayAwayElements.some((e=>{let s=this.hasViolatedStayAway(t,e);return null!=s&&(-1===s?this.logger.verbose("Spot: ",t.ref," has violated StayAway from: ",e.element,", because it's contained in the SA element"):this.logger.verbose("Spot: ",t.ref," has violated StayAway from: ",e.element,", Distance between objects is: ",s),i={distance:s,spot:t,saObject:e},!0)})),i}scanForCR(t){const i=this.profile.contentRecommendationStayAwayDistance;if(!i)return;const e={distance:i,toDensity:!1},s=u.getElementToScanFrom(),r=Array.from(s.querySelectorAll("div,ins")).concat(t).sort(((t,i)=>2&t.compareDocumentPosition(i)?1:-1)),o=r.indexOf(t),a=n.default.Z(t).y;for(let t=o+1;t<r.length&&!this.isTooFar(r[t],a,i);t++)h.default.get().isVendorNode(r[t])&&u.get().upsertStayAwayElement(r[t],e,!0,"content_recommendation");for(let t=o-1;t>=0&&!this.isTooFar(r[t],a,i);t--)h.default.get().isVendorNode(r[t])&&u.get().upsertStayAwayElement(r[t],e,!0,"content_recommendation")}isTooFar(t,i,e){return!n.default.isFixed(t)&&n.default.Pi(t)&&Math.abs(n.default.yt(t)-i)>e}hasViolatedStayAway(t,i){if(null==t.ref||n.default.isFixed(i.element).status||!window.document.body.contains(i.element))return null;let e=this.getSaDistance(t.ref,i);return e<i.stayAwayDistance?e:null}static isSaValid(t){return n.default.$t(t,!0)&&!n.default.isFixed(t).status}reportPublisherAd(t,i){this.logger.verbose("Found manual ad: ",t.element);const e=t.element.id||t.selector||"";o.default.get().addIfNew(t.element,i.adProviderName,i.distance,e,e,t.isLazy,void 0,{w:t.element.offsetWidth,h:t.height},!0)}static getElementToScanFrom(){return l.default.hasDcsMc()||l.default.isSlides()?l.default.getCurrentDcsElement():document.body}getSaDistance(t,i){let e=Math.abs(n.default.getSAPositionFromTop(t)-n.default.getSAPositionFromTop(i.element));if(n.default.isPositionedBefore(i.element,t)){e-=i.height>=c.MIN_AD_SIZE?i.height:n.default.ut(i.element).h}return e}isValidHeightForSkipSa(t){const i=n.default.q();return n.default.ut(t).h<.8*i}}i.default=u},2478:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5690),r=e(4436),o=e(8562),h=e(5540),a=e(5684),l=e(3486),c=e(5353),d=e(83);class u{static get logger(){return this._logger||(this._logger=new s.default("SpotEngine Flow Service")),this._logger}static run(t,i,e,s,r){const o=!!(null==r?void 0:r.isDcs)||!!i.dcsState;let a=[];try{t.startSpotEngine(r),a=d.default.getSpots()}catch(t){i.debug&&u.logger.error(t)}e&&u.sendPageViewReport(a,i,!1,o);const f=i.fixedSpotsFirst?a.filter((t=>!l.default.isFixedSpot(t.tags))):a,v=h.default.Li(f);f.length&&s&&!i.analysisMode&&n.YieldClient.get().Ze(f.filter((t=>t.type!==c.SpotType.STICKY&&t.type!==c.SpotType.API))),this.shouldStopSpotEngine(v,i)&&t.onStopEngine()}static shouldStopSpotEngine(t,i){return!t.length||i.analysisMode||o.default.instance.isHidden||t.length&&this.eagerSpotsShouldWaitForEngaged(t)&&!h.default.userEngaged}static eagerSpotsShouldWaitForEngaged(t){return t.some(h.default.ei)}static sendPageViewReport(t,i,e,s){i.debug&&a.Output.setBrowsiOutput("page_view");const n=l.default.getFixedTotalMaxItems(),o=l.default.getMaxItems({typeTag:"dy",positionTag:"in"});r.default.get().sendPageviewEvent(o,n,s)}}i.default=u},549:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5353),n=e(6389),r=e(5540),o=e(4524);i.FIXED_TYPES=[s.SpotType.FIXED_IN_CONTENT,s.SpotType.FIXED_TOP,s.SpotType.FIXED_BOTTOM],i.FIXED_TAGS=[{typeTag:"fi",positionTag:"in"},{typeTag:"fi",positionTag:"t"},{typeTag:"fi",positionTag:"b"}],i.SPOT_TAGS_MAP={[s.SpotType.FIXED_IN_CONTENT]:{oldType:s.SpotType.FIXED_IN_CONTENT,typeTag:"fi",positionTag:"in"},[s.SpotType.FIXED_TOP]:{oldType:s.SpotType.FIXED_TOP,typeTag:"fi",positionTag:"t"},[s.SpotType.FIXED_BOTTOM]:{oldType:s.SpotType.FIXED_BOTTOM,typeTag:"fi",positionTag:"b"},[s.SpotType.DYNAMIC]:{oldType:s.SpotType.DYNAMIC,typeTag:"dy",positionTag:"in"},[s.SpotType.STICKY]:{oldType:s.SpotType.STICKY,typeTag:"st",positionTag:"s"}};class h{static getGeneralLazyConfig(){return n.Profiler.get().spotsSupplyParams.lazySpots}static getSizes(t){var i;return(null===(i=h.getConf(t))||void 0===i?void 0:i.allowedCreativeSizes)||[]}static validateStickySizes(t){return t.filter((t=>r.default.isValidStickySize(t)))}static getDynamicMaxItems(){var t;return(null===(t=n.Profiler.get().spotsSupplyParams.dynamic)||void 0===t?void 0:t.maxItems)||0}static getFixedMaxItems(t){var i;return(null===(i=h.getConf(t))||void 0===i?void 0:i.maxItems)||-1}static getConf(t){switch(t.typeTag){case"fi":switch(t.positionTag){case"in":return n.Profiler.get().spotsSupplyParams.fixed;case"t":return n.Profiler.get().spotsSupplyParams.fixedTop;case"b":return n.Profiler.get().spotsSupplyParams.fixedBottom;default:return}case"dy":return n.Profiler.get().spotsSupplyParams.dynamic;case"api":const i=n.Profiler.get().spotsSupplyParams.api;return i&&i[t.positionTag];case"st":return n.Profiler.get().spotsSupplyParams.sticky}}static getLazyConf(t){var i;return null===(i=this.getConf(t))||void 0===i?void 0:i.lazyLoading}static getLazyBucketsConf(t){var i;return null===(i=this.getConf(t))||void 0===i?void 0:i.lazyLoadingBuckets}static getViewabilityThreshold(t){var i;return null===(i=this.getConf(t))||void 0===i?void 0:i.viewabilityThreshold}static shouldLazyLoad(t){return t.optimizeViewability&&o.default.getLazySpotsInstance().isLazy(t)}static getTargetElementPosition(t){var i;return(null===(i=h.getConf(t))||void 0===i?void 0:i.targetElementPosition)||"ABOVE"}static convertTagsToType(t){switch(t.typeTag){case"dy":return s.SpotType.DYNAMIC;case"api":return s.SpotType.API;case"st":return s.SpotType.STICKY;case"fi":switch(t.positionTag){case"in":return s.SpotType.FIXED_IN_CONTENT;case"t":return s.SpotType.FIXED_TOP;case"b":return s.SpotType.FIXED_BOTTOM}default:return s.SpotType.DYNAMIC}}static sortBySpotIndex(t){return t.sort(((t,i)=>t.spotIndex-i.spotIndex))}}i.SpotsUtils=h},9147:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(9150),n=e(5540),r=e(1511),o=e(2797);class h extends s.Embedder{constructor(t){super(t)}us(t,i){return new Promise(((e,s)=>{if(t.ref&&t.ref.parentNode){let s;r.InframeManager.get().isProviderInframe(t)&&(s=r.InframeManager.get().getSpotContainers(t.spotIndex));const n=this.runChangeEmbedderContainersHook(t)||s,o=this.Ys((null==n?void 0:n.adWrapper)||document.createElement("div"),t.type,t.typeIndex),h=this.Qs((null==n?void 0:n.adContainer)||document.createElement("div")),a=this.Zs(t,i,o),l=i?"block":"none";(null==n?void 0:n.adContainer)||o.appendChild(h),o.setAttribute("style","text-align: center;"),this.runProcessSpotHook(t,o),h.setAttribute("style",this.tn(t,l));const c=this.en(t,window,o,a,h,null);this.sn(t,o,!!n),o.setAttribute("style",this.rn(t,l)),t.on(c),e(c)}else s()}))}hn(t,i=!1){var e;if(t.placeholder&&(t.placeholder.removePlaceholderStyle(t.newBrowsiAd),(null===(e=t.newBrowsiAd)||void 0===e?void 0:e.adContainer)&&(t.newBrowsiAd.adContainer.style.minHeight=this.getMinHeight(t),t.placeholder.size&&t.implementedSize&&t.placeholder.size.h>t.implementedSize.h&&(t.newBrowsiAd.adContainer.style.display="flex",t.newBrowsiAd.adContainer.style.justifyContent="center",t.newBrowsiAd.adContainer.style.alignItems="center"))),t.providerName===o.ProviderType.GENERIC_JS)return;const{width:s,height:r}=this.an(t,i);if(i||n.default.hi(`#${t.newBrowsiAd&&t.newBrowsiAd.adContainer.id} iframe`,`height:${r} !important;width: ${s} !important;`),n.default.hi(`#${t.newBrowsiAd&&t.newBrowsiAd.adContainer.id} *`,"text-align:center !important;"),t.isFluid&&t.browsiAd){const i=t.browsiAd.getBoundingClientRect();t.bs({w:i.width,h:i.height})}}}i.default=h},9150:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(6389),r=e(2661),o=e(5353),h=e(4141),a=e(1675),l=e(4524),c=e(83),d=e(549),u=e(4436),f=e(2797);class v{constructor(t){this.profile=n.Profiler.get();const i=a.default.getDcsActionCounter();this.spotIdentifier=`${t.spotIndex}_ai_${t.Ki?t.Ki:1}_rc_${t.refresh?t.refresh.count:0}${i&&i>0?`_dcs_${i}`:""}`,this.logger=new r.default("Embedder")}static Ps(t){var i;return!!t.newBrowsiAd&&(s.default.ci(t.newBrowsiAd.adWrapper),v.Je(t.newBrowsiAd.adWrapper),null===(i=t.placeholder)||void 0===i||i.stopObserving(),!0)}re(t){const i=t.newBrowsiAd;i&&s.default.injectMoat(i.iframe||i.adWrapper,i.isIframe)}runProcessSpotHook(t,i){const e=l.default.getExternalFlowHandler("processSpotBeforeAddingToDOM");e&&(t.containerElement={children:[i]},e(t,t.spotIndex))}sn(t,i,e){var s;if(t.isRefreshing()||v.Ps(t),!e)if(t.type===o.SpotType.STICKY){const e=window.document.body;(null===(s=d.SpotsUtils.getConf(t.tags))||void 0===s?void 0:s.location)===h.Location.TOP?e.prepend(i):e.appendChild(i)}else switch(t.targetElementPosition){case"ABOVE":t.ref.insertAdjacentElement("beforebegin",i);break;case"INSIDE":t.ref.insertAdjacentElement("afterbegin",i)}t.relocationPlid&&i.setAttribute("relocatedId",t.relocationPlid)}Ys(t,i,e){return t.id=`browsi_wrapper_${this.spotIdentifier}`,t.setAttribute("spotType",i),t.setAttribute("typeIndex",""+e),t}Qs(t){return t.id=`browsi_ad_${this.spotIdentifier}`,t}ln(){const t=document.createElement("iframe");return t.id=`browsi_ad_${this.spotIdentifier}`,t.scrolling="no",t.frameBorder="0",t.marginHeight="0",t.marginWidth="0",t.height="0",t.width="0",t.style.display="none",t}en(t,i,e,n,r,o){return s.default.dispatchDOMEvent("ban",e,i),{win:i,adWrapper:e,adMarking:n,adContainer:r,iframe:o,isIframe:null!==o,display:i=>this.hn(t,!!i)}}Zs(t,i,e){if(!this.profile.admarking||!this.profile.admarking.active)return null;this.setGeneralMarkingStyle();const s=document.createElement("div");s.innerText=this.profile.admarking.text?this.profile.admarking.text:"ADVERTISEMENT",s.id=`browsi_admarking_${t.spotIndex}`,s.setAttribute("class","browsi_admarking");const n=t.providerName===f.ProviderType.GENERIC_JS||!i;s.setAttribute("style","display:"+(n?"none":"block"));const r=l.default.getExternalFlowHandler("adMarkingHandler"),h=(t,i)=>{i.prepend(t)};return r?r(s,e,h,t):t.type!==o.SpotType.STICKY?(h(s,e),s):null}setGeneralMarkingStyle(){if(c.default.getSpots().filter((t=>t.browsiAd)).length<=1){const t=this.dn();s.default.hi(".browsi_admarking",t)}}dn(){const t=`height: 32px !important;\nwidth: 100% !important;\npadding: 0 !important;\nfont-family: Arial, sans-serif !important;\nmargin: auto !important;\ntext-align: center !important;\nline-height: 32px !important;\nfont-weight: normal !important;\ncolor: ${this.profile.admarking.color?this.profile.admarking.color:"#9f9f9f"} !important;\nfont-size: 11px !important;`;return this.profile.admarking.customStyle?this.profile.admarking.customStyle:t}static he(t){const i=t.newBrowsiAd;i&&i.adWrapper&&-1==this.browsiAdsOnPage.indexOf(i.adWrapper)&&this.browsiAdsOnPage.push(i.adWrapper)}static Je(t){const i=this.browsiAdsOnPage.indexOf(t);i>-1&&this.browsiAdsOnPage.splice(i,1),s.default.dispatchDOMEvent("bar",t,window)}static Ks(){return this.browsiAdsOnPage}an(t,i){const e=t.implementedSize,s=t.isFluid||i?"auto":`${e&&e.h}px`;return{width:t.isFluid||i?"auto":`${e&&e.w}px`,height:s}}rn(t,i){var e,s,n;const r=d.SpotsUtils.getConf(t.tags);let h="margin: 0 auto;text-align: center;margin-top:16px;margin-bottom: 16px;clear: both !important;";if(i&&!(null===(e=t.placeholder)||void 0===e?void 0:e.active)&&(h+=`display:${i};`),t.type===o.SpotType.STICKY){h+=`position:fixed!important;${(null===(s=r)||void 0===s?void 0:s.location.toLowerCase())||"bottom"}: 0 !important; left: 50%; transform: translateX(-50%); margin:0 auto !important; z-index:9999;`}return(null===(n=null==r?void 0:r.style)||void 0===n?void 0:n.w)&&(h+=r.style.w),h}tn(t,i){var e;let s="margin: 0 auto;text-align: center;margin-top:16px;margin-bottom: 16px;clear: both !important;";i&&(s+=`display:${i};`),t.type===o.SpotType.STICKY&&(s+="margin:0 !important;");const n=d.SpotsUtils.getConf(t.tags);return(null===(e=null==n?void 0:n.style)||void 0===e?void 0:e.c)&&(s+=n.style.c),s}se(t,i){var e;const n=d.SpotsUtils.getConf(t.tags);if(i&&(null==n?void 0:n.closeButton)){const r=document.createElement("c-button");r.id=`close-sticky-${this.spotIdentifier}`,r.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 30 30"><defs><style>.a{fill:#fff;stroke:#707070;}.b{stroke:none;}.c{fill:none;}</style></defs><g transform="translate(-1429 -929)"><g class="a" transform="translate(1429 929)"><circle class="b" cx="15" cy="15" r="15"/><circle class="c" cx="15" cy="15" r="14.5"/></g><path d="M20.518,6.563,18.955,5l-6.2,6.2L6.563,5,5,6.563l6.2,6.2L5,18.955l1.563,1.563,6.2-6.2,6.2,6.2,1.563-1.563-6.2-6.2Z" transform="translate(1430.975 930.975)"/></g></svg>',r.setAttribute("style","position: absolute;width: 24px;height: 24px;border:none; background:none;padding:0;cursor:pointer");const o=n.location,a=(null===(e=t.implementedSize)||void 0===e?void 0:e.w)||s.default.X();r.style.right=s.default.X()<=a?"0px":"-12px",r.style[o===h.Location.BOTTOM?"top":"bottom"]="-12px",r.onclick=()=>{t.isRefreshing()||(c.default.removeStickyAd(t),u.default.get().sendStickyClosedEvent(t))},i.appendChild(r)}}runChangeEmbedderContainersHook(t){const i=l.default.getExternalFlowHandler("changeEmbedderContainers");return i?i(t):null}getMinHeight(t){var i,e,n,r,h;let a="";if(t.type!==o.SpotType.STICKY&&t.newBrowsiAd&&t.placeholder&&s.default.isChangingViewport(t.newBrowsiAd.adWrapper))if(t.placeholder.active)a=t.placeholder.size.h?t.placeholder.size.h+"px":"";else{const s=(null===(n=null===(e=null===(i=t.refresh)||void 0===i?void 0:i.oldBrowsiAd)||void 0===e?void 0:e.iframe)||void 0===n?void 0:n.style.minHeight)||(null===(h=null===(r=t.refresh)||void 0===r?void 0:r.oldBrowsiAd)||void 0===h?void 0:h.adContainer.style.minHeight);a=s||""}return a}}i.Embedder=v,v.browsiAdsOnPage=[]},208:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4009),n=e(9147),r=e(2797);i.EmbeddingFactory=class{static getEmbedder(t,i){var e;switch(t.rt){case r.ProviderType.HEADER_BIDDING:return t.c.if?new s.default(i):new n.default(i);case"empty_api":return new n.default(i);case"provider":const o=t;if(null===(e=o.c.a)||void 0===e?void 0:e.template)return this.inIframe(o)?new s.default(i):new n.default(i);switch(o.c.p){case r.ProviderType.DFP:case r.ProviderType.GENERIC_JS:return this.inIframe(o)?new s.default(i):new n.default(i);default:return null}default:return null}}static inIframe(t){return"true"===t.c.a.inIFrame}}},4009:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(9150),n=e(5540),r=e(2338);class o extends s.Embedder{constructor(t){super(t)}us(t,i){return new Promise(((e,s)=>{var n,r;if(t.ref&&t.ref.parentNode){const s=this.Ys(document.createElement("div"),t.type,t.typeIndex),o=this.ln(),h=this.Qs(document.createElement("div")),a=this.Zs(t,i,s),l=i?"block":"none";this.setIframePlaceholderStyle(o,t);const c=null===(r=null===(n=t.refresh)||void 0===n?void 0:n.oldBrowsiAd)||void 0===r?void 0:r.adContainer.style.minHeight;c&&(o.style.minHeight=c),s.appendChild(o),this.runProcessSpotHook(t,s),o.onload=()=>{o.contentDocument.open(),o.contentDocument.close(),o.contentDocument.body.appendChild(h),o.contentWindow.__cmp=window.__cmp,o.contentWindow.__tcfapi=window.__tcfapi;const i=this.en(t,o.contentWindow,s,a,h,o);h.setAttribute("style","text-align: center;"),t.on(i),i.adWrapper.setAttribute("style",this.rn(t,l)),e(i)},this.sn(t,s,!1)}}))}hn(t,i=!1){var e,s,r;null===(e=t.placeholder)||void 0===e||e.removePlaceholderStyle(t.newBrowsiAd);const{width:o,height:h}=this.an(t,!1);if(t.newBrowsiAd){if(t.newBrowsiAd.iframe){if(t.newBrowsiAd.iframe.style.display="block",t.isFluid||(null===(s=this.profile.uxFixes)||void 0===s?void 0:s.dynamicIframeSize))return this.setImplementedIframeSize(t.newBrowsiAd.iframe,t.implementedSize),void this.watchDynamicIframeSize(t.newBrowsiAd.iframe,t);let i=`text-align:center;display: block;margin: auto;width:${o} !important; height:${h} !important;`;const e=this.getMinHeight(t);t.newBrowsiAd.adContainer.style.minHeight=e,i+=e?`min-height:${e};`:"",(null===(r=t.placeholder)||void 0===r?void 0:r.size)&&t.implementedSize&&t.placeholder.size.h>t.implementedSize.h&&(t.newBrowsiAd.adContainer.style.display="flex",t.newBrowsiAd.adContainer.style.justifyContent="center",t.newBrowsiAd.adContainer.style.alignItems="center"),t.newBrowsiAd.iframe.setAttribute("style",i)}n.default.hi(`#${t.newBrowsiAd.adContainer.id} iframe`,`height:${h};width: ${o} !important;`)}}setImplementedIframeSize(t,i){i&&t&&(t.width=i.w.toString(),t.height=i.h.toString())}watchDynamicIframeSize(t,i){var e;const s=null===(e=t.contentWindow)||void 0===e?void 0:e.document.body;if(s){t.style.setProperty("width","100%","important");const i=new r.default(s);i.addResizeListener((()=>{const e=n.default.ut(s).h;t.setAttribute("style",`text-align:center;display: block;margin: auto; height:${e}px !important; width:100% !important`),setTimeout((()=>{i.removeResizeListener()}),2e3)}))}}setIframePlaceholderStyle(t,i){var e;if(!(null===(e=i.placeholder)||void 0===e?void 0:e.active))return;const s=i.un(i.sizes);t.width=""+s.w,t.height=""+s.h,t.style.display="block"}}i.default=o},5673:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.BROWSI_IMPRESSION_DOM_EVENT_NAME="browsiImpression"},9081:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.DEMAND="demand",t.SUPPLY="supply",t.PAGE_STRUCTURE="pagestructure",t.ENGAGEMENT="engagement",t.ANALYTIC="analytic",t.PREBID="prebid",t.HEADER_BIDDING="hb",t.ERROR="engineError",t.WEB_VITALS="web_vitals",t.INFRAME="inframe",t.REFRESH="refresh"}(i.EventTopic||(i.EventTopic={}))},7016:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.SPOT_FOUND="spot_found",t.AD_REQUEST="ad_request",t.AD_MATCHED="ad_matched",t.AD_IMPRESSION="ad_impression",t.MEASURABLE_IMPRESSION="measurable_impression",t.VIEWED_IMPRESSION="viewed_impression",t.VIEWED_IMPRESSION_AV="viewed_impression_av",t.VIEWED_IMPRESSION_100="v_100",t.FOUND_PUBLISHER_AD="found_publisher_ad",t.VIEWED_PUBLISHER_AD="viewed_publisher_ad",t.VIEWED_PUBLISHER_AD_AV="viewed_publisher_ad_av",t.PUB_AD_REFRESH_REQUEST="pub_ad_refresh_request",t.BID_REQUEST="bid_request",t.BID_MATCHED="bid_matched",t.BID_MATCHED_TIMEOUT="bid_matched_timeout",t.API_REQUEST_BLOCKED="api_request_blocked",t.AD_REQUEST_BLOCKED="ad_request_blocked",t.AD_IN_VIEWPORT="ad_in_viewport",t.PUB_AD_REFRESH_BLOCK="parb",t.STICKY_CLOSED="sticky_closed",t.PLACEHOLDER_VIEWED="placeholder_viewed",t.PLACEHOLDER_CLOSED="placeholder_closed",t.BILLABLE_EVENT="billable_event",t.ENGINE_LOADED="engine_loaded",t.PAGE_VIEW="page_view",t.DCS_GALLERY="dcs_gallery",t.DCS_ENDLESS="dcs_endlessScroll",t.DCS_ACCORDION="dcs_accordion",t.DCS_READMORE="dcs_readMore",t.DCS_SPA="dcs_spa",t.DCS_SLIDES="dcs_slides",t.DCS_MANUAL="dcs_manual",t.DCS_SCRIPT="dcs_script",t.FOCUS_CHANGED="focus_changed",t.USER_ENGAGED="user_engaged",t.NETWORK_INFO_FOUND="network_info_found",t.PAGE_STRUCTURE="page_structure",t.CRASH="crash",t.PREBID_ERROR="prebid_error",t.SCRIPT_LOAD_ERROR="script_load_error",t.CONFIGURATION_ERROR="configuration_error",t.XHR_ERROR="xhr_promise_error",t.GENERIC_ERROR="generic_error",t.GENERAL_ENGAGEMENT="general_engagement",t.SUMMARY="summary",t.USER_STATS="user_stats",t.GENERAL_DATA="general_data",t.FOUND_PUBLISHER_AD_BIDS="fpab",t.HBWinner="hbw",t.AMAZON_WINNER="amw",t.RESPONSE_TIMES="rt",t.WEB_VITALS="web_vitals",t.PLACEMENTS_SENT="placements",t.INFRAME_HAS_DEMAND="has_demand",t.CUSTOM_REFRESH_RATE_RULE="rule"}(i.EventType||(i.EventType={}))},6448:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5540),r=e(6797),o=e(6389),h=e(1675),a=e(549);class l{constructor(){this.logger=new s.default("MainContent"),this.commonStartTagNames="main,p,nav,img,h1,h2,header",this.commonEndTagNames="p,img,h2,h1,svg",this.excludeElements="footer, form",this.maxMCSize=1e5,this.scanStatus=4;const t=o.Profiler.get();this.debugMode=!!t.debug&&t.debug,this.draw=!!t.draw&&t.draw,this.mainContentConfig=t.mainContentConfig,this.mainContentOnly=!1,this.isAutoDetected=!1,this.commentSections=[],this.socialWidgets=[],this.mainContentConfig&&this.mainContentConfig.enabled&&(this.mainContentConfig.start||this.mainContentConfig.end)?this.logger.info("mainContent is using configuration data - start: ",this.mainContentConfig.start," end ",this.mainContentConfig.end):this.logger.info("no configuration found, mainContent will be detected automatically")}static get instance(){return this._instance||(this._instance=new l),this._instance}findMainContent(t,i,e,s){this.scanStatus=0,this.CR=i,this.commentSections=e,this.socialWidgets=s,this.start=this.calculateStartingElement(),this.startPosition=n.default.Z(this.start).y,this.end=this.calculateEndElement(),this.endPosition=n.default.Z(this.end).y,this.totalMCSize=this.calculateMCSize(!0),this.logMainContent();const r=a.SpotsUtils.getConf({typeTag:"dy",positionTag:"in"});this.mainContentOnly=(null==r?void 0:r.mainContentOnly)&&!this.isAutoDetected&&this.isMCAtLeastOneFold()}logMainContent(){this.logger.verbose(`Start Element at offsetTop ${this.startPosition}`,this.start),this.logger.verbose(`End Element at offsetTop ${this.endPosition}`,this.end),this.logger.verbose(`mc size: ${this.totalMCSize}`),this.drawMainContentBorder(this.start,this.end)}isMCAtLeastOneFold(){return this.calculateMCSize(!0)>=window.screen.height}calculateStartingElement(){const t=this.getDcsMcElement();return this.mainContentConfig&&this.mainContentConfig.enabled?(this.configStart=t,this.mainContentConfig.start.length>0&&(this.configStart=this.findConfigStartElement(this.mainContentConfig.start))):this.configStart=t,this.configStart?this.configStart:this.findStartingPoint()}calculateEndElement(){return this.mainContentConfig&&this.mainContentConfig.enabled?this.mainContentConfig.end.length>0&&(this.configEnd=this.findConfigEndElement(this.mainContentConfig.end)):this.configEnd=this.getDcsMcElement(),this.configEnd||this.findEndingPoint()}findConfigStartElement(t){let i=n.default.Ni(t);if(h.default.hasDcsMc()){const t=h.default.getCurrentDcsElement();i=i.filter((i=>i===t||n.default.isPositionContained(t,i)||n.default.isPositionedAfter(i,t)))}return 0===i.length&&(this.isAutoDetected=!0),this.upperMostElementOf(i)}findConfigEndElement(t){let i=n.default.Ni(t);return 0===i.length&&(this.isAutoDetected=!0),this.lowerMostElementOf(i)}findStartingPoint(){this.scanStatus=1;let t=this.getAllValidCandidates(this.commonStartTagNames),i=this.upperMostElementOf(t);return i||document.body}findEndingPoint(){this.scanStatus=1===this.scanStatus?3:2;let t=this.lowerMostElementOf(this.CR.filter((t=>t.data&&t.data.is_visible)).map((t=>t.node))),i=this.lowerMostElementOf(this.commentSections);this.logger.verbose("lowestCS: "+i+"; lowestCR: "+t);let e=this.upperMostElementOf([i,t].filter((t=>!!t))),s=this.getAllValidCandidates(this.commonEndTagNames);s=s.concat(this.socialWidgets),s=this.sortByDomLocation(s),s=this.removeAllElementsAfter(e,s);let n=this.getExcludedElements();return s=this.excludeElementsAndTheirChildren(s,n),s&&s.length?s[s.length-1]:this.start}getExcludedElements(){return Array.from(document.body.querySelectorAll(this.excludeElements)).filter((t=>{if("FORM"===t.nodeName){return t.getBoundingClientRect().height<=.8*document.body.getBoundingClientRect().height}return!0}))}getAllValidCandidates(t){let i=.8*n.default.L().width,e=[];return Array.from(document.body.querySelectorAll(t)).filter((t=>{if(n.default.N(e,t))return!1;let s=t.getBoundingClientRect();switch(t.nodeName){case"NAV":return!(n.default.isFixed(t).status||!t.hasChildNodes())&&(!n.default.qt(location.origin,t)||(e.push(t),!1));case"H1":case"H2":case"HEADER":return!(!n.default.Gt(t)||!s.height)&&(!(n.default.isFixed(t).status||!n.default.isFixed(t).status&&n.default.qt(location.origin,t))||(e.push(t),!1));case"MAIN":case"SVG":case"svg":return!n.default.isFixed(t).status&&s.height>i;case"P":return!n.default.isFixed(t).status&&n.default.Gt(t)&&s.height;case"IMG":return s.height&&s.width>i;default:return!1}}))}excludeElementsAndTheirChildren(t,i){return t.filter((t=>t&&!n.default.N(i,t)))}sortByDomLocation(t){return t.sort((function(t,i){return t===i?0:t.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_PRECEDING?1:-1}))}calculateMCSize(t){if(!this.totalMCSize||t)if(this.start&&this.end)if(n.default.Xt(window.document.body,this.start)||n.default.Xt(window.document.body,this.end))this.logger.error("could not update mc_size, start/end elements removed from DOM",this.start,this.end);else{this.logger.verbose("calculating start/end elements"),this.startPosition=n.default.Z(this.start).y,this.endPosition=n.default.Z(this.end).y;let t=Math.min(this.endPosition+this.end.offsetHeight-this.startPosition,this.maxMCSize);this.totalMCSize=t>-1?t:-1,this.logger.info(`MC Size: ${this.totalMCSize}, startPosition: ${this.startPosition}, endPosition: ${this.endPosition}, endElementsSize: ${this.end.offsetHeight}`)}else this.totalMCSize=-1;return this.totalMCSize}withinMainContent(t){return!(!this.start||!this.end)&&(n.default.isPositionContained(this.start,t)&&n.default.isPositionedBefore(t,this.end)||n.default.isPositionContained(this.end,t)||n.default.isPositionedAfter(t,this.start)&&n.default.isPositionedBefore(t,this.end)||t===this.start||t===this.end)}shouldLookInMCOnly(){return this.mainContentOnly}isBelowMC(t){return this.elementAfterEnd?n.default.isPositionedAfter(t,this.elementAfterEnd):n.default.isPositionedAfter(t,this.end)}getMCStart(){return this.start?this.start.offsetTop:-1}isNextVisibleElement(t){return this.elementAfterEnd||this.findNextVisibleElement(),t===this.elementAfterEnd}findNextVisibleElement(){let t=Array.from(document.querySelectorAll("*")).filter((t=>n.default.isPositionedAfter(t,this.end)&&!n.default.isPositionContained(this.end,t)&&n.default.Pi(t)));t.length>0&&(this.elementAfterEnd=t[0])}getBorderElement(t){let i=document.createElement("div");i.id="browsi_"+t.toLowerCase().replace(/\s*/g,""),i.style.width="100%",i.style.height="0px",i.style["border-bottom"]="2px solid #00ff00",i.style["text-align"]="center",i.style.zIndex="9999999",i.style.position="absolute",i.style.color="white";let e=document.createElement("span");return e.style["font-size"]="20px",e.style["background-color"]="#00ff00",e.innerText=t,i.appendChild(e),i}drawMainContentBorder(t,i){this.debugMode&&this.draw&&(t.parentNode&&(this.startingBorder=this.startingBorder||this.getBorderElement("Main Content Start"),this.logger.verbose("starting border",this.startingBorder),t.parentNode.insertBefore(this.startingBorder,t)),i&&i.parentNode&&(this.endingBorder=this.endingBorder||this.getBorderElement("Main Content Ends"),this.logger.verbose("ending border",this.endingBorder),i.nextSibling?i.parentNode.insertBefore(this.endingBorder,i.nextSibling):i.parentNode.appendChild(this.endingBorder)))}upperMostElementOf(t){return t?this.sortByDomLocation(t)[0]:void 0}lowerMostElementOf(t){return t?this.sortByDomLocation(t)[t.length-1]:void 0}removeAllElementsAfter(t,i){if(!t)return i;let e=new Array;for(let s of i)s&&s.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING&&e.push(s);return e}getAdPositionType(t,i,e,s){if(!t||!this.start||!this.end)return r.AdPositionType.NA;if(n.default.isFixed(t).status||n.default.Jt(t)){if(void 0!==i&&void 0!==e){if(s&&n.default.Di(i))return r.AdPositionType.INTERSTITIAL;const t=e+i-n.default.Et().top;return n.default.Kt(n.default.L().height,t,.25*n.default.L().height)?r.AdPositionType.STICKY_BOTTOM:r.AdPositionType.STICKY_TOP}return r.AdPositionType.NA}return this.withinMainContent(t)?r.AdPositionType.WITHIN_MC:n.default.isPositionedBefore(this.start,t)?r.AdPositionType.BELOW_MC:r.AdPositionType.ABOVE_MC}getDcsMcElement(){return h.default.hasDcsMc()?h.default.getCurrentDcsElement():void 0}getScanStatus(){return this.scanStatus}}i.default=l},6326:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(2797);i.default=class{constructor(t,i){this.active=!0,this.rate=t.r,this.dfpOnly=t.do,this.keyValues=t.kv,this.limit=t.l,this.noDemandRefresh=t.nd,this.count=0,this.lastSuccessfulRefresh=0,this.isRefreshing=!1,this.stickyRefresh=!1,this.failCallback=i}canRefresh(t){return t>=this.rate&&!this.isRefreshing}start(t,i){this.oldBrowsiAd=Object.assign({},t.newBrowsiAd),this.isRefreshing=!0,this.stickyRefresh=i,this.updateCount(),t.sizes=[t.implementedSize]}isGenericRefresh(t){return!(!t.genericParams.refresh||t.providerName!==n.ProviderType.GENERIC_JS||!this.isRefreshing)}updateCount(){this.count++}handleFailed(t){t.newBrowsiAd&&(s.default.ci(t.newBrowsiAd.adWrapper),t.newBrowsiAd=Object.assign({},this.oldBrowsiAd),t.browsiAd=t.newBrowsiAd.adWrapper),this.isRefreshing=!1,"function"==typeof this.failCallback&&this.failCallback()}handleSuccess(){this.lastSuccessfulRefresh=this.count,this.isRefreshing=!1}isAllowedProviderForRefresh(t,i){return(t.providerName!==n.ProviderType.HEADER_BIDDING||!!i.c.d)&&t.providerName!==n.ProviderType.INFRAME}stopRefreshing(){this.active=!1}}},6537:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.UP="up",t.DOWN="down"}(i.ScrollDirection||(i.ScrollDirection={}))},5353:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.FIXED_IN_CONTENT="fixed_mc",t.FIXED_TOP="fixed_top",t.FIXED_BOTTOM="fixed_bottom",t.DYNAMIC="dynamic_mc",t.STICKY="sticky",t.API="api"}(i.SpotType||(i.SpotType={}))},4141:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.dcsVar="sticky"}(i.StickyConstants||(i.StickyConstants={})),function(t){t.TOP="TOP",t.BOTTOM="BOTTOM"}(i.Location||(i.Location={}))},1496:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.BROWSI="browsi",t.PUBLISHER="publisher"}(i.TimeInViewType||(i.TimeInViewType={}))},6797:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.WITHIN_MC="within_mc",t.BELOW_MC="below_mc",t.ABOVE_MC="above_mc",t.STICKY_TOP="sticky_top",t.STICKY_BOTTOM="sticky_bottom",t.NA="NA",t.INTERSTITIAL="interstitial"}(i.AdPositionType||(i.AdPositionType={}))},5345:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(t){t.PRE="pre_engine",t.POST="post_engine",t.DELAY="post_delay"}(i.PSPhase||(i.PSPhase={}))},50:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(7559),n=e(8867),r=e(7016),o=e(1496),h=e(2797),a=e(5540),l=e(8877),c=e(4436),d=e(4524);class u extends l.ViewabilityAdObject{constructor(t,i,e,s,n){super(t,i,e,a.default.getGAMResponseInfo(s)),this.placementId=t.placementId,this.isLazyLoaded=t.isLazyLoaded,this.positionType=t.positionType,this.provider=t.provider,this.refreshType=n,this.refreshCount=t.refreshCount,this.slot=s,this.isCustomRefreshConfigured=d.default.isCustomRefreshConfigured(),this.manualIframeWindow=t.manualIframeWindow,this.isCustomRefreshConfigured||this.setPubAdsRefresh(t,s),this.inViewActionsMap=this.generateInViewActionsMap(this.inViewActionsMap)}setPubAdsRefresh(t,i){var e;const n=s.default.get();if(n&&i){const r=n.getAdData(t.element,i,t.manualIframeWindow);r&&(this.pubRefreshRate=null===(e=s.default.get())||void 0===e?void 0:e.config.refreshRate,this.pubAdsData=r,this.refreshCallback=()=>{n.preparePubadsRefresh(i,this,r)})}}setCustomRefresh(t){const i=s.default.get(),e=this.slot;if(i&&e){const s=i.getAdData(this.ref,e);s&&(this.pubRefreshRate=t,this.pubAdsData=s,this.refreshCallback=()=>{i.preparePubadsRefresh(e,this,s)})}}onCustomRefreshRateReceived(t){t>0&&this.setCustomRefresh(t)}updateAnalytics(t){1===this.viewedImpressions&&this.isDfpAdNonSticky()&&n.default.get().increment(r.EventType.VIEWED_PUBLISHER_AD),n.default.get().updateTimeInView(o.TimeInViewType.PUBLISHER,this.placementId,this.refreshCount,this.viewedImpressions,t)}sendViewedEvent(t,i){c.default.get().$s(this,t,i)}isDfpAdNonSticky(){return!(this.provider!==h.ProviderType.DFP||this.positionType&&a.default.Yt(this.positionType))}isRefreshable(){return!(!this.refreshCallback||!this.pubAdsData)}canRefreshAd(t){return!!(!this.isRefreshing&&this.pubRefreshRate&&t>=this.pubRefreshRate&&this.refreshCallback)}Ts(){this.refreshCallback&&this.refreshCallback()}isSticky(){return a.default.Yt(this.positionType)}getRefreshRate(){return this.pubRefreshRate||-1}generateInViewActionsMap(t){return Object.assign(t,this.addActionToMap(["analytics"],[1e3,2e3,3e3,4e3,5e3,6e3,7e3],t)),Object.assign(t,this.addActionToMap(["event"],[this.conf.duration],t)),this.isRefreshable()&&this.getRefreshRate()>0&&Object.assign(t,this.addActionToMap(["refresh"],[this.getRefreshRate()],t)),t}}i.PublisherAdViewabilityObject=u},1971:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4042),n=e(8867),r=e(7016),o=e(1496),h=e(8877),a=e(4436),l=e(6326),c=e(5540),d=e(6389),u=e(1511),f=e(4524);class v extends h.ViewabilityAdObject{constructor(t,i,e,n){super(t,i,e,c.default.getGAMResponseInfo(t.spot.slot,t.spot)),this.spot=t.spot,this.expectedViewability=t.fn,this.demandResponse=n,this.isCustomRefreshConfigured=f.default.isCustomRefreshConfigured(),i.type===s.ViewabilityAdType.V&&(this.isRefreshConfigured(n)&&!this.isCustomRefreshConfigured&&(this.refreshManager=this.initializeRefresh(n.c.ri)),this.inViewActionsMap=this.generateInViewActionsMap(this.inViewActionsMap))}isRefreshConfigured(t){var i;return!!(null===(i=t.c)||void 0===i?void 0:i.ri)&&t.c.ri.r>0}initializeRefresh(t){return this.spot.refresh||(this.spot.refresh=new l.default(t)),this.spot.refresh}updateCustomRefresh(t){return this.spot.refresh?this.spot.refresh.rate=t.r:this.spot.refresh=new l.default(t),this.spot.refresh}getCustomRefreshInfo(t){if(this.demandResponse.c.ri)return{kv:this.demandResponse.c.ri.kv,do:this.demandResponse.c.ri.do,r:t,l:0,nd:!1}}setCustomRefresh(t){this.refreshManager=this.updateCustomRefresh(this.getCustomRefreshInfo(t))}onCustomRefreshRateReceived(t){var i;t>0?this.setCustomRefresh(t):null===(i=this.refreshManager)||void 0===i||i.stopRefreshing()}updateAnalytics(t){1===this.viewedImpressions&&n.default.get().increment(r.EventType.VIEWED_IMPRESSION),n.default.get().updateTimeInView(o.TimeInViewType.BROWSI,this.spot,this.refreshCount,this.viewedImpressions,t)}sendViewedEvent(t,i){u.InframeManager.get().isProviderInframe(this.spot)?a.default.get().Cs(this,t,i):a.default.get().xs(this,t,i)}isRefreshable(t){return!!(null==t?void 0:t.active)&&t.isAllowedProviderForRefresh(this.spot,this.demandResponse)&&(!t.limit||t.count<=t.limit)}stopAdTracking(){this.isViewed=!1}canRefreshAd(t){return!!this.refreshManager&&this.refreshManager.canRefresh(t)}getRefreshRate(){var t;return(null===(t=this.refreshManager)||void 0===t?void 0:t.rate)||-1}Ts(){this.stopAdTracking(),this.viewedImpressions=1,this.spot.Ts()}get refreshCount(){var t;return(null===(t=this.refreshManager)||void 0===t?void 0:t.lastSuccessfulRefresh)||0}generateInViewActionsMap(t){var i,e;const s=(null===(i=this.spot.refresh)||void 0===i?void 0:i.count)===(null===(e=this.spot.refresh)||void 0===e?void 0:e.lastSuccessfulRefresh);return this.spot.refresh&&!s||(Object.assign(t,this.addActionToMap(["analytics"],[1e3,2e3,3e3,4e3,5e3,6e3,7e3],t)),Object.assign(t,this.addActionToMap(["event"],[this.conf.duration],t)),d.Profiler.get().sendViewabilityCheckpoints&&!this.conf.shouldReportOneTime&&Object.assign(t,this.addActionToMap(["event"],[2e3,5e3,1e4,2e4,25e3,3e4],t))),this.isRefreshable(this.refreshManager)&&this.getRefreshRate()>0&&!this.isCustomRefreshConfigured&&Object.assign(t,this.addActionToMap(["refresh"],[this.getRefreshRate()],t)),t}}i.SpotViewabilityObject=v},8877:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6389);i.ViewabilityAdObject=class{constructor(t,i,e,n){this.inViewActionsMap={},this.ref=t.element,this.adIndex=t.adIndex,this.isViewed=!1,this.viewedImpressions=0,this.adUnit=t.adUnit||"NA",this.pageViewId=s.Profiler.get().pageViewID,this.isRefreshing=!1,this.logger=e,this.isByBrowsi=t.byBrowsi,this.conf=i,this.viewabilityInterval=null,this.metrics={startTime:null,viewed:!1,hiddenTime:0,outOfFocusTime:0},this.gamResponseInfo=n}getRefreshRate(){return-1}sendViewabilityReport(t,i,e,s){t/=1e3,this.viewedImpressions++,e&&this.sendViewedEvent(t,i),s&&this.updateAnalytics(t)}updateHiddenTime(t){t?this.metrics.hiddenTime=Date.now():this.isViewed&&(this.metrics.outOfFocusTime+=Date.now()-this.metrics.hiddenTime)}stopAdTracking(){this.isViewed=!1}isSticky(){return!1}addActionToMap(t,i,e){return i.forEach((i=>{e[i]=e[i]||[],e[i].push(...t)})),e}}},4042:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540);var n;!function(t){t[t.PUB_AD=0]="PUB_AD",t[t.V=1]="V"}(n=i.ViewabilityAdType||(i.ViewabilityAdType={}));i.ViewabilityConfigurations=class{static vConfig(t){return{minViewInitiator:50,duration:1e3,shouldReportOneTime:!!t,type:n.V}}static pubAdConfig(t){return{minViewInitiator:50,duration:1e3,shouldReportOneTime:s.default.Yt(t),type:n.PUB_AD}}}},1482:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(8562),r=e(1971),o=e(50),h=e(4042),a=e(6389),l=e(3510),c=e(5540),d=e(9179),u=e(4436);class f{constructor(){this.logger=new s.default("Viewability"),this.profile=a.Profiler.get(),this.isHidden=!1,this.ads=[],n.default.instance.subscribe((t=>{this.isHidden=t,this.ads.forEach((i=>{i.updateHiddenTime(t)}))})),this.logger.info("Using the NEW intersection observer Viewability service")}static get instance(){return f._instance||(this._instance=new f),f._instance}subscribe(t,i,e,s,n){const r=this.generateAdObject(t,i,e,s,n);let o;t.byBrowsi||(o=this.ads.findIndex((i=>i.placementId===t.placementId)),t.Is&&-1!=o&&this.ads.splice(o,1)),this.insert(r)}handleCustomRefreshResponse(t){const i=this.getViewabilityAdObject(t.id),e=t.rr,s=(null==i?void 0:i.conf.type)===h.ViewabilityAdType.PUB_AD?"publisher":"browsi";u.default.get().sendCustomRefreshRateEvent(s,e),i?(this.logger.verbose("get refresh rate returned",t,"matched to ad",i),i.onCustomRefreshRateReceived(e),e>0?this.observeCustomRefresh(i,e):this.logger.info("get refresh rate returned",t,"disabling refresh for this ad:",d.CUSTOM_REFRESH_RESPONSES_MAP[t.rr])):this.logger.info("get refresh rate returned",t,"didnt matched to exist ad")}getViewabilityAdObject(t){return this.ads.find((i=>i.ref.id===t))}initViewabilityCheck(t){const i=Object.keys(t.inViewActionsMap).map(Number);t.observer=new l.default(t.ref,t.conf.minViewInitiator/100,i,(i=>{this.onAdIsInView(t,i)})),t.observer.observe().then((()=>{t.refreshObserver||this.removeFromAdsArray(t)}))}observeCustomRefresh(t,i){t.refreshObserver=new l.default(t.ref,t.conf.minViewInitiator/100,[i],(i=>{this.handleRefresh(t,i)})),t.refreshObserver.observe().then((()=>{this.removeFromAdsArray(t)}))}onAdIsInView(t,i){const e=t.inViewActionsMap[i];this.logger.info(t.ref,` is in view for ${i} perform actions ${e}`),e.includes("refresh")&&this.handleRefresh(t,i);const s=e.includes("event"),n=e.includes("analytics");t.sendViewabilityReport(i,c.default.getElementPercentageInViewport(t.ref),s,n)}removeFromAdsArray(t){const i=this.ads.indexOf(t);i>-1&&this.ads.splice(i,1)}insert(t){this.ads.push(t),this.initViewabilityCheck(t)}handleRefresh(t,i){t.isByBrowsi&&(t.spot.waterfall=[]),t.canRefreshAd(i)&&(this.logger.info(`${t.isByBrowsi?"Spot":"Publisher ad"} #${t.adIndex} has been in view for ${i} ms. Starting to refresh`),t.Ts())}clearBeforeDcs(){this.clear()}clear(){this.ads.forEach((t=>{this.unObserveAd(t)})),this.ads=[]}generateAdObject(t,i,e,s,n){switch(i.type){case h.ViewabilityAdType.PUB_AD:return new o.PublisherAdViewabilityObject(t,i,this.logger,s,n);case h.ViewabilityAdType.V:return new r.SpotViewabilityObject(t,i,this.logger,e)}}unsubscribe(t){const i=this.ads.find((i=>i.ref===t.ref||i.ref===t.browsiAd));i&&(this.unObserveAd(i),this.removeFromAdsArray(i))}unObserveAd(t){var i,e;null===(i=t.observer)||void 0===i||i.clearObserver(),null===(e=t.refreshObserver)||void 0===e||e.clearObserver()}}i.ViewabilityService=f},5812:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(8324),n=e(5353),r=e(549);class o extends s.DirectSpot{constructor(t,i,e){const s={positionTag:e.positionTag||"in",typeTag:"api",oldType:n.SpotType.API};super(t,500,s,i);const o=r.SpotsUtils.getConf(s);this.options=e,this.sizes=e.sizes||o&&o.allowedCreativeSizes||[],this.options.sizes=this.sizes,this.optimizeViewability=this.vn(o),this.isLazyLoading=r.SpotsUtils.shouldLazyLoad(this)}vn(t){var i,e,s;if(t){const n=t.viewabilityOptimizationBlocklist,r=n&&(!!(null===(i=this.options)||void 0===i?void 0:i.adUnit)&&n.includes(null===(e=this.options)||void 0===e?void 0:e.adUnit)||n.includes(this.ref.id));return!(null===(s=this.options)||void 0===s?void 0:s.disableViewabilityOptimization)&&!r}return!0}Zi(t){return this.pn(t)}mn(){"INSIDE"===this.targetElementPosition&&"none"===this.ref.style.display&&this.ref.style.removeProperty("display")}getQueryBaseElement(){var t;return(null===(t=this.options)||void 0===t?void 0:t.shadowElement)||document}}i.ApiSpot=o},8324:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4097);class n extends s.default{constructor(t,i,e,s,n){super(t,i,e,s,n)}}i.DirectSpot=n},4322:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4202),n=e(5353);class r extends s.ScannedSpot{constructor(t,i,e,s){super(t,{positionTag:"in",typeTag:"dy",oldType:n.SpotType.DYNAMIC},i,0,e,s)}Gi(t){var i;this.relocationPlid=t.ref.id,this.options=t.options,(null===(i=t.options)||void 0===i?void 0:i.sizes)&&(this.sizes=t.options.sizes),this.relocationStatus=2}}i.DynamicSpot=r},1363:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4202),n=e(5353);class r extends s.ScannedSpot{constructor(t,i,e,s){const o={[n.SpotType.FIXED_IN_CONTENT]:{index:600,positionTag:"in"},[n.SpotType.FIXED_TOP]:{index:100,positionTag:"t"},[n.SpotType.FIXED_BOTTOM]:{index:200,positionTag:"b"}},h={positionTag:o[t.type].positionTag,typeTag:"fi",oldType:t.type};r.typeIndexSelectorMap[i]=r.typeIndexSelectorMap[i]||0,super(t.ref,h,t.typeIndex,o[t.type].index,e,s),this.demandIndex=r.typeIndexSelectorMap[i],r.typeIndexSelectorMap[i]++,this.selector=i}}i.FixedSpot=r,r.typeIndexSelectorMap={}},4202:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(4097),n=e(4524);class r extends s.default{constructor(t,i,e,s,r,o){super(t,s,i,e,r,o),n.default.isLazySpotsEnabled()&&(this.isLazyLoading=n.default.getLazySpotsInstance().isLazy(this))}}i.ScannedSpot=r},4097:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(6448),n=e(7899),r=e(5690),o=e(2661),h=e(4436),a=e(7016),l=e(8867),c=e(6797),d=e(5540),u=e(6389),f=e(549),v=e(2209),p=e(2797),m=e(9150),g=e(4524),b=e(1082);i.AD_INDEX_LIMIT=99;i.default=class{constructor(t,e,n,r,h,a){this.profile=u.Profiler.get(),this.logger=new o.default("Spot"),this.spotIndex=e+Math.min(i.AD_INDEX_LIMIT,r),this.demandIndex=Math.min(i.AD_INDEX_LIMIT,r),this.ref=t,this.pos="before",this.isDcs=!!(null==h?void 0:h.isDcs),this.Ki=1,this.maxWidth=d.default.L().width,this.isLazyLoading=!1,this.isPopulatedWithAd=!1,this.positionType=c.AdPositionType.NA,"s"!==n.positionTag&&(this.positionType=s.default.instance.getAdPositionType(t)),this.adDistanceFromTop=d.default.Z(t).y,this.adRequestBlockedSent=!1,this.spotRequested=0,this.isMeasurable=!1,this.disableDemand=!1,this.expectedViewabilityMapping={50:-99},this.isFluid=!1,this.type=f.SpotsUtils.convertTagsToType(n),this.typeIndex=r,this.optimizeViewability=!0,this.targetElementPosition=f.SpotsUtils.getTargetElementPosition(n),this.refresh=null,this.tags=n,this.sizes=this.gn(),this.bn()&&(this.placeholder=new v.default),this.genericParams={},this.positionTagIndex=a}vs(t){this.slot&&this.refresh&&(this.refresh.oldSlot=this.slot),this.slot=t}bs(t){this.implementedSize=t,this.isFluid=this.wn(t)}wn(t){return 0===t.h&&0===t.w}gn(){return f.SpotsUtils.getSizes(this.tags).filter((t=>!d.default.yi(t)))}on(t){var i;this.browsiAd=t.adWrapper,this.isPopulatedWithAd=!0,this.newBrowsiAd=t,(null===(i=this.placeholder)||void 0===i?void 0:i.active)&&this.placeholder.openPlaceholder(this)}oe(){this.newBrowsiAd&&(this.newBrowsiAd.adMarking&&(this.newBrowsiAd.adMarking.style.display="block"),this.newBrowsiAd.adWrapper&&(this.newBrowsiAd.adWrapper.style.display="block",s.default.instance.calculateMCSize(!0))),this.mn()}mn(){}Ts(){var t,i,e;null===(t=this.placeholder)||void 0===t||t.deactivatePlaceholder(),this.providerName!==p.ProviderType.GENERIC_JS||(null===(i=this.genericParams)||void 0===i?void 0:i.refresh)?(null===(e=this.refresh)||void 0===e||e.start(this,!1),r.YieldClient.get().ns([this],n.DemandRequestType.SINGLE)):this.logger.verbose("Custom in view refresh failed. no refresh function supplied by template")}gs(){this.refresh&&(this.refresh.isRefreshing=!1),this.isMeasurable=!1}ie(){var t;null===(t=this.refresh)||void 0===t||t.handleFailed(this)}isRefreshing(){var t;return!!(null===(t=this.refresh)||void 0===t?void 0:t.isRefreshing)}get refreshCount(){var t;return(null===(t=this.refresh)||void 0===t?void 0:t.count)||0}Ji(t){if(t.od&&t.od[50]&&t.od[50].p){const i=Number(t.od[50].p);this.expectedViewabilityMapping[50]=Number(i<0?i:i.toFixed(3))}}handlePreFetchAsyncReject(t){const i=[{reason:"pre_fetch_async",message:t}];this.qi(i)}qi(t){var i;if(!this.adRequestBlockedSent){const e=t.map((t=>t.reason.toString())).join(","),s=t.map((t=>t.message)).join(",");this.logger.info(`blocking spot ${this.spotIndex}`),this.logger.table(t),h.default.get().sendAdRequestBlockedEvent(this,e,s),e.includes("out_of_focus")&&(l.default.get().increment(a.EventType.AD_REQUEST_BLOCKED),this.logger.info("collect oof")),this.adRequestBlockedSent=!0,this.disableDemand=this._n(t),this.disableDemand&&(null===(i=this.placeholder)||void 0===i||i.closePlaceholder(this))}}_n(t){return!!t.find((t=>!["lazy_ad_missed","out_of_focus","spot_not_exists","CLS"].includes(t.reason)))}ue(t){return{element:this.newBrowsiAd.isIframe?this.newBrowsiAd.iframe:this.newBrowsiAd.adContainer,spot:this,byBrowsi:!0,adIndex:this.spotIndex,adUnit:t.adUnit,Is:!1,fn:this.expectedViewabilityMapping[50]}}Zi(t){return this.options?this.pn(t):t}pn(t){const i=this.options,e=t.c.d||t.c,s=t.c,n=this.Ki>1;return void 0!==i.refresh&&s.ri&&(i.refresh.active?i.refresh.refreshSecond&&(s.ri.r=1e3*i.refresh.refreshSecond):s.ri.r=-1),n?this.sizes=this.gn():(i.adUnit&&"demo-placement"!==t.plk&&(e.aup=i.adUnit),i.keyValues&&(t.setTargeting=t.setTargeting?t.setTargeting.concat(i.keyValues):i.keyValues)),t}bn(){var t;return this.profile.placeholder&&!!this.sizes.length&&(this.sizes.length>1||!this.yn(this.sizes[0]))&&!(null===(t=this.refresh)||void 0===t?void 0:t.isRefreshing)}setPlaceholderSize(t){var i;if(null===(i=this.placeholder)||void 0===i?void 0:i.active){let i;const e=this.un(t),s=g.default.getExternalFlowHandler("changePlaceholderSize");if(s){i=s(Object.assign({},this),Object.assign({},e));!!i.w&&!!i.h||this.placeholder.deactivatePlaceholder()}this.placeholder.setSize(i||e)}}Sn(t){let i=0,e=0;return t.forEach((t=>{t.w>i&&(i=t.w),t.h>e&&(e=t.h)})),{w:i,h:e}}un(t){const i=this.Sn(t);return d.default._i(i)||this.yn(i)?{w:d.default.L().width,h:250}:{w:i.w,h:Math.min(i.h,250)}}yn(t){return 1===t.w&&1===t.h}isEagerFirstFold(){return this.profile.eagerFirstFold&&d.default.Ot(this)<=1}destoryDFPSlot(t){var i,e;const s=t||this.newBrowsiAd;this.slot&&s&&(null===(e=null===(i=s.win)||void 0===i?void 0:i.googletag)||void 0===e||e.destroySlots([this.slot]),delete this.slot)}Qi(){var t;(null===(t=this.placeholder)||void 0===t?void 0:t.active)?this.placeholder.closePlaceholder(this):m.Embedder.Ps(this)}getQueryBaseElement(){return document}initCustomRefreshRate(){var t,i,e,s;let r=Object.assign({},(null===(t=this.newBrowsiAd)||void 0===t?void 0:t.adContainer.id)?{id:this.newBrowsiAd.adContainer.id}:{});if(this.providerName===p.ProviderType.GENERIC_JS)Object.assign(r,Object.assign(Object.assign(Object.assign({},this.genericParams.adUnit?{au:this.genericParams.adUnit}:{}),(null===(i=this.genericParams.gamInfo)||void 0===i?void 0:i.lid)?{lid:this.genericParams.gamInfo.lid}:{}),(null===(e=this.genericParams.gamInfo)||void 0===e?void 0:e.oid)?{oid:this.genericParams.gamInfo.oid}:{}));else{const t=d.default.getGAMResponseInfo(this.slot);Object.assign(r,Object.assign(Object.assign(Object.assign({},(null===(s=this.slot)||void 0===s?void 0:s.getAdUnitPath())?{au:this.slot.getAdUnitPath()}:{}),(null==t?void 0:t.lid)?{lid:t.lid}:{}),(null==t?void 0:t.oid)?{oid:t.oid}:{}))}b.CustomRefreshRate.get().sendCustomRefreshRate(n.DemandRequestType.SINGLE,[r])}}},9008:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5540),r=e(4436),o=e(6448),h=e(5594),a=e(3468),l=e(8814),c=e(3200),d=e(2350),u=e(5780),f=e(5684),v=e(5353),p=e(6792),m=e(5345),g=e(4465),b=e(3486),w=e(3899),_=e(6389),y=e(83),S=e(4141),O=e(5690),A=e(1675),j=e(549),E=e(1363),I=e(4322),P=e(9667),M=e(470),T=e(7016),k=e(6032);class R{constructor(t){this.fixedFirstSpots=[],this.logger=new s.default("SpotEngine"),this.invalidInspectives=[],this.profile=_.Profiler.get();const i=(this.profile.scanningTags||[]).map((t=>t.toUpperCase())),e=k.TAGS_TO_SCAN.map((t=>t.toUpperCase()));this.tagsToScan=Array.from(new Set([...e,...i])),this.tagsToAvoid=["NAV","A","LI","HEADER","TABLE","P"].filter((t=>this.profile.scanningTags&&!this.profile.scanningTags.includes(t)&&!this.profile.scanningTags.includes(t.toLowerCase()))),this.type=t||p.SpotEngineType.STANDARD,this.isSpotEngineDone=!1,this.externalTargetElements=null,this.isDcs=!1,this.spotsFound=[],this.currentSpotTags={typeTag:"dy",positionTag:"in"},this.externalScanConfig={}}static get(t){return R.instance||(this.instance=new R(t)),t&&(this.instance.type=t),R.instance}setTargetElements(t){this.externalTargetElements=t}setExternalScanConfig(t){this.externalScanConfig=Object.assign(this.externalScanConfig,t)}runSecondTimeForBelowReadMore(){this.invalidInspectives=[],a.default.get().sendPageStructureEvent(m.PSPhase.PRE,null);const t=y.default.getSpots().slice();this.spotsFound.length||(this.spotsFound=t.slice()),this.collectDynamicAndFixed();const i=this.spotsFound.slice(t.length);this.handleSpotsFound(i);const e=y.default.getSpots().slice(t.length);return this.sendPostPageStructure(),this.profile.analysisMode||O.YieldClient.get().Ze(e),{firstRunSpots:t,secRunSpots:e}}startSpotEngine(t){const i=this.getTargetElements();this.resetDefaultValues(),this.isDcs=!!(null==t?void 0:t.isDcs)||!!this.profile.dcsState,this.runExternalProcesses(),this.run(i,t)}getTargetElements(){return this.externalTargetElements&&this.externalTargetElements.length?this.externalTargetElements:this.type===p.SpotEngineType.BROWSI_SPOTS?[]:this.profile.targetElements&&this.profile.targetElements.length>0?n.default.Ni(this.profile.targetElements):[document.body]}runExternalProcesses(){b.default.initializeSkippedElements(),o.default.instance.findMainContent(h.default.get().foundAds,l.default.get().findCR(),c.default.get().getAllCommentSections(),d.default.get().getAllSocialElements()),M.default.get().scanDomForSA(),h.default.get().scan(!0),this.shouldSendPageStructure()&&a.default.get().sendPageStructureEvent(m.PSPhase.PRE,null)}shouldSendPageStructure(){return!("boolean"==typeof this.externalScanConfig.disablePageStructure&&this.externalScanConfig.disablePageStructure)}resetDefaultValues(){this.externalTargetElements=null,this.isSpotEngineDone=!1,this.invalidInspectives=[],this.isDcs=!1,this.spotsFound=[]}run(t,i){if(this.logger.info(`Running on mode: ${this.type}`),this.buildStickySpot(),this.type===p.SpotEngineType.BROWSI_SPOTS)this.runForBrowsiSpots(t);else if(this.type===p.SpotEngineType.SLIDES_ALL){const e=i&&i.slides;this.collectDynamicAndFixed(t,e);const s=e||[];for(let t=1;t<s.length;t++)this.logger.info("found",s[t].spots.length,"spots on slide number ",t+1,":",s[t]);this.handleSpotsFound(this.spotsFound)}else this.collectDynamicAndFixed(t),this.handleSpotsFound(this.spotsFound)}collectDynamicAndFixed(t,i){this.profile.fixedSpotsFirst||this.collectFixedSpots(t,i),this.currentSpotTags={typeTag:"dy",positionTag:"in"},this.collect(!1,t,i)}collectFixedSpots(t,i){j.FIXED_TAGS.forEach((e=>{j.SpotsUtils.getConf(e)&&(this.currentSpotTags=e,this.collect(!0,t,i))}))}scanFixedSpotsFirst(){this.logger.info("scan fixed spots first"),this.collectFixedSpots(),this.handleSpotsFound(this.spotsFound),this.fixedFirstSpots=this.spotsFound,this.reportInvalidInspectives(),this.profile.analysisMode||O.YieldClient.get().Ze(y.default.getSpots())}BuildSelectorXpath(){let t="(";if("dy"===this.currentSpotTags.typeTag)this.tagsToScan.forEach((i=>{t+=".//"+i+"|"}));else if("fi"===this.currentSpotTags.typeTag){const i=j.SpotsUtils.getConf(this.currentSpotTags);if(i){const e=i.targetElements||[];this.getFixedElementsBySelector(e),e.forEach((i=>{t+=n.default.Vi(i)+"|"}))}}return t=t.substring(0,t.length-1),t+=")[not(",this.tagsToAvoid.forEach((i=>{t+="ancestor::"+i+"|"})),t=t.substring(0,t.length-1),t+=")]",t}collect(t,i,e,s){let h=this.getSpotFoundByTags(this.currentSpotTags).length;this.logger.verbose("scanning tags: ",this.tagsToScan);let a,l=!1;i=i||[document.body];const c=this.getAllPossibleElements(i,t),d=t?j.SpotsUtils.getConf(this.currentSpotTags):null;d&&"fi"===this.currentSpotTags.typeTag&&(d.maxItems=c.length),s&&(this.logger.info("scanning DCS API spots"),this.currentSpotTags={typeTag:"dy",positionTag:"in"});const u=b.default.getStartPosition();this.logger.verbose("all possible elements:",c);let f=[];const p=s||this.enforceValidations();for(let i=0;i<c.length;i++){const m=c[i];if(e&&(a=e.find((t=>n.default.isPositionContained(t.element,m))),!a))continue;l=!(a&&e&&e.length)||a.element===e[0].element;const g=a&&!l;if(!s&&b.default.isMaxSpotsReached(g,a,t)){if(e)continue;break}if(d&&b.default.isPositionInsideAndNotEmpty(d,m))this.reportInvalidInspective(m,"position inside & not empty"),r.default.get().sendErrorEvent(T.EventType.CONFIGURATION_ERROR,"","fixed spot rejected - positioned inside of non empty element");else{if(p){const i=this.getDistanceFromTop(m);if(i<u){this.reportInvalidInspective(m,"before starting fold");continue}if(this.externalScanConfig.forceStartPosition&&i<this.externalScanConfig.forceStartPosition){this.reportInvalidInspective(m,"before read more");continue}if(this.externalScanConfig.forceEndPosition&&i>this.externalScanConfig.forceEndPosition){this.reportInvalidInspective(m,"after read more");break}const e=b.default.getStopPosition();if(e&&i>e){this.reportInvalidInspective(m,"after stopping fold");break}if(b.default.isInSkippedElements(m)){this.reportInvalidInspective(m,"skipped");continue}if(!t&&o.default.instance.shouldLookInMCOnly()&&!o.default.instance.withinMainContent(m)&&!o.default.instance.isNextVisibleElement(m)){if(this.reportInvalidInspective(m,"out of main content"),o.default.instance.isBelowMC(m))break;continue}if(b.default.isOutOfViewport(m)){this.reportInvalidInspective(m,"out of viewport");continue}if(!t&&!n.default.Ft(m)){this.reportInvalidInspective(m,"not visible");continue}if(!t&&n.default.isFixed(m).status){this.reportInvalidInspective(m,"fixed");continue}if(b.default.shouldSA(m)){this.reportInvalidInspective(m,"stay away");continue}if(!t&&this.profile.pageLayoutSA){if(w.default.get().isBetweenTitleAndContent(m)){this.reportInvalidInspective(m,"between title and content");continue}if(w.default.get().isAfterOneLiner(m)){this.reportInvalidInspective(m,"after one line");continue}}if(!t&&!b.default.hasValidWidth(m)){this.reportInvalidInspective(m,"too narrow");continue}if(d&&b.default.isFixedSpot(this.currentSpotTags)&&"INSIDE"===j.SpotsUtils.getTargetElementPosition(this.currentSpotTags)){const t=b.default.getSkippedElementsContainers();if(t&&t.includes(m)){this.reportInvalidInspective(m,"skipped");continue}}if(b.default.isCloseToSpot(m,g,t)){this.reportInvalidInspective(m,"too close to spot");continue}}s?f.push({ref:m,typeIndex:0,type:v.SpotType.DYNAMIC}):g?this.saveBrowsiSpot(m,a):(this.saveSpot(m,h),h++)}}if(s)return this.reportInvalidInspectives("DCS API -"),f.map((t=>t.ref));const m=j.SpotsUtils.convertTagsToType(this.currentSpotTags);this.logger.style("%cTotal "+m+" Spots: "+this.getSpotFoundByTags(this.currentSpotTags).length+" / "+b.default.getMaxSpots(t),"font-size:18px; font-weight:bold;"),this.logger.style("%cMax "+m+" Items: "+b.default.getMaxItems(),"font-size:14px; font-weight:bold;"),"dy"===this.currentSpotTags.typeTag&&this.reportInvalidInspectives()}reportInvalidInspectives(t){this.logger.info(`${t||""} invalid  inspectives before start in fold: `,this.invalidInspectives.filter((t=>"before starting fold"==t.reason))),this.logger.info(`${t||""} invalid  inspectives: `,this.invalidInspectives.filter((t=>"before starting fold"!=t.reason)))}enforceValidations(){return!b.default.isFixedSpot(this.currentSpotTags)||!this.profile.fixedSpotsFirst}getAllPossibleElements(t,i){let e=[];return t.forEach((t=>{const s=b.default.getRootElement(t,i),r=n.default.Ni([this.BuildSelectorXpath()],t);e=e.concat(s,r)})),e}reportInvalidInspective(t,i){this.invalidInspectives.push({inspective:t,reason:i,type:j.SpotsUtils.convertTagsToType(this.currentSpotTags)})}saveSpot(t,i){this.spotsFound.push({ref:t,type:j.SpotsUtils.convertTagsToType(this.currentSpotTags),typeIndex:i})}handleSpotsFound(t){t.sort((function(t,i){return 2&t.ref.compareDocumentPosition(i.ref)?1:-1}));let i=0,e=0;t.forEach((t=>{t.positionTag=j.SPOT_TAGS_MAP[t.type].positionTag,"in"===t.positionTag?(t.positionTagIndex=i,i++):"b"===t.positionTag&&(t.positionTagIndex=e,e++),this.createSpot(t)})),y.default.getSpots().forEach((t=>this.logger.verbose("spot found ",t.ref,t)))}saveBrowsiSpot(t,i){const e=document.createElement(g.CustomTagType.BROWSI_SPOT);e.setAttribute("browsiType",j.SpotsUtils.convertTagsToType(this.currentSpotTags)),"fi"===this.currentSpotTags.typeTag&&e.setAttribute("browsiSelector",this.getSelectorByElement(t)),t.parentElement.insertBefore(e,t),i.spots.push(e)}onStopEngine(){this.isSpotEngineDone||(this.logger.info("onStopEngine"),this.isSpotEngineDone=!0,u.default.instance.recalculateAdsPositionType(),this.shouldSendPageStructure()&&this.sendPostPageStructure(),this.profile.debug&&f.Output.setBrowsiOutput("spot_engine_done"))}sendPostPageStructure(){a.default.get().sendPageStructureEvent(m.PSPhase.POST,null),a.default.get().sendPageStructureEventWithDelay()}getDistanceFromTop(t){return n.default.Z(t).y}runForBrowsiSpots(t){const i=y.default.getSpots();t.forEach((t=>{let e=t.getAttribute("browsiType"),s={ref:t,type:e,typeIndex:i.filter((t=>t.type==e)).length};this.createSpot(s,t.getAttribute("browsiSelector")||void 0),this.logger.info("Found browsi spot: ",t)})),this.logger.style("%cTotal fixed Spots: "+i.filter((t=>"fi"===t.tags.typeTag)).length,"font-size:18px; font-weight:bold;"),this.logger.style("%cTotal dynamic Spots: "+i.filter((t=>t.type==v.SpotType.DYNAMIC)).length,"font-size:18px; font-weight:bold;"),this.logger.style("%cMax dynamic Items: "+b.default.getMaxItems({typeTag:"dy",positionTag:"in"}),"font-size:14px; font-weight:bold;")}getInvalidInspectives(){return this.invalidInspectives}buildStickySpot(){var t,i,e;const s=j.SpotsUtils.getConf({typeTag:"st",positionTag:"s"});if(!s)return;const n=A.default.getWindowObject(),r=null===(e=null===(i=null===(t=this.profile.dcsState)||void 0===t?void 0:t.prevPvSpots)||void 0===i?void 0:i.s)||void 0===e?void 0:e[0],o=this.isDcs&&((null==n?void 0:n[S.StickyConstants.dcsVar])||r);if(this.isDcs&&!o)return;if(!o&&this.isStickyApiIdsConfigured())return void this.logger.info("Sticky spot in invalid because Sticky Api spot is already defined ");if(!o&&b.default.isPubStickyOnPage())return void this.logger.info("Sticky spot in invalid because of publisher sticky ad");const h=new P.StickySpot(s.location,o);return y.default.reportSpot(h),h}createSpot(t,i){const e={isDcs:this.isDcs};let s;switch(t.type){case v.SpotType.FIXED_IN_CONTENT:case v.SpotType.FIXED_TOP:case v.SpotType.FIXED_BOTTOM:s=new E.FixedSpot(t,i||this.getSelectorByElement(t.ref),e,t.positionTagIndex);break;default:s=new I.DynamicSpot(t.ref,t.typeIndex,e,t.positionTagIndex)}return y.default.reportSpot(s),s}getSpotFoundByTags(t){return this.spotsFound.filter((i=>i.type==j.SpotsUtils.convertTagsToType(t)))}isStickyApiIdsConfigured(){const t=j.SpotsUtils.getConf({typeTag:"api",positionTag:"s"});return!(!t||!t.positionIds)}getFixedElementsBySelector(t){this.fixedSelectorsToElementsMap=this.fixedSelectorsToElementsMap||{},t.forEach((t=>{this.fixedSelectorsToElementsMap[t]=n.default.Ni([t])}))}getSelectorByElement(t){for(let i in this.fixedSelectorsToElementsMap){if(this.fixedSelectorsToElementsMap[i].some((i=>i===t)))return i}return""}}i.default=R},3486:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(5540),n=e(9008),r=e(4465),o=e(470),h=e(6389),a=e(5594),l=e(6797),c=e(549),d=e(7966);class u{static get browsiAdsMinDistance(){var t;return this._browsiAdsMinDistance||(this._browsiAdsMinDistance=(null===(t=c.SpotsUtils.getConf({typeTag:"dy",positionTag:"in"}))||void 0===t?void 0:t.distance)||400),this._browsiAdsMinDistance}static get profile(){return this._profile||(this._profile=h.Profiler.get()),this._profile}static isMaxSpotsReached(t,i,e){const s=u.getMaxSpots(e);return t?i.spots.filter((t=>t.getAttribute("browsiType")==c.SpotsUtils.convertTagsToType(n.default.get().currentSpotTags))).length>=s:u.getCurrentTypeSpots().length>=s}static getMaxSpots(t){return t?c.SpotsUtils.getFixedMaxItems(n.default.get().currentSpotTags):this.getDynamicMaxSpots()}static getDynamicMaxSpots(){var t,i;let e=this.getMaxItems({typeTag:"dy",positionTag:"in"})+d.DemandTool.get().relocateSpots.length;const s=null===(i=null===(t=this.profile.spotsSupplyParams)||void 0===t?void 0:t.dynamic)||void 0===i?void 0:i.potentialSpots;return s?Math.max(s,e):e}static getMaxItems(t){const i=t||n.default.get().currentSpotTags;return"fi"===i.typeTag?c.SpotsUtils.getFixedMaxItems(i):c.SpotsUtils.getDynamicMaxItems()}static getFixedTotalMaxItems(){return c.FIXED_TAGS.map((t=>{const i=c.SpotsUtils.getConf(t);return i?i.maxItems:0})).reduce(((t,i)=>-1===t||-1===i?-1:t+i),0)}static getCurrentTypeSpots(){return n.default.get().spotsFound.filter((t=>t.type==c.SpotsUtils.convertTagsToType(n.default.get().currentSpotTags)))}static getSpotsByType(t){return[...n.default.get().spotsFound,...n.default.get().fixedFirstSpots].filter((i=>i.type==t))}static isFixedSpot(t){return"fi"===t.typeTag}static isCloseToSpot(t,i,e,r){if(e)return!1;if(i)return u.isCloseToPreviousBrowsiSpot(t);let o=[...n.default.get().spotsFound,...n.default.get().fixedFirstSpots,...r||[]];o.sort(((t,i)=>2&t.ref.compareDocumentPosition(i.ref)?1:-1));for(let i=0;i<o.length;i++){const e=o[i].ref;if(!s.default.isFixed(e).status&&this.getDistanceBetweenElementAndSpot(t,o[i])<this.browsiAdsMinDistance)return!0}return!1}static getDistanceBetweenElementAndFixedSpot(t,i){const e=c.SpotsUtils.getConf(c.SPOT_TAGS_MAP[i.type]);let n=Math.abs(this.getDistanceFromTop(t)-this.getDistanceFromTop(i.ref));return"INSIDE"===e.targetElementPosition&&s.default.isPositionedBefore(i.ref,t)&&(n-=s.default.ut(i.ref).h),n}static getDistanceBetweenElementAndSpot(t,i){return this.isFixedSpot(c.SPOT_TAGS_MAP[i.type])?this.getDistanceBetweenElementAndFixedSpot(t,i):this.getDistanceFromTop(t)-this.getDistanceFromTop(i.ref)}static isCloseToPreviousBrowsiSpot(t){const i=document.getElementsByTagName(r.CustomTagType.BROWSI_SPOT),e=i[i.length-1];return!!e&&this.getDistanceFromTop(t)-this.getDistanceFromTop(e)<this.browsiAdsMinDistance}static getDistanceFromTop(t){return s.default.Z(t).y}static getStartPosition(){const t=c.SpotsUtils.getConf(n.default.get().currentSpotTags);if(!t)return 0;if(t.startInFoldSelectors){let i=s.default.Ni(t.startInFoldSelectors)[0];if(i)return s.default.Z(i).y+20}if(t.startInFold){return s.default.$i().viewPortHeight*(t.startInFold-1)}return 0}static getStopPosition(){const t=c.SpotsUtils.getConf(n.default.get().currentSpotTags);if(!t||"number"!=typeof t.stopInFold||"number"!=typeof t.startInFold)return!1;const i=s.default.$i();if(t.stopInFold>=0)return i.viewPortHeight*t.stopInFold;{const e=t.startInFold-t.stopInFold;return i.numberOfFolds>e+1&&i.docHeight+i.viewPortHeight*t.stopInFold}}static initializeSkippedElements(){const t=this.profile.uxRules.skipped.xpath.length?s.default.Ni(this.profile.uxRules.skipped.xpath):[],i=this.profile.uxRules.skipped.css.length?Array.from(document.querySelectorAll(this.profile.uxRules.skipped.css.join(","))):[];this.skippedElementsContainers=t.concat(i).filter((t=>o.default.get().isValidHeightForSkipSa(t)))}static getSkippedElementsContainers(){return this.skippedElementsContainers}static isOutOfViewport(t){const i=s.default.Z(t);return i.x>=s.default.L().width||i.y+t.clientHeight<0||i.x+t.clientWidth<0}static isInStayAwayElements(t){const i=o.default.get().getStayAwayElements();if(i)for(let e=0;e<i.length;e++)if(t===i[e].element)return!0;return!1}static shouldSA(t){return this.isInStayAwayElements(t)||o.default.get().isToStayAway(t)}static isInSkippedElements(t){if(this.skippedElementsContainers.length)for(let i=0;i<this.skippedElementsContainers.length;i++)if(s.default.isPositionContained(this.skippedElementsContainers[i],t))return!0;return!1}static hasValidWidth(t){const i=this.minContainerWidth,e=s.default.Rt(t).w;if(e&&e>=i)return!0;const n=t.parentNode;if(n&&s.default.B(t.parentNode)){const t=s.default.Rt(n).w;return!!(t&&t>=i)}return!1}static getRootElement(t,i){return i||"BODY"==t.nodeName?[]:[t]}static isPubStickyOnPage(){return a.default.get().foundAds.some((t=>t.positionType===l.AdPositionType.STICKY_TOP||t.positionType===l.AdPositionType.STICKY_BOTTOM))}static isPositionInsideAndNotEmpty(t,i){if("INSIDE"===t.targetElementPosition){return Array.from(i.childNodes).filter((t=>this.isExpandableElement(t))).length>0}return!1}static isExpandableElement(t){return s.default.B(t)&&!(t instanceof HTMLScriptElement)}}i.default=u,u.skippedElementsContainers=[],u.minContainerWidth=250},83:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(2661),n=e(5353),r=e(4141),o=e(9150),h=e(549),a=e(1675),l=e(4436);class c{static get logger(){return this._logger||(this._logger=new s.default("Spots")),this._logger}static getSpots(){return this.spots}static addSpot(t){return this.spots.push(t),this.spots}static reportSpot(t){c.addSpot(t),l.default.get().sendSpotFoundEvent(t),c.logger.info("spot found",t.ref)}static getNonStickySpots(){return this.spots.filter((t=>t.type!==n.SpotType.STICKY&&"s"!==t.tags.positionTag))}static getNonStickyOrApiSpots(){return this.spots.filter((t=>t.type!==n.SpotType.STICKY&&t.type!==n.SpotType.API))}static getSpotsByType(t){return this.spots.filter((i=>t.includes(i.type)))}static getStickySpot(){return this.spots.find(this.isSticky)||null}static isSticky(t){return t.type===n.SpotType.STICKY}static getEmbeddedSpots(){return c.getSpots().filter((t=>t.isPopulatedWithAd))}static getEmbeddedSerializedSpots(){return c.getEmbeddedSpots().map((t=>c.serialize(t)))}static getStickySerializedSpots(){const t=c.getStickySpot();return t?c.stickySerialize(t):null}static getLazyLoadSpots(){return this.getSpots().filter((t=>t.isLazyLoading))}static serialize(t){return{spotIndex:t.spotIndex,maxWidth:t.maxWidth,adDistanceFromTop:t.adDistanceFromTop,pos:t.pos,isLazyLoading:t.isLazyLoading,newBrowsiAd:t.newBrowsiAd,browsiAd:t.browsiAd,type:t.type,typeIndex:t.typeIndex,ref:t.ref,selector:t.selector}}static stickySerialize(t){return{maxWidth:t.maxWidth,newBrowsiAd:t.newBrowsiAd,browsiAd:t.browsiAd,implementedSize:t.implementedSize,slot:t.slot,attemptIndex:t.Ki,refresh:t.refresh}}static removeStickyAd(t){var i,e;if("s"!==t.tags.positionTag)return;o.Embedder.Ps(t),t.newBrowsiAd&&t.slot&&(null===(e=null===(i=t.newBrowsiAd.win)||void 0===i?void 0:i.googletag)||void 0===e||e.destroySlots([t.slot])),a.default.removeStickyVar(this.logger);const s=window.document.body.style,n=h.SpotsUtils.getConf(t.tags);(null==n?void 0:n.location)===r.Location.TOP?s.paddingTop="":s.paddingBottom=""}}i.default=c,c.spots=[]},9667:(t,i,e)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0});const s=e(8324),n=e(5353),r=e(4141),o=e(6797),h=e(5690),a=e(5540),l=e(7899),c=e(2797);class d extends s.DirectSpot{constructor(t,i){const e=i?{isDcs:!0}:void 0,s={positionTag:"s",typeTag:"st",oldType:n.SpotType.STICKY};super(window.document.body,0,s,-1,e),this.positionType=t==r.Location.BOTTOM?o.AdPositionType.STICKY_BOTTOM:o.AdPositionType.STICKY_TOP,i?this.handleSpotFromPreviousPageView(this,i):h.YieldClient.get().ns([this],l.DemandRequestType.SINGLE)}handleSpotFromPreviousPageView(t,i){Object.assign(t,i),this.refreshStickySpotOnNewPv()}refreshStickySpotOnNewPv(){var t;this.providerName!==c.ProviderType.GENERIC_JS&&(null===(t=this.refresh)||void 0===t||t.start(this,!0),h.YieldClient.get().ns([this],l.DemandRequestType.SINGLE))}un(){const t=this.Sn(this.sizes);return a.default._i(t)||this.yn(t)?{w:a.default.L().width,h:250}:t}}i.StickySpot=d},6032:(t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.TAGS_TO_SCAN=["BR","DIV","TABLE","TBODY","FORM","SECTION","ARTICLE","SPAN","HEADER","P","MAIN","UL","OL","LI","FIGURE"]},495:()=>{var t,i,e,s;String.prototype.endsWith||(String.prototype.endsWith=function(t,i){var e=this.toString();("number"!=typeof i||!isFinite(i)||Math.floor(i)!==i||i>e.length)&&(i=e.length),i-=t.length;var s=e.lastIndexOf(t,i);return-1!==s&&s===i}),String.prototype.startsWith||(String.prototype.startsWith=function(t,i){return this.substr(i||0,t.length)===t}),Array.prototype.filter||(Array.prototype.filter=function(t){"use strict";if(null==this)throw new TypeError;var i=Object(this),e=i.length>>>0;if("function"!=typeof t)throw new TypeError;for(var s=[],n=arguments.length>=2?arguments[1]:void 0,r=0;r<e;r++)if(r in i){var o=i[r];t.call(n,o,r,i)&&s.push(o)}return s}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),e=i.length>>>0;if("function"!=typeof t)throw new TypeError("predicate must be a function");for(var s=arguments[1],n=0;n<e;){var r=i[n];if(t.call(s,r,n,i))return r;n++}}}),"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(t,i){"use strict";if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),s=1;s<arguments.length;s++){var n=arguments[s];if(null!=n)for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},writable:!0,configurable:!0}),Array.from||(Array.from=(t=Object.prototype.toString,i=function(i){return"function"==typeof i||"[object Function]"===t.call(i)},e=Math.pow(2,53)-1,s=function(t){var i=function(t){var i=Number(t);return isNaN(i)?0:0!==i&&isFinite(i)?(i>0?1:-1)*Math.floor(Math.abs(i)):i}(t);return Math.min(Math.max(i,0),e)},function(t){var e=this,n=Object(t);if(null==t)throw new TypeError("Array.from requires an array-like object - not null or undefined");var r,o=arguments.length>1?arguments[1]:void 0;if(void 0!==o){if(!i(o))throw new TypeError("Array.from: when provided, the second argument must be a function");arguments.length>2&&(r=arguments[2])}for(var h,a=s(n.length),l=i(e)?Object(new e(a)):new Array(a),c=0;c<a;)h=n[c],l[c]=o?void 0===r?o(h,c):o.call(r,h,c):h,c+=1;return l.length=a,l})),Array.prototype.reduce||Object.defineProperty(Array.prototype,"reduce",{value:function(t){if(null===this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof t)throw new TypeError(t+" is not a function");var i,e=Object(this),s=e.length>>>0,n=0;if(arguments.length>=2)i=arguments[1];else{for(;n<s&&!(n in e);)n++;if(n>=s)throw new TypeError("Reduce of empty array with no initial value");i=e[n++]}for(;n<s;)n in e&&(i=t(i,e[n],n,e)),n++;return i}}),Array.prototype.some||(Array.prototype.some=function(t){"use strict";if(null==this)throw new TypeError("Array.prototype.some called on null or undefined");if("function"!=typeof t)throw new TypeError;for(var i=Object(this),e=i.length>>>0,s=arguments.length>=2?arguments[1]:void 0,n=0;n<e;n++)if(n in i&&t.call(s,i[n],n,i))return!0;return!1}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,i){if(null==this)throw new TypeError('"this" is null or not defined');var e=Object(this),s=e.length>>>0;if(0===s)return!1;var n,r,o=0|i,h=Math.max(o>=0?o:s-Math.abs(o),0);for(;h<s;){if((n=e[h])===(r=t)||"number"==typeof n&&"number"==typeof r&&isNaN(n)&&isNaN(r))return!0;h++}return!1}})}},i={};!function e(s){if(i[s])return i[s].exports;var n=i[s]={exports:{}};return t[s].call(n.exports,n,n.exports,e),n.exports}(8598)})();